var jsPlumbBrowserUI=function(r){"use strict";function L(t,e,n){return"*"===t||(0<t.length?-1!==t.indexOf(e):!n)}function p(t,e,n){var i,o=t=t||{},s=e=e||{};if(n)for(i=0;i<n.length;i++)o[n[i]]=s[n[i]];else for(i in s)o[i]=s[i];return t}function G(t){return"[object Number]"===Object.prototype.toString.call(t)}function f(t){return"string"==typeof t}function R(t){return"boolean"==typeof t}function F(t){return null!=t&&"[object Object]"===Object.prototype.toString.call(t)}function B(t){return"[object Date]"===Object.prototype.toString.call(t)}function V(t){return"[object Function]"===Object.prototype.toString.call(t)}function H(t){if(f(t))return""+t;if(R(t))return!!t;if(B(t))return new Date(t.getTime());if(!V(t)){if(Array.isArray(t)){for(var e=[],n=0;n<t.length;n++)e.push(H(t[n]));return e}if(F(t)){var i,o={};for(i in t)o[i]=H(t[i]);return o}}return t}function U(t,e,n,i){var o,s,r={},a={};for(n=n||[],i=i||[],s=0;s<n.length;s++)r[n[s]]=!0;for(s=0;s<i.length;s++)a[i[s]]=!0;var l=H(t);for(s in e)if(null==l[s]||a[s])l[s]=e[s];else if(r[s])(o=[]).push.apply(o,Array.isArray(l[s])?l[s]:[l[s]]),o.push(e[s]),l[s]=o;else if(f(e[s])||R(e[s])||V(e[s])||G(e[s]))l[s]=e[s];else if(Array.isArray(e[s]))o=[],Array.isArray(l[s])&&o.push.apply(o,l[s]),o.push.apply(o,e[s]),l[s]=o;else if(F(e[s]))for(var c in F(l[s])||(l[s]={}),e[s])l[s][c]=e[s][c];return l}function X(t,e){if(!(null!=t&&null==e||(null==t||f(t)||R(t)||G(t))&&t!==e)){if(Array.isArray(t)){if(!Array.isArray(e))return;if(!Y(t,e))return}else if(F(t)){if(!F(t))return;if(!z(t,e))return}return 1}}function Y(t,e){if(null!=t||null!=e){if(null==t&&null!=e)return!1;if(null!=t&&null==e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!X(t[n],e[n]))return!1}return!0}function z(t,e){if(null!=t||null!=e){if(null==t&&null!=e)return!1;if(null!=t&&null==e)return!1;for(var n in t)if(!X(t[n],e[n]))return!1}return!0}function W(t,e,n){for(var i=0;i<n.length;i++){var o=n[i][0][n[i][1]].apply(n[i][0],n[i][2]);if(o===e)return o}return t}function q(t,u,h,d){return function t(e){if(null!=e){if(f(e)){var n=e,i=n.match(/(\${.*?})/g);if(null!=i)for(var o=0;o<i.length;o++){var s=u[i[o].substring(2,i[o].length-1)]||"";null!=s&&(n=n.replace(i[o],s))}return n}if(!V(e)||d||null!=h&&0!==(e.name||"").indexOf(h)){if(Array.isArray(e)){for(var r=[],a=0;a<e.length;a++)r.push(t(e[a]));return r}if(F(e)){var l,c={};for(l in e)c[l]=t(e[l]);return c}return e}return e(u)}}(t)}function y(t,e){if(!t)return null;for(var n=0;n<t.length;n++)e(t[n])}function J(t,e){if(t)for(var n=0;n<t.length;n++)if(e(t[n]))return n;return-1}function K(t,e){var n=[];if(t)for(var i=0;i<t.length;i++)e(t[i])&&n.push(i);return n}function Z(t,e){e=J(t,e);return-1===e?null:t[e]}function $(e,t){return K(e,t).map(function(t){return e[t]})}function Q(t,e){var n=null;return t.forEach(function(t){e(t)&&(n=t)}),n}function tt(t){var e=[];return t.forEach(function(t){e.push(t)}),e}function v(t,e){e=J(t,e);return-1<e&&t.splice(e,1),-1!==e}function et(t){var e;return null!=Array.fromArray?Array.from(t):(e=[],Array.prototype.push.apply(e,t),e)}function nt(t,e){e=t.indexOf(e);return-1<e&&t.splice(e,1),-1!==e}function it(t,e,n,i){var o=t[e];return null==o&&(t[e]=o=[]),o[i?"unshift":"push"](n),o}function ot(t,e,n){return-1===t.indexOf(e)&&(n?t.unshift(e):t.push(e),!0)}for(var o=[],st=0;st<256;st++)o[st]=(st<16?"0":"")+st.toString(16);function T(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return o[255&t]+o[t>>8&255]+o[t>>16&255]+o[t>>24&255]+"-"+o[255&e]+o[e>>8&255]+"-"+o[e>>16&15|64]+o[e>>24&255]+"-"+o[63&n|128]+o[n>>8&255]+"-"+o[n>>16&255]+o[n>>24&255]+o[255&i]+o[i>>8&255]+o[i>>16&255]+o[i>>24&255]}function rt(t,e,n){var i=t.x-e.x,t=t.y-e.y,o=Math.cos(n/360*Math.PI*2),n=Math.sin(n/360*Math.PI*2);return{x:i*o-t*n+e.x,y:t*o+i*n+e.y,cr:o,sr:n}}function at(t){if(null==t)return null;for(var e=t.replace(/^\s\s*/,""),n=/\s/,i=e.length;n.test(e.charAt(--i)););return e.slice(0,i+1)}function lt(t,e){t=null==t.length||"string"==typeof t?[t]:t;for(var n=0;n<t.length;n++)e(t[n])}function ct(t,e){for(var n=[],i=0;i<t.length;i++)n.push(e(t[i]));return n}function l(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if("undefined"!=typeof console)try{var i=arguments[arguments.length-1];console.log(i)}catch(t){}}function ut(t){return t<0?-1:0<t?1:0}function ht(e,n,i){return function(){var t=null;try{null!=n&&(t=n.apply(this,arguments))}catch(t){l("jsPlumb function failed : "+t)}if(null!=e&&(null==i||t!==i))try{t=e.apply(this,arguments)}catch(t){l("wrapped function failed : "+t)}return t}}function dt(t,e,n){return t.has(e)||t.set(e,n()),t.get(e)}function pt(t,e){for(var n=t.__proto__;null!=n;){if(n instanceof e)return!0;n=n.__proto__}return!1}function ft(t,e,n,i){if(0===e.length)e.push(t);else{for(var o=i?-1:1,s=0,r=e.length,a=Math.floor((s+r)/2);s<r;)n(t,e[a])*o<0?r=a:s=a+1,a=Math.floor((s+r)/2);e.splice(a,0,t)}}function yt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function vt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function gt(t,e,n){e&&vt(t.prototype,e),n&&vt(t,n)}function mt(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}function _t(t){return(_t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function xt(t,e){return(xt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Et(t,e){if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}return e}function bt(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=_t(n);return Et(this,i?(t=_t(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}gt(Ct,[{key:"fire",value:function(e,t,n){var i=null;if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[e]){var o=this._listeners[e].length,s=0,r=!1;if(!this.shouldFireEvent||this.shouldFireEvent(e,t,n))for(;!r&&s<o&&!1!==i;){if(this.eventsToDieOn[e])this._listeners[e][s].apply(this,[t,n]);else try{i=this._listeners[e][s].apply(this,[t,n])}catch(t){l("jsPlumb: fire failed for event "+e+" : "+(t.message||t))}s++,null!=this._listeners&&null!=this._listeners[e]||(r=!0)}}this.tick=!1,this._drain()}return i}},{key:"_drain",value:function(){var t=this.queue.pop();t&&this.fire.apply(this,t)}},{key:"unbind",value:function(t,e){if(0===arguments.length)this._listeners={};else if(1===arguments.length){if("string"==typeof t)delete this._listeners[t];else if(t.__jsPlumb){var n,i;for(i in t.__jsPlumb)n=t.__jsPlumb[i],nt(this._listeners[n]||[],t)}}else 2===arguments.length&&nt(this._listeners[t]||[],e);return this}},{key:"getListener",value:function(t){return this._listeners[t]||[]}},{key:"isSuspendEvents",value:function(){return this.eventsSuspended}},{key:"setSuspendEvents",value:function(t){this.eventsSuspended=t}},{key:"bind",value:function(t,e,n){function i(t){it(o._listeners,t,e,n),e.__jsPlumb=e.__jsPlumb||{},e.__jsPlumb[T()]=t}var o=this;if("string"==typeof t)i(t);else if(null!=t.length)for(var s=0;s<t.length;s++)i(t[s]);return this}},{key:"silently",value:function(t){this.setSuspendEvents(!0);try{t()}catch(t){l("Cannot execute silent function "+t)}this.setSuspendEvents(!1)}}]);var kt=Ct;function Ct(){yt(this,Ct),mt(this,"_listeners",{}),mt(this,"eventsSuspended",!1),mt(this,"tick",!1),mt(this,"eventsToDieOn",{ready:!0}),mt(this,"queue",[])}var St=function(){var t=i,e=kt;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xt(t,e);var n=bt(i);function i(){return yt(this,i),n.apply(this,arguments)}return gt(i,[{key:"shouldFireEvent",value:function(t,e,n){return!0}}]),i}(),Pt=[null,[1,-1],[1,1],[-1,1],[-1,-1]],Tt=[null,[-1,-1],[-1,1],[1,1],[1,-1]],wt=2*Math.PI;function At(t,e){return e.x===t.x?e.y>t.y?1/0:-1/0:e.y===t.y?e.x>t.x?0:-0:(e.y-t.y)/(e.x-t.x)}function Ot(t,e){return-1/At(t,e)}function Dt(t,e){return Math.sqrt(Math.pow(e.y-t.y,2)+Math.pow(e.x-t.x,2))}function Mt(t,e){return e.x>t.x||e.x==t.x?e.y>t.y?2:1:e.y>t.y?3:4}function It(t,e){var n=At(t,e),n=Math.atan(n),t=Mt(t,e);return 4!=t&&3!=t||(n+=Math.PI),n<0&&(n+=2*Math.PI),n}function jt(t,e){var n=t.x,i=t.x+t.w,o=t.y,t=t.y+t.h,s=e.x,r=e.x+e.w,a=e.y,e=e.y+e.h;return n<=s&&s<=i&&o<=a&&a<=t||n<=r&&r<=i&&o<=a&&a<=t||n<=s&&s<=i&&o<=e&&e<=t||n<=r&&s<=i&&o<=e&&e<=t||s<=n&&n<=r&&a<=o&&o<=e||s<=i&&i<=r&&a<=o&&o<=e||s<=n&&n<=r&&a<=t&&t<=e||s<=i&&n<=r&&a<=t&&t<=e}function Nt(t){var e=t[1].y-t[0].y,n=t[0].x-t[1].x;return{A:e,B:n,C:e*t[0].x+n*t[0].y}}function Lt(t,e){var n,i,o,s,r=Nt(t),a=Nt(e),l=r.A*a.B-a.A*r.B;return 0!=l&&(a={x:(a.B*r.C-r.B*a.C)/l,y:(r.A*a.C-a.A*r.C)/l},r=Math.min(t[0].x,t[1].x),l=Math.max(t[0].x,t[1].x),n=Math.min(t[0].y,t[1].y),t=Math.max(t[0].y,t[1].y),i=Math.min(e[0].x,e[1].x),o=Math.max(e[0].x,e[1].x),s=Math.min(e[0].y,e[1].y),e=Math.max(e[0].y,e[1].y),r<=a.x)&&a.x<=l&&n<=a.y&&a.y<=t&&i<=a.x&&a.x<=o&&s<=a.y&&a.y<=e?a:null}function Gt(t,e,n){var i=At(t,e),e=Mt(t,e),e=(0<n?Pt:Tt)[e],i=Math.atan(i),o=Math.abs(n*Math.sin(i))*e[1],n=Math.abs(n*Math.cos(i))*e[0];return{x:t.x+n,y:t.y+o}}function Rt(t,e,n){var t=At(t,e),t=Math.atan(-1/t),i=n/2*Math.sin(t),n=n/2*Math.cos(t);return[{x:e.x+n,y:e.y+i},{x:e.x-n,y:e.y-i}]}function Ft(t,e,n,i){n=null==n?null==e.thresholdX?e.w/2:e.thresholdX:n,i=null==i?null==e.thresholdY?e.h/2:e.thresholdY:i;var o=Math.floor(t.x/e.w),o=e.w*o,s=o+e.w,o=Math.abs(t.x-o)<=n?o:Math.abs(s-t.x)<=n?s:t.x,n=Math.floor(t.y/e.h),s=e.h*n,n=s+e.h;return{x:o,y:Math.abs(t.y-s)<=i?s:Math.abs(n-t.y)<=i?n:t.y}}function Bt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Vt(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}function Ht(){return{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}}r.PerimeterAnchorShapes=void 0,(i=r.PerimeterAnchorShapes||(r.PerimeterAnchorShapes={})).Circle="Circle",i.Ellipse="Ellipse",i.Triangle="Triangle",i.Diamond="Diamond",i.Rectangle="Rectangle",i.Square="Square",r.AnchorLocations=void 0,(i=r.AnchorLocations||(r.AnchorLocations={})).Assign="Assign",i.AutoDefault="AutoDefault",i.Bottom="Bottom",i.BottomLeft="BottomLeft",i.BottomRight="BottomRight",i.Center="Center",i.Continuous="Continuous",i.ContinuousBottom="ContinuousBottom",i.ContinuousLeft="ContinuousLeft",i.ContinuousRight="ContinuousRight",i.ContinuousTop="ContinuousTop",i.ContinuousLeftRight="ContinuousLeftRight",i.ContinuousTopBottom="ContinuousTopBottom",i.Left="Left",i.Perimeter="Perimeter",i.Right="Right",i.Top="Top",i.TopLeft="TopLeft",i.TopRight="TopRight";i=Xt,(Ut=[{key:"findClosestPointOnPath",value:function(t,e){return{d:1/0,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function(t,e,n,i){return[]}},{key:"boxIntersection",value:function(t,e,n,i){var o=[];return o.push.apply(o,this.lineIntersection(t,e,t+n,e)),o.push.apply(o,this.lineIntersection(t+n,e,t+n,e+i)),o.push.apply(o,this.lineIntersection(t+n,e+i,t,e+i)),o.push.apply(o,this.lineIntersection(t,e+i,t,e)),o}},{key:"boundingBoxIntersection",value:function(t){return this.boxIntersection(t.x,t.y,t.w,t.h)}}])&&Bt(i.prototype,Ut),pe&&Bt(i,pe);var Ut=Xt;function Xt(t){if(!(this instanceof Xt))throw new TypeError("Cannot call a class as a function");this.params=t,Vt(this,"x1",void 0),Vt(this,"x2",void 0),Vt(this,"y1",void 0),Vt(this,"y2",void 0),Vt(this,"extents",Ht()),Vt(this,"type",void 0),this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2}var Yt="undefined",zt="default",Wt="true",qt="false",Jt="*";function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Kt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function t(t,e,n){e&&Kt(t.prototype,e),n&&Kt(t,n)}function b(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Zt(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Zt(t,e){return(Zt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function n(i){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e,n=s(i);return t=o?(t=s(this).constructor,Reflect.construct(n,arguments,t)):n.apply(this,arguments),n=this,!(e=t)||"object"!=typeof e&&"function"!=typeof e?u(n):e}}function $t(t,e,n){return($t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var t=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}(t,e);if(t)return(t=Object.getOwnPropertyDescriptor(t,e)).get?t.get.call(n):t.value})(t,e,n||t)}function Qt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,o,s=[],r=!0,a=!1;try{for(n=n.call(t);!(r=(i=n.next()).done)&&(s.push(i.value),!e||s.length!==e);r=!0);}catch(t){a=!0,o=t}finally{try{r||null==n.return||n.return()}finally{if(a)throw o}}return s}}(t,e)||ee(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function te(t){return function(t){if(Array.isArray(t))return ne(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||ee(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ee(t,e){var n;if(t)return"string"==typeof t?ne(t,e):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ne(t,e):void 0}function ne(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var ie={},oe={},se={},re={get:function(t,e,n){var i=ie[e];if(i)return new i(t,n);throw{message:"jsPlumb: unknown endpoint type '"+e+"'"}},clone:function(t){var e=se[t.type];return re.get(t.endpoint,t.type,e.getParams(t))},compute:function(t,e,n,i){var o=oe[t.type];if(null!=o)return o(t,e,n,i);l("jsPlumb: cannot find endpoint calculator for endpoint of type ",t.type)},registerHandler:function(t){se[t.type]=t,ie[t.type]=t.cls,oe[t.type]=t.compute}},ae=(t(le,[{key:"addClass",value:function(t){this.classes.push(t),this.instance.addEndpointClass(this.endpoint,t)}},{key:"removeClass",value:function(e){this.classes=this.classes.filter(function(t){return t!==e}),this.instance.removeEndpointClass(this.endpoint,e)}},{key:"compute",value:function(t,e,n){this.computedValue=re.compute(this,t,e,n),this.bounds.xmin=this.x,this.bounds.ymin=this.y,this.bounds.xmax=this.x+this.w,this.bounds.ymax=this.y+this.h}},{key:"setVisible",value:function(t){this.instance.setEndpointVisible(this.endpoint,t)}}]),le);function le(t,e){c(this,le),this.endpoint=t,b(this,"typeId",void 0),b(this,"x",void 0),b(this,"y",void 0),b(this,"w",void 0),b(this,"h",void 0),b(this,"computedValue",void 0),b(this,"bounds",Ht()),b(this,"classes",[]),b(this,"instance",void 0),b(this,"type",void 0),e=e||{},this.instance=t.instance,t.cssClass&&this.classes.push(t.cssClass),e.cssClass&&this.classes.push(e.cssClass)}e(he,ae),ce=n(he);var ce,ue=he;function he(t,e){return c(this,he),b(u(t=ce.call(this,t,e)),"radius",void 0),b(u(t),"defaultOffset",void 0),b(u(t),"defaultInnerRadius",void 0),b(u(t),"type",he.type),t.radius=(e=e||{}).radius||5,t.defaultOffset=.5*t.radius,t.defaultInnerRadius=t.radius/3,t}b(ue,"type","Dot");var de,i={type:ue.type,cls:ue,compute:function(t,e,n,i){var o=e.curX-t.radius,e=e.curY-t.radius,s=2*t.radius,r=2*t.radius;return i&&i.stroke&&(o-=i=i.strokeWidth||1,e-=i,s+=2*i,r+=2*i),[t.x=o,t.y=e,t.w=s,t.h=r,t.radius]},getParams:function(t){return{radius:t.radius}}},pe=(e(fe,ae),de=n(fe),fe);function fe(t,e){return c(this,fe),b(u(t=de.call(this,t,e)),"type",fe.type),t}b(pe,"type","Blank");var ye,ve={type:pe.type,cls:pe,compute:function(t,e,n,i){return t.x=e.curX,t.y=e.curY,t.w=10,t.h=0,[e.curX,e.curY,10,0]},getParams:function(t){return{}}},ge=(e(me,ae),ye=n(me),t(me,null,[{key:"_getParams",value:function(t){return{width:t.width,height:t.height}}}]),me);function me(t,e){return c(this,me),b(u(t=ye.call(this,t,e)),"width",void 0),b(u(t),"height",void 0),b(u(t),"type",me.type),t.width=(e=e||{}).width||10,t.height=e.height||10,t}b(ge,"type","Rectangle");var _e={type:ge.type,cls:ge,compute:function(t,e,n,i){var o=i.width||t.width,i=i.height||t.height,s=e.curX-o/2,e=e.curY-i/2;return[t.x=s,t.y=e,t.w=o,t.h=i]},getParams:function(t){return{width:t.width,height:t.height}}},xe=(t(Ee,[{key:"getTypeDescriptor",value:function(){return"connector"}},{key:"getIdPrefix",value:function(){return"_jsplumb_connector"}},{key:"setGeometry",value:function(t,e){this.geometry=t,this.edited=null!=t&&!e}},{key:"exportGeometry",value:function(){return this.geometry}},{key:"importGeometry",value:function(t){return this.geometry=t,!0}},{key:"resetGeometry",value:function(){this.geometry=null,this.edited=!1}},{key:"transformAnchorPlacement",value:function(t,e,n){return{x:t.x,y:t.y,ox:t.ox,oy:t.oy,curX:t.curX+e,curY:t.curY+n}}},{key:"resetBounds",value:function(){this.bounds=Ht()}},{key:"findSegmentForPoint",value:function(t,e){for(var n={d:1/0,s:null,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null,index:null,connectorLocation:null},i=0;i<this.segments.length;i++){var o=this.segments[i].findClosestPointOnPath(t,e);o.d<n.d&&(n.d=o.d,n.l=o.l,n.x=o.x,n.y=o.y,n.s=this.segments[i],n.x1=o.x1,n.x2=o.x2,n.y1=o.y1,n.y2=o.y2,n.index=i,n.connectorLocation=this.segmentProportions[i][0]+o.l*(this.segmentProportions[i][1]-this.segmentProportions[i][0]))}return n}},{key:"lineIntersection",value:function(t,e,n,i){for(var o=[],s=0;s<this.segments.length;s++)o.push.apply(o,this.segments[s].lineIntersection(t,e,n,i));return o}},{key:"boxIntersection",value:function(t,e,n,i){for(var o=[],s=0;s<this.segments.length;s++)o.push.apply(o,this.segments[s].boxIntersection(t,e,n,i));return o}},{key:"boundingBoxIntersection",value:function(t){for(var e=[],n=0;n<this.segments.length;n++)e.push.apply(e,this.segments[n].boundingBoxIntersection(t));return e}},{key:"_updateSegmentProportions",value:function(){for(var t=0,e=0;e<this.segments.length;e++){var n=this.segments[e].getLength();this.segmentProportionalLengths[e]=n/this.totalLength,this.segmentProportions[e]=[t,t+=n/this.totalLength]}}},{key:"_findSegmentForLocation",value:function(t,e){var n,i,o;if(1===(t=e?0<t?t/this.totalLength:(this.totalLength+t)/this.totalLength:t))n=this.segments.length-1,o=1;else if(0===t)n=o=0;else if(.5<=t){for(o=n=0,i=this.segmentProportions.length-1;-1<i;i--)if(this.segmentProportions[i][1]>=t&&this.segmentProportions[i][0]<=t){n=i,o=(t-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}}else for(n=this.segmentProportions.length-1,o=1,i=0;i<this.segmentProportions.length;i++)if(this.segmentProportions[i][1]>=t){n=i,o=(t-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}return{segment:this.segments[n],proportion:o,index:n}}},{key:"_addSegment",value:function(t,e){e.x1===e.x2&&e.y1===e.y2||(t=new t(e),this.segments.push(t),this.totalLength+=t.getLength(),this.updateBounds(t))}},{key:"_clearSegments",value:function(){this.totalLength=0,this.segments.length=0,this.segmentProportions.length=0,this.segmentProportionalLengths.length=0}},{key:"getLength",value:function(){return this.totalLength}},{key:"_prepareCompute",value:function(t){this.strokeWidth=t.strokeWidth;var e,n=t.sourcePos.curX,i=t.targetPos.curX,o=t.sourcePos.curY,s=t.targetPos.curY,r=Mt({x:n,y:o},{x:i,y:s}),a=i<n,l=s<o,c=[t.sourcePos.ox,t.sourcePos.oy],t=[t.targetPos.ox,t.targetPos.oy],u=a?i:n,h=l?s:o,d=Math.abs(i-n),p=Math.abs(s-o),f=0===c[0]&&0===c[1],y=0===t[0]&&0===t[1],i=((f||y)&&(e=[1,0][v=p<d?0:1],n=0==v?n:o,o=0==v?i:s,f&&(c[v]=o<n?-1:1,c[e]=0),y)&&(t[v]=o<n?1:-1,t[e]=0),a?d+this.sourceGap*c[0]:this.sourceGap*c[0]),s=l?p+this.sourceGap*c[1]:this.sourceGap*c[1],f=a?this.targetGap*t[0]:d+this.targetGap*t[0],y=l?this.targetGap*t[1]:p+this.targetGap*t[1],v=c[0]*t[0]+c[1]*t[1],o={sx:i,sy:s,tx:f,ty:y,xSpan:Math.abs(f-i),ySpan:Math.abs(y-s),mx:(i+f)/2,my:(s+y)/2,so:c,to:t,x:u,y:h,w:d,h:p,segment:r,startStubX:i+c[0]*this.sourceStub,startStubY:s+c[1]*this.sourceStub,endStubX:f+t[0]*this.targetStub,endStubY:y+t[1]*this.targetStub,isXGreaterThanStubTimes2:Math.abs(i-f)>this.sourceStub+this.targetStub,isYGreaterThanStubTimes2:Math.abs(s-y)>this.sourceStub+this.targetStub,opposite:-1==v,perpendicular:0==v,orthogonal:1==v,sourceAxis:0===c[0]?"y":"x",points:[u,h,d,p,i,s,f,y],stubs:[this.sourceStub,this.targetStub]};return o.anchorOrientation=o.opposite?"opposite":o.orthogonal?"orthogonal":"perpendicular",o}},{key:"updateBounds",value:function(t){t=t.extents;this.bounds.xmin=Math.min(this.bounds.xmin,t.xmin),this.bounds.xmax=Math.max(this.bounds.xmax,t.xmax),this.bounds.ymin=Math.min(this.bounds.ymin,t.ymin),this.bounds.ymax=Math.max(this.bounds.ymax,t.ymax)}},{key:"dumpSegmentsToConsole",value:function(){l("SEGMENTS:");for(var t=0;t<this.segments.length;t++)l(this.segments[t].type,""+this.segments[t].getLength(),""+this.segmentProportions[t])}},{key:"pointOnPath",value:function(t,e){t=this._findSegmentForLocation(t,e);return t.segment&&t.segment.pointOnPath(t.proportion,!1)||{x:0,y:0}}},{key:"gradientAtPoint",value:function(t,e){t=this._findSegmentForLocation(t,e);return t.segment&&t.segment.gradientAtPoint(t.proportion,!1)||0}},{key:"pointAlongPathFrom",value:function(t,e,n){t=this._findSegmentForLocation(t,n);return t.segment&&t.segment.pointAlongPathFrom(t.proportion,e,!1)||{x:0,y:0}}},{key:"compute",value:function(t){this.paintInfo=this._prepareCompute(t),this._clearSegments(),this._compute(this.paintInfo,t),this.x=this.paintInfo.points[0],this.y=this.paintInfo.points[1],this.w=this.paintInfo.points[2],this.h=this.paintInfo.points[3],this.segment=this.paintInfo.segment,this._updateSegmentProportions()}},{key:"setAnchorOrientation",value:function(t,e){}}]),Ee);function Ee(t,e){c(this,Ee),this.connection=t,b(this,"type",void 0),b(this,"edited",!1),b(this,"stub",void 0),b(this,"sourceStub",void 0),b(this,"targetStub",void 0),b(this,"maxStub",void 0),b(this,"typeId",void 0),b(this,"gap",void 0),b(this,"sourceGap",void 0),b(this,"targetGap",void 0),b(this,"segments",[]),b(this,"totalLength",0),b(this,"segmentProportions",[]),b(this,"segmentProportionalLengths",[]),b(this,"paintInfo",null),b(this,"strokeWidth",void 0),b(this,"x",void 0),b(this,"y",void 0),b(this,"w",void 0),b(this,"h",void 0),b(this,"segment",void 0),b(this,"bounds",Ht()),b(this,"cssClass",void 0),b(this,"hoverClass",void 0),b(this,"geometry",void 0),this.stub=e.stub||this.getDefaultStubs(),this.sourceStub=Array.isArray(this.stub)?this.stub[0]:this.stub,this.targetStub=Array.isArray(this.stub)?this.stub[1]:this.stub,this.gap=e.gap||0,this.sourceGap=Array.isArray(this.gap)?this.gap[0]:this.gap,this.targetGap=Array.isArray(this.gap)?this.gap[1]:this.gap,this.maxStub=Math.max(this.sourceStub,this.targetStub),this.cssClass=e.cssClass||"",this.hoverClass=e.hoverClass||""}e(Ce,Ut),be=n(Ce),t(Ce,[{key:"getPath",value:function(t){return(t?"M "+this.x1+" "+this.y1+" ":"")+"L "+this.x2+" "+this.y2}},{key:"_recalc",value:function(){this.length=Math.sqrt(Math.pow(this.x2-this.x1,2)+Math.pow(this.y2-this.y1,2)),this.m=At({x:this.x1,y:this.y1},{x:this.x2,y:this.y2}),this.m2=-1/this.m,this.extents={xmin:Math.min(this.x1,this.x2),ymin:Math.min(this.y1,this.y2),xmax:Math.max(this.x1,this.x2),ymax:Math.max(this.y1,this.y2)}}},{key:"getLength",value:function(){return this.length}},{key:"getGradient",value:function(){return this.m}},{key:"_setCoordinates",value:function(t){this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this._recalc()}},{key:"pointOnPath",value:function(t,e){return 0!==t||e?1!==t||e?(e=e?0<t?t:this.length+t:t*this.length,Gt({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},e)):{x:this.x2,y:this.y2}:{x:this.x1,y:this.y1}}},{key:"gradientAtPoint",value:function(t,e){return this.m}},{key:"pointAlongPathFrom",value:function(t,e,n){t=this.pointOnPath(t,n),n=e<=0?{x:this.x1,y:this.y1}:{x:this.x2,y:this.y2};return e<=0&&1<Math.abs(e)&&(e*=-1),Gt(t,n,e)}},{key:"within",value:function(t,e,n){return n>=Math.min(t,e)&&n<=Math.max(t,e)}},{key:"closest",value:function(t,e,n){return Math.abs(n-t)<Math.abs(n-e)?t:e}},{key:"findClosestPointOnPath",value:function(t,e){var n,i={d:1/0,x:null,y:null,l:null,x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2},o=(0===this.m?(i.y=this.y1,i.x=this.within(this.x1,this.x2,t)?t:this.closest(this.x1,this.x2,t)):this.m===1/0||this.m===-1/0?(i.x=this.x1,i.y=this.within(this.y1,this.y2,e)?e:this.closest(this.y1,this.y2,e)):(n=this.y1-this.m*this.x1,o=(e-this.m2*t-n)/(this.m-this.m2),n=this.m*o+n,i.x=this.within(this.x1,this.x2,o)?o:this.closest(this.x1,this.x2,o),i.y=this.within(this.y1,this.y2,n)?n:this.closest(this.y1,this.y2,n)),Dt({x:i.x,y:i.y},{x:this.x1,y:this.y1}));return i.d=Dt({x:t,y:e},i),i.l=o/length,i}},{key:"_pointLiesBetween",value:function(t,e,n){return e<n?e<=t&&t<=n:t<=e&&n<=t}},{key:"lineIntersection",value:function(t,e,n,i){var o,s,r=Math.abs(At({x:t,y:e},{x:n,y:i})),a=Math.abs(this.m),l=a===1/0?this.x1:this.y1-a*this.x1,c=[],u=r===1/0?t:e-r*t;return r!==a&&(r===1/0&&0===a?this._pointLiesBetween(t,this.x1,this.x2)&&this._pointLiesBetween(this.y1,e,i)&&c.push({x:t,y:this.y1}):0===r&&a===1/0?this._pointLiesBetween(e,this.y1,this.y2)&&this._pointLiesBetween(this.x1,t,n)&&c.push({x:this.x1,y:e}):r===1/0?this._pointLiesBetween(o=t,this.x1,this.x2)&&this._pointLiesBetween(s=a*t+l,e,i)&&c.push({x:o,y:s}):0===r?this._pointLiesBetween(s=e,this.y1,this.y2)&&this._pointLiesBetween(o=(e-l)/a,t,n)&&c.push({x:o,y:s}):(s=a*(o=(u-l)/(a-r))+l,this._pointLiesBetween(o,this.x1,this.x2)&&this._pointLiesBetween(s,this.y1,this.y2)&&c.push({x:o,y:s}))),c}},{key:"boxIntersection",value:function(t,e,n,i){var o=[];return o.push.apply(o,this.lineIntersection(t,e,t+n,e)),o.push.apply(o,this.lineIntersection(t+n,e,t+n,e+i)),o.push.apply(o,this.lineIntersection(t+n,e+i,t,e+i)),o.push.apply(o,this.lineIntersection(t,e+i,t,e)),o}}]);var be,ke=Ce;function Ce(t){var e;return c(this,Ce),b(u(e=be.call(this,t)),"length",void 0),b(u(e),"m",void 0),b(u(e),"m2",void 0),b(u(e),"type",Ce.segmentType),e._setCoordinates({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}),e}b(ke,"segmentType","Straight");e(Te,xe),Se=n(Te),t(Te,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(t,e){this._addSegment(ke,{x1:t.sx,y1:t.sy,x2:t.startStubX,y2:t.startStubY}),this._addSegment(ke,{x1:t.startStubX,y1:t.startStubY,x2:t.endStubX,y2:t.endStubY}),this._addSegment(ke,{x1:t.endStubX,y1:t.endStubY,x2:t.tx,y2:t.ty}),this.geometry={source:e.sourcePos,target:e.targetPos}}},{key:"transformGeometry",value:function(t,e,n){return{source:this.transformAnchorPlacement(t.source,e,n),target:this.transformAnchorPlacement(t.target,e,n)}}}]);var Se,Pe=Te;function Te(){var t;c(this,Te);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return b(u(t=Se.call.apply(Se,[this].concat(n))),"type",Te.type),t}b(Pe,"type","Straight");var we={},Ae={get:function(t,e,n){var i=we[e];if(i)return new i(t,n);throw{message:"jsPlumb: unknown connector type '"+e+"'"}},register:function(t,e){we[t]=e}};function Oe(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.map(function(t){return"."+t}).join(",")}function De(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.join(" ")}function Me(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.map(function(t){return"["+t+"]"}).join(",")}var Ie="source",je="target",Ne="block",Le="none",Ge="absolute",Re="fixed",Fe="data-jtk-group",Be="data-jtk-managed",Ve="data-jtk-not-draggable",He="tabindex",Ue="data-jtk-scope",Xe=Ue+"-",Ye="checkCondition",ze="checkDropAllowed",We="jtk-connector",qe="jtk-connector-outline",Je="jtk-connected",Ke="jtk-endpoint",Ze="jtk-endpoint-connected",$e="jtk-endpoint-full",Qe="jtk-endpoint-drop-allowed",tn="jtk-endpoint-drop-forbidden",en="jtk-endpoint-anchor",nn="jtk-group-collapsed",on="jtk-group-expanded",sn="jtk-overlay",rn="anchor:changed",an="connection",ln="internal.connection",cn="connection:detach",un="connection:move",hn="container:change",dn="endpoint:replaced",pn="internal.endpoint:unregistered",fn="internal.connection:detached",yn="element:manage",vn="group:added",gn="group:collapse",mn="group:expand",_n="group:member:added",xn="group:member:removed",En="group:removed",bn="maxConnections",kn="group:nested:added",Cn="group:nested:removed",Sn="element:unmanage",Pn="zoom",Tn="isDetachAllowed",wn="beforeDrag",An="beforeDrop",On="beforeDetach",Dn="beforeStartDetach",h=Me(Be),Mn="Cannot establish connection: source endpoint is full",In="Cannot establish connection: target endpoint is full",jn="Cannot establish connection: source does not exist",Nn="Cannot establish connection: target does not exist",Ln="connectionOverlays";function Gn(t){var e=null;return(e=f(t)?{type:t,options:{}}:t).options.id=e.options.id||T(),e}e(Bn,kt),Rn=n(Bn),t(Bn,[{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"setVisible",value:function(t){this.visible=t,this.instance.setOverlayVisible(this,t)}},{key:"isVisible",value:function(){return this.visible}}]);var Rn,Fn=Bn;function Bn(t,e,n){var i,o;for(o in c(this,Bn),(i=Rn.call(this)).instance=t,i.component=e,b(u(i),"id",void 0),b(u(i),"type",void 0),b(u(i),"cssClass",void 0),b(u(i),"visible",!0),b(u(i),"location",void 0),b(u(i),"events",void 0),b(u(i),"attributes",void 0),i.id=(n=n||{}).id||T(),i.cssClass=n.cssClass||"",i.location=n.location||.5,i.events=n.events||{},i.attributes=n.attributes||{},i.events)i.bind(o,i.events[o]);return i}var Vn,Hn={},Un={get:function(t,e,n,i){var o=Hn[e];if(o)return new o(t,n,i);throw{message:"jsPlumb: unknown overlay type '"+e+"'"}},register:function(t,e){Hn[t]=e}},Xn=(e(Yn,Fn),Vn=n(Yn),t(Yn,[{key:"getLabel",value:function(){return V(this.label)?this.label(this):this.labelText}},{key:"setLabel",value:function(t){this.label=t,this.labelText=null,this.instance.updateLabel(this)}},{key:"getDimensions",value:function(){return{w:1,h:1}}},{key:"updateFrom",value:function(t){null!=t.label&&this.setLabel(t.label)}}]),Yn);function Yn(t,e,n){var i;return c(this,Yn),(i=Vn.call(this,t,e,n)).instance=t,i.component=e,b(u(i),"label",void 0),b(u(i),"labelText",void 0),b(u(i),"type",Yn.type),b(u(i),"cachedDimensions",void 0),i.setLabel((n=n||{label:""}).label),i}function zn(t){return t.type===Xn.type}function Wn(t){return null==t?null:t.split(" ")}function qn(t,e,n){for(var i in e)t[i]=n}b(Xn,"type","Label"),Un.register("Label",Xn);var Jn="__default",Kn="__label";function Zn(t,e){if(t.getDefaultType){var n=t.getTypeDescriptor(),i={},o=t.getDefaultType(),s=p({},o);qn(i,o,Jn);for(var r=0,a=t._types.length;r<a;r++){var l=t._types[r];if(l!==Jn){var c=t.instance.getType(l,n);if(null!=c){var u=new Set(["connector","anchor","anchors"]);if("override"===c.mergeStrategy)for(var h in c)u.add(h);s=U(s,c,["cssClass"],tt(u)),qn(i,c,l)}}}e&&(s=q(s,e,"_")),t.applyType(s,i)}}function $n(t,e){e=t._types[e],e=t.instance.getType(e,t.getTypeDescriptor());null!=e&&e.cssClass&&t.removeClass(e.cssClass)}function Qn(t){var e;t.paintStyle&&t.hoverPaintStyle&&(p(e={},t.paintStyle),p(e,t.hoverPaintStyle),t.hoverPaintStyle=e)}e(ni,kt),ti=n(ni),t(ni,[{key:"isDetachAllowed",value:function(t){var e=!0;if(this.beforeDetach)try{e=this.beforeDetach(t)}catch(t){l("jsPlumb: beforeDetach callback failed",t)}return e}},{key:"isDropAllowed",value:function(t,e,n,i,o){var s,t={sourceId:t,targetId:e,scope:n,connection:i,dropEndpoint:o};if(this.beforeDrop)try{s=this.beforeDrop(t)}catch(t){l("jsPlumb: beforeDrop callback failed",t)}else s=this.instance.checkCondition(An,t);return s}},{key:"getDefaultType",value:function(){return this._defaultType}},{key:"appendToDefaultType",value:function(t){for(var e in t)this._defaultType[e]=t[e]}},{key:"getId",value:function(){return this.id}},{key:"cacheTypeItem",value:function(t,e,n){this._typeCache[n]=this._typeCache[n]||{},this._typeCache[n][t]=e}},{key:"getCachedTypeItem",value:function(t,e){return this._typeCache[e]?this._typeCache[e][t]:null}},{key:"setType",value:function(t,e){this.clearTypes(),this._types=Wn(t)||[],Zn(this,e)}},{key:"getType",value:function(){return this._types}},{key:"reapplyTypes",value:function(t){Zn(this,t)}},{key:"hasType",value:function(t){return-1!==this._types.indexOf(t)}},{key:"addType",value:function(t,e){var n=Wn(t),i=!1;if(null!=n){for(var o=0,s=n.length;o<s;o++)this.hasType(n[o])||(this._types.push(n[o]),i=!0);i&&Zn(this,e)}}},{key:"removeType",value:function(t,e){var n=this,i=Wn(t),o=!1;if(null!=i){for(var s=0,r=i.length;s<r;s++)o=function(t){t=n._types.indexOf(t);return-1!==t&&($n(n,t),n._types.splice(t,1),!0)}(i[s])||o;o&&Zn(this,e)}}},{key:"clearTypes",value:function(t,e){for(var n=this._types.length,i=0;i<n;i++)$n(this,0),this._types.splice(0,1);Zn(this,t)}},{key:"toggleType",value:function(t,e){var n=Wn(t);if(null!=n){for(var i=0,o=n.length;i<o;i++){var s=this._types.indexOf(n[i]);-1!==s?($n(this,s),this._types.splice(s,1)):this._types.push(n[i])}Zn(this,e)}}},{key:"applyType",value:function(t,e){if(this.setPaintStyle(t.paintStyle),this.setHoverPaintStyle(t.hoverPaintStyle),this.mergeParameters(t.parameters),this.paintStyleInUse=this.getPaintStyle(),t.overlays){var n,i={};for(n in t.overlays){var o=this.overlays[t.overlays[n].options.id];o?(o.updateFrom(t.overlays[n].options),i[t.overlays[n].options.id]=!0,this.instance.reattachOverlay(o,this)):(null!=(o=this.getCachedTypeItem("overlay",t.overlays[n].options.id))?(this.instance.reattachOverlay(o,this),o.setVisible(!0),o.updateFrom(t.overlays[n].options),this.overlays[o.id]=o):o=this.addOverlay(t.overlays[n]),i[o.id]=!0)}for(n in this.overlays)null==i[this.overlays[n].id]&&this.removeOverlay(this.overlays[n].id,!0)}}},{key:"setPaintStyle",value:function(t){this.paintStyle=t,this.paintStyleInUse=this.paintStyle,Qn(this)}},{key:"getPaintStyle",value:function(){return this.paintStyle}},{key:"setHoverPaintStyle",value:function(t){this.hoverPaintStyle=t,Qn(this)}},{key:"getHoverPaintStyle",value:function(){return this.hoverPaintStyle}},{key:"destroy",value:function(){for(var t in this.overlays)this.instance.destroyOverlay(this.overlays[t]);this.overlays={},this.overlayPositions={},this.unbind(),this.clone=null}},{key:"isHover",value:function(){return this._hover}},{key:"mergeParameters",value:function(t){null!=t&&p(this.parameters,t)}},{key:"setVisible",value:function(t){(this.visible=t)?this.showOverlays():this.hideOverlays()}},{key:"isVisible",value:function(){return this.visible}},{key:"setAbsoluteOverlayPosition",value:function(t,e){this.overlayPositions[t.id]=e}},{key:"getAbsoluteOverlayPosition",value:function(t){return this.overlayPositions?this.overlayPositions[t.id]:null}},{key:"_clazzManip",value:function(t,e){for(var n in this.overlays)"add"===t?this.instance.addOverlayClass(this.overlays[n],e):"remove"===t&&this.instance.removeOverlayClass(this.overlays[n],e)}},{key:"addClass",value:function(t,e){var n=(this.cssClass||"").split(" ");n.push(t),this.cssClass=n.join(" "),this._clazzManip("add",t)}},{key:"removeClass",value:function(e,t){var n=(this.cssClass||"").split(" ");this.cssClass=n.filter(function(t){return t!==e}).join(" "),this._clazzManip("remove",e)}},{key:"getClass",value:function(){return this.cssClass}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"getData",value:function(){return this.data}},{key:"setData",value:function(t){this.data=t||{}}},{key:"mergeData",value:function(t){this.data=p(this.data,t)}},{key:"addOverlay",value:function(t){o=this,e=null,(e=f(i=t)?Un.get(o.instance,i,o,{}):null!=i.type&&null!=i.options?(n=p({},(s=i).options),Un.get(o.instance,s.type,o,n)):i).id=e.id||T(),o.cacheTypeItem("overlay",e,e.id);var e,n,i,o,s=o.overlays[e.id]=e;return this.getData&&s.type===Xn.type&&!f(t)&&(n=this.getData(),i=t.options,n)&&(o=n[i.labelLocationAttribute||"labelLocation"])&&(s.location=o),s}},{key:"getOverlay",value:function(t){return this.overlays[t]}},{key:"getOverlays",value:function(){return this.overlays}},{key:"hideOverlay",value:function(t){t=this.getOverlay(t);t&&t.setVisible(!1)}},{key:"hideOverlays",value:function(){for(var t,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];for(t in n=n||[],this.overlays)0!==n.length&&-1===n.indexOf(t)||this.overlays[t].setVisible(!1)}},{key:"showOverlay",value:function(t){t=this.getOverlay(t);t&&t.setVisible(!0)}},{key:"showOverlays",value:function(){for(var t,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];for(t in n=n||[],this.overlays)0!==n.length&&-1===n.indexOf(t)||this.overlays[t].setVisible(!0)}},{key:"removeAllOverlays",value:function(){for(var t in this.overlays)this.instance.destroyOverlay(this.overlays[t]);this.overlays={},this.overlayPositions=null,this.overlayPlacements={}}},{key:"removeOverlay",value:function(t,e){var n=this.overlays[t];n&&(n.setVisible(!1),e||this.instance.destroyOverlay(n),delete this.overlays[t],this.overlayPositions&&delete this.overlayPositions[t],this.overlayPlacements)&&delete this.overlayPlacements[t]}},{key:"removeOverlays",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,o=e.length;i<o;i++)this.removeOverlay(arguments[i])}},{key:"getLabel",value:function(){var t=this.getLabelOverlay();return null!=t?t.getLabel():null}},{key:"getLabelOverlay",value:function(){return this.getOverlay(Kn)}},{key:"setLabel",value:function(t){var e,n,i=this.getLabelOverlay();i?f(t)||V(t)?i.setLabel(t):((e=t).label&&i.setLabel(e.label),e.location&&(i.location=e.location)):(e=f(t)||V(t)?{label:t}:t,t=this,n=p({cssClass:(n=e).cssClass,id:Kn,component:t},e),i=new Xn(t.instance,t,n),this.overlays[Kn]=i)}}]);var ti,ei=ni;function ni(e,n){var i;if(c(this,ni),(i=ti.call(this)).instance=e,b(u(i),"defaultLabelLocation",.5),b(u(i),"overlays",{}),b(u(i),"overlayPositions",{}),b(u(i),"overlayPlacements",{}),b(u(i),"clone",void 0),b(u(i),"deleted",void 0),b(u(i),"segment",void 0),b(u(i),"x",void 0),b(u(i),"y",void 0),b(u(i),"w",void 0),b(u(i),"h",void 0),b(u(i),"id",void 0),b(u(i),"visible",!0),b(u(i),"typeId",void 0),b(u(i),"params",{}),b(u(i),"paintStyle",void 0),b(u(i),"hoverPaintStyle",void 0),b(u(i),"paintStyleInUse",void 0),b(u(i),"_hover",!1),b(u(i),"lastPaintedAt",void 0),b(u(i),"data",void 0),b(u(i),"_defaultType",void 0),b(u(i),"events",void 0),b(u(i),"parameters",void 0),b(u(i),"_types",void 0),b(u(i),"_typeCache",void 0),b(u(i),"cssClass",void 0),b(u(i),"hoverClass",void 0),b(u(i),"beforeDetach",void 0),b(u(i),"beforeDrop",void 0),n=n||{},i.cssClass=n.cssClass||"",i.hoverClass=n.hoverClass||e.defaults.hoverClass,i.beforeDetach=n.beforeDetach,i.beforeDrop=n.beforeDrop,i._types=[],i._typeCache={},i.parameters=H(n.parameters||{}),i.id=n.id||i.getIdPrefix()+(new Date).getTime(),i._defaultType={parameters:i.parameters,scope:n.scope||i.instance.defaultScope,overlays:{}},n.events)for(var t in n.events)i.bind(t,n.events[t]);i.clone=function(){var t=Object.create(i.constructor.prototype);return i.constructor.apply(t,[e,n]),t},i.overlays={},i.overlayPositions={};var o=n.overlays||[],s={},r=i.getDefaultOverlayKey();if(r){r=i.instance.defaults[r];r&&o.push.apply(o,te(r));for(var a=0;a<o.length;a++){var l=Gn(o[a]);s[l.options.id]=l}}return i._defaultType.overlays=s,n.label&&(i.getDefaultType().overlays[Kn]={type:Xn.type,options:{label:n.label,location:n.labelLocation||i.defaultLabelLocation,id:Kn}}),i}(d=a=a||{}).top="top",d.left="left",d.right="right",d.bottom="bottom";var w=a.top,k=a.left,C=a.right,S=a.bottom,ii=[k,C],oi=[w,S],si=(t(ri,[{key:"_updateOrientationInRouter",value:function(){this.instance.router.setAnchorOrientation(this,[this.locations[0].ox,this.locations[0].oy])}},{key:"over",value:function(t){this.orientation=this.instance.router.getEndpointOrientation(t),this.locations[0].ox=this.orientation[0],this.locations[0].oy=this.orientation[1],this._updateOrientationInRouter()}},{key:"out",value:function(){this.orientation=null,this.locations[0].ox=this.locations[0].iox,this.locations[0].oy=this.locations[0].ioy,this._updateOrientationInRouter()}}]),ri);function ri(t,e){c(this,ri),this.instance=t,this.element=e,b(this,"isFloating",!0),b(this,"isContinuous",void 0),b(this,"isDynamic",void 0),b(this,"locations",[]),b(this,"currentLocation",0),b(this,"locked",!1),b(this,"cssClass",""),b(this,"timestamp",null),b(this,"type","Floating"),b(this,"id",T()),b(this,"orientation",[0,0]),b(this,"size",void 0),this.size=t.getSize(e),this.locations.push({x:.5,y:.5,ox:this.orientation[0],oy:this.orientation[1],offx:0,offy:0,iox:this.orientation[0],ioy:this.orientation[1],cls:""})}b(d={},w,S),b(d,C,k),b(d,k,C),b(d,S,w);var ai=d,li=(b(a={},w,C),b(a,C,S),b(a,k,w),b(a,S,k),a),ci=(b(d={},w,k),b(d,C,w),b(d,k,S),b(d,S,C),d);function ui(t){return 0===t.faces.length?w:t.faces[0]}function hi(t,e){return-1!==t.faces.indexOf(e)}function di(t,e){return null==t.lockedAxis?null==t.lockedFace?!0===hi(t,e):t.lockedFace===e:-1!==t.lockedAxis.indexOf(e)}function pi(t,e){var n;return hi(t,e)?e:hi(t,ai[e])?ai[e]:(n=(t.clockwise?li:ci)[e],hi(t,n)?n:(n=(t.clockwise?ci:li)[e],hi(t,n)?n:e))}var a={x:.5,y:0,ox:0,oy:-1,offx:0,offy:0},d={x:.5,y:1,ox:0,oy:1,offx:0,offy:0},fi={x:0,y:.5,ox:-1,oy:0,offx:0,offy:0},yi={x:1,y:.5,ox:1,oy:0,offx:0,offy:0},vi={Top:[a],Bottom:[d],Left:[fi],Right:[yi],TopLeft:[{x:0,y:0,ox:0,oy:-1,offx:0,offy:0}],TopRight:[{x:1,y:0,ox:1,oy:-1,offx:0,offy:0}],BottomLeft:[{x:0,y:1,ox:0,oy:1,offx:0,offy:0}],BottomRight:[{x:1,y:1,ox:0,oy:1,offx:0,offy:0}],Center:[{x:.5,y:.5,ox:0,oy:0,offx:0,offy:0}],AutoDefault:[a,fi,d,yi]},gi={Continuous:{faces:[w,k,S,C]},ContinuousTop:{faces:[w]},ContinuousRight:{faces:[C]},ContinuousBottom:{faces:[S]},ContinuousLeft:{faces:[k]},ContinuousLeftRight:{faces:[k,C]},ContinuousTopBottom:{faces:[w,S]}};function mi(t,e){if(e=e||{},t===r.AnchorLocations.Perimeter)return wi(e);var n,i=vi[t];if(null!=i)return _i(t,ct(i,function(t){return p({iox:t.ox,ioy:t.oy},t)}),e);if(null!=(i=gi[t]))return n=t,i=i.faces,e=e,n={type:n,locations:[],currentLocation:0,locked:!1,id:T(),cssClass:e.cssClass||"",isFloating:!1,isContinuous:!0,timestamp:null,faces:e.faces||i,lockedFace:null,lockedAxis:null,clockwise:!(!1===e.clockwise),__currentFace:null},Object.defineProperty(n,Ei,{get:function(){return this.__currentFace},set:function(t){this.__currentFace=pi(this,t)}}),n;throw{message:"jsPlumb: unknown anchor type '"+t+"'"}}function _i(t,e,n){return{type:t,locations:e,currentLocation:0,locked:!1,id:T(),isFloating:!1,isContinuous:!1,isDynamic:1<e.length,timestamp:null,cssClass:n.cssClass||""}}function xi(t,e){return new si(t,e)}var Ei="currentFace";function bi(t){return t.length<7&&t.every(G)||7===t.length&&t.slice(0,5).every(G)&&f(t[6])}function ki(t){return f(t)?mi(t,null):Array.isArray(t)?bi(t)?_i(null,[{x:t[0],y:t[1],ox:t[2],oy:t[3],offx:null==t[4]?0:t[4],offy:null==t[5]?0:t[5],iox:t[2],ioy:t[3],cls:t[6]||""}],{cssClass:t[6]||""}):_i("Dynamic",ct(t,function(t){var e;return f(t)?null!=(e=vi[t])?p({iox:e[0].ox,ioy:e[0].oy,cls:""},e[0]):null:bi(t)?{x:t[0],y:t[1],ox:t[2],oy:t[3],offx:null==t[4]?0:t[4],offy:null==t[5]?0:t[5],iox:t[2],ioy:t[3],cls:t[6]||""}:void 0}).filter(function(t){return null!=t}),{}):mi(t.type,t.options)}function Ci(t){for(var e=2*Math.PI/t,n=[],i=0,o=0;o<t;o++){var s=.5+.5*Math.sin(i),r=.5+.5*Math.cos(i);n.push({x:s,y:r,ox:0,oy:0,offx:0,offy:0,iox:0,ioy:0,cls:""}),i+=e}return n}function Si(t,e){for(var n=[],i=0;i<t.length;i++)n.push([t[i][0],t[i][1],t[i][2],t[i][3],1/t.length,t[i][4],t[i][5]]);for(var o=n,u=e,h=u/o.length,d=[],s=function(t,e,n,i,o,s,r){for(var a=(n-t)/(h=u*o),l=(i-e)/h,c=0;c<h;c++)d.push({x:t+a*c,y:e+l*c,ox:null==s?0:s,oy:null==r?0:r,offx:0,offy:0,iox:0,ioy:0,cls:""})},r=0;r<o.length;r++)s.apply(null,o[r]);return d}function Pi(t){return Si([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]],t)}var Ti=new Map;function wi(t){var e=(t=t||{}).anchorCount||60,n=t.shape;if(!n)throw new Error("no shape supplied to Perimeter Anchor type");if(Ti.has(n))return e=Ti.get(n)(e),t.rotation&&(e=function(t,e){for(var n=[],i=e/180*Math.PI,o=0;o<t.length;o++){var s=t[o].x-.5,r=t[o].y-.5;n.push({x:s*Math.cos(i)-r*Math.sin(i)+.5,y:s*Math.sin(i)+r*Math.cos(i)+.5,ox:t[o].ox,oy:t[o].oy,offx:0,offy:0,iox:0,ioy:0,cls:""})}return n}(e,t.rotation)),p(_i(r.AnchorLocations.Perimeter,e,t),{shape:n});throw new Error("Shape ["+n+"] is unknown by Perimeter Anchor type")}Ti.set(r.PerimeterAnchorShapes.Circle,Ci),Ti.set(r.PerimeterAnchorShapes.Ellipse,Ci),Ti.set(r.PerimeterAnchorShapes.Rectangle,Pi),Ti.set(r.PerimeterAnchorShapes.Square,Pi),Ti.set(r.PerimeterAnchorShapes.Diamond,function(t){return Si([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]],t)}),Ti.set(r.PerimeterAnchorShapes.Triangle,function(t){return Si([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]],t)});var Ai="anchors",Oi="connector";function Di(t,e,n,i,o,s,r){var a,l,c;return e?(t.endpoints[n]=e).addConnection(t):(r=r||t.endpointSpec||t.endpointsSpec[n]||t.instance.defaults.endpoints[n]||t.instance.defaults.endpoint,null==(a=t.endpointStyles[n]||t.endpointStyle||t.instance.defaults.endpointStyles[n]||t.instance.defaults.endpointStyle).fill&&null!=t.paintStyle&&(a.fill=t.paintStyle.stroke),null==a.outlineStroke&&null!=t.paintStyle&&(a.outlineStroke=t.paintStyle.outlineStroke),null==a.outlineWidth&&null!=t.paintStyle&&(a.outlineWidth=t.paintStyle.outlineWidth),l=t.endpointHoverStyles[n]||t.endpointHoverStyle||t.endpointHoverStyle||t.instance.defaults.endpointHoverStyles[n]||t.instance.defaults.endpointHoverStyle,null!=t.hoverPaintStyle&&null==(l=null==l?{}:l).fill&&(l.fill=t.hoverPaintStyle.stroke),c=t.uuids?t.uuids[n]:null,i=null!=i?i:null!=t.instance.defaults.anchors?t.instance.defaults.anchors[n]:t.instance.defaults.anchor,a=t.instance._internal_newEndpoint({paintStyle:a,hoverPaintStyle:l,endpoint:r,connections:[t],uuid:c,element:o,scope:t.scope,anchor:i,reattachConnections:t.reattach||t.instance.defaults.reattachConnections,connectionsDetachable:t.detachable||t.instance.defaults.connectionsDetachable}),null==e&&(a.deleteOnEmpty=!0),t.endpoints[n]=a),a}e(ji,ei),Mi=n(ji),t(ji,[{key:"getIdPrefix",value:function(){return"_jsPlumb_c"}},{key:"getDefaultOverlayKey",value:function(){return Ln}},{key:"getXY",value:function(){return{x:this.connector.x,y:this.connector.y}}},{key:"makeEndpoint",value:function(t,e,n,i,o){return n=n||this.instance.getId(e),Di(this,o,t?0:1,i,e)}},{key:"getTypeDescriptor",value:function(){return ji.type}},{key:"isDetachable",value:function(t){return!1!==this.detachable&&(null!=t?!0===t.connectionsDetachable:!0===this.detachable)}},{key:"setDetachable",value:function(t){this.detachable=!0===t}},{key:"isReattach",value:function(){return!0===this.reattach||!0===this.endpoints[0].reattachConnections||!0===this.endpoints[1].reattachConnections}},{key:"setReattach",value:function(t){this.reattach=!0===t}},{key:"applyType",value:function(t,e){var n=null,n=(null!=t.connector&&(null==(n=this.getCachedTypeItem(Oi,e.connector))&&(n=this.prepareConnector(t.connector,e.connector),this.cacheTypeItem(Oi,n,e.connector)),this.setPreparedConnector(n)),$t(s(ji.prototype),"applyType",this).call(this,t,e),null!=t.detachable&&this.setDetachable(t.detachable),null!=t.reattach&&this.setReattach(t.reattach),t.scope&&(this.scope=t.scope),null);t.anchor?null==(n=this.getCachedTypeItem(Ai,e.anchor))&&(n=[ki(t.anchor),ki(t.anchor)],this.cacheTypeItem(Ai,n,e.anchor)):t.anchors&&null==(n=this.getCachedTypeItem(Ai,e.anchors))&&(n=[ki(t.anchors[0]),ki(t.anchors[1])],this.cacheTypeItem(Ai,n,e.anchors)),null!=n&&(this.instance.router.setConnectionAnchors(this,n),this.instance.router.isDynamicAnchor(this.endpoints[1]))&&this.instance.repaint(this.endpoints[1].element),this.instance.applyConnectorType(this.connector,t)}},{key:"addClass",value:function(t,e){$t(s(ji.prototype),"addClass",this).call(this,t),e&&(this.endpoints[0].addClass(t),this.endpoints[1].addClass(t),this.suspendedEndpoint)&&this.suspendedEndpoint.addClass(t),this.connector&&this.instance.addConnectorClass(this.connector,t)}},{key:"removeClass",value:function(t,e){$t(s(ji.prototype),"removeClass",this).call(this,t),e&&(this.endpoints[0].removeClass(t),this.endpoints[1].removeClass(t),this.suspendedEndpoint)&&this.suspendedEndpoint.removeClass(t),this.connector&&this.instance.removeConnectorClass(this.connector,t)}},{key:"setVisible",value:function(t){$t(s(ji.prototype),"setVisible",this).call(this,t),this.connector&&this.instance.setConnectorVisible(this.connector,t),this.instance._paintConnection(this)}},{key:"destroy",value:function(){$t(s(ji.prototype),"destroy",this).call(this),this.endpoints=null,this.endpointStyles=null,this.source=null,this.target=null,this.instance.destroyConnector(this),this.connector=null,this.deleted=!0}},{key:"getUuids",value:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]}},{key:"prepareConnector",value:function(t,e){var n={cssClass:this.params.cssClass,hoverClass:this.params.hoverClass,"pointer-events":this.params["pointer-events"]};return t=f(t)?this.instance._makeConnector(this,t,n):this.instance._makeConnector(this,t.type,U(t.options,n)),null!=e&&(t.typeId=e),t}},{key:"setPreparedConnector",value:function(t,e,n,i){if(this.connector!==t){var o,s="";if(null!=this.connector&&(o=this.connector,s=this.instance.getConnectorClass(this.connector),this.instance.destroyConnector(this)),this.connector=t,i&&this.cacheTypeItem(Oi,t,i),this.addClass(s),null!=o){var r,a=this.getOverlays();for(r in a)this.instance.reattachOverlay(a[r],this)}e||this.instance._paintConnection(this)}}},{key:"setConnector",value:function(t,e,n,i){t=this.prepareConnector(t,i);this.setPreparedConnector(t,e,n,i)}},{key:"replaceEndpoint",value:function(t,e){var n=this.endpoints[t],i=(n.elementId,this.instance.getEndpoints(n.element)),o=i.indexOf(n),e=Di(this,null,t,null,n.element,0,e);this.endpoints[t]=e,i.splice(o,1,e),n.detachFromConnection(this),this.instance.deleteEndpoint(n),this.instance.fire(dn,{previous:n,current:e})}}]);var Mi,Ii=ji;function ji(t,e){c(this,ji),(n=Mi.call(this,t,e)).instance=t,b(u(n),"connector",void 0),b(u(n),"defaultLabelLocation",.5),b(u(n),"scope",void 0),b(u(n),"typeId","_jsplumb_connection"),b(u(n),"previousConnection",void 0),b(u(n),"sourceId",void 0),b(u(n),"targetId",void 0),b(u(n),"source",void 0),b(u(n),"target",void 0),b(u(n),"detachable",!0),b(u(n),"reattach",!1),b(u(n),"uuids",void 0),b(u(n),"cost",1),b(u(n),"directed",void 0),b(u(n),"endpoints",[null,null]),b(u(n),"endpointStyles",void 0),b(u(n),"endpointSpec",void 0),b(u(n),"endpointsSpec",void 0),b(u(n),"endpointStyle",{}),b(u(n),"endpointHoverStyle",{}),b(u(n),"endpointHoverStyles",void 0),b(u(n),"suspendedEndpoint",void 0),b(u(n),"suspendedIndex",void 0),b(u(n),"suspendedElement",void 0),b(u(n),"suspendedElementId",void 0),b(u(n),"suspendedElementType",void 0),b(u(n),"_forceReattach",void 0),b(u(n),"_forceDetach",void 0),b(u(n),"proxies",[]),b(u(n),"pending",!1),n.id=e.id,n.previousConnection=e.previousConnection,n.source=e.source,n.target=e.target,e.sourceEndpoint?(n.source=e.sourceEndpoint.element,n.sourceId=e.sourceEndpoint.elementId):n.sourceId=t.getId(n.source),e.targetEndpoint?(n.target=e.targetEndpoint.element,n.targetId=e.targetEndpoint.elementId):n.targetId=t.getId(n.target),n.scope=e.scope;var n,i=e.anchors?e.anchors[0]:e.anchor,o=e.anchors?e.anchors[1]:e.anchor,t=(t.manage(n.source),t.manage(n.target),n.visible=!0,n.params={cssClass:e.cssClass,hoverClass:e.hoverClass,"pointer-events":e["pointer-events"],overlays:e.overlays},n.lastPaintedAt=null,e.type&&(e.endpoints=e.endpoints||n.instance._deriveEndpointAndAnchorSpec(e.type).endpoints),n.endpointSpec=e.endpoint,n.endpointsSpec=e.endpoints||[null,null],n.endpointStyle=e.endpointStyle,n.endpointHoverStyle=e.endpointHoverStyle,n.endpointStyles=e.endpointStyles||[null,null],n.endpointHoverStyles=e.endpointHoverStyles||[null,null],n.paintStyle=e.paintStyle,n.hoverPaintStyle=e.hoverPaintStyle,n.uuids=e.uuids,n.makeEndpoint(!0,n.source,n.sourceId,i,e.sourceEndpoint),n.makeEndpoint(!1,n.target,n.targetId,o,e.targetEndpoint),n.scope||(n.scope=n.endpoints[0].scope),null!=e.deleteEndpointsOnEmpty&&(n.endpoints[0].deleteOnEmpty=e.deleteEndpointsOnEmpty,n.endpoints[1].deleteOnEmpty=e.deleteEndpointsOnEmpty),n.instance.defaults.connectionsDetachable),i=(!1===e.detachable&&(t=!1),!1===n.endpoints[0].connectionsDetachable&&(t=!1),!1===n.endpoints[1].connectionsDetachable&&(t=!1),n.endpointsSpec=e.endpoints||[null,null],n.endpointSpec=e.endpoint||null,e.reattach||n.endpoints[0].reattachConnections||n.endpoints[1].reattachConnections||n.instance.defaults.reattachConnections),t=(n.appendToDefaultType({detachable:t,reattach:i,paintStyle:n.endpoints[0].connectorStyle||n.endpoints[1].connectorStyle||e.paintStyle||n.instance.defaults.paintStyle,hoverPaintStyle:n.endpoints[0].connectorHoverStyle||n.endpoints[1].connectorHoverStyle||e.hoverPaintStyle||n.instance.defaults.hoverPaintStyle}),n.instance._suspendDrawing||(o=n.instance._suspendedAt||T(),n.instance._paintEndpoint(n.endpoints[0],{timestamp:o}),n.instance._paintEndpoint(n.endpoints[1],{timestamp:o})),n.cost=e.cost||n.endpoints[0].connectionCost,n.directed=e.directed,null==e.directed&&(n.directed=n.endpoints[0].connectionsDirected),p({},n.endpoints[1].parameters)),i=(p(t,n.endpoints[0].parameters),p(t,n.parameters),n.parameters=t,n.paintStyleInUse=n.getPaintStyle()||{},n.setConnector(n.endpoints[0].connector||n.endpoints[1].connector||e.connector||n.instance.defaults.connector,!0),null!=e.data&&F(e.data)?e.data:{}),o=(n.setData(i),[zt,n.endpoints[0].edgeType,n.endpoints[1].edgeType,e.type].join(" "));return/[^\s]/.test(o)&&n.addType(o,e.data),n}b(Ii,"type","connection");var Ni,Li=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],Gi=(e(Ri,ei),Ni=n(Ri),t(Ri,[{key:"getIdPrefix",value:function(){return"_jsplumb_e"}},{key:"getTypeDescriptor",value:function(){return"endpoint"}},{key:"getXY",value:function(){return{x:this.endpoint.x,y:this.endpoint.y}}},{key:"getDefaultOverlayKey",value:function(){return"endpointOverlays"}},{key:"_updateAnchorClass",value:function(){var t,e=this._anchor&&this._anchor.cssClass;null!=e&&0<e.length&&(t=this.instance.endpointAnchorClassPrefix+"-"+this.currentAnchorClass,this.currentAnchorClass=e,t!=(e=this.instance.endpointAnchorClassPrefix+(this.currentAnchorClass?"-"+this.currentAnchorClass:"")))&&(this.removeClass(t),this.addClass(e),this.instance.removeClass(this.element,t),this.instance.addClass(this.element,e))}},{key:"setPreparedAnchor",value:function(t){return this.instance.router.setAnchor(this,t),this._updateAnchorClass(),this}},{key:"_anchorLocationChanged",value:function(t){this.fire(rn,{endpoint:this,anchor:t}),this._updateAnchorClass()}},{key:"setAnchor",value:function(t){t=this.instance.router.prepareAnchor(t);return this.setPreparedAnchor(t),this}},{key:"addConnection",value:function(t){var e=this.isFull(),n=0===this.connections.length;this.connections.push(t),n&&this.addClass(this.instance.endpointConnectedClass),this.isFull()?e||this.addClass(this.instance.endpointFullClass):e&&this.removeClass(this.instance.endpointFullClass)}},{key:"detachFromConnection",value:function(t,e,n){0<=(e=null==e?this.connections.indexOf(t):e)&&(this.connections.splice(e,1),this.instance._refreshEndpoint(this)),!n&&this.deleteOnEmpty&&0===this.connections.length&&this.instance.deleteEndpoint(this)}},{key:"deleteEveryConnection",value:function(t){for(var e=this.connections.length,n=0;n<e;n++)this.instance.deleteConnection(this.connections[0],t)}},{key:"detachFrom",value:function(t){for(var e=[],n=0;n<this.connections.length;n++)this.connections[n].endpoints[1]!==t&&this.connections[n].endpoints[0]!==t||e.push(this.connections[n]);for(var i=0,o=e.length;i<o;i++)this.instance.deleteConnection(e[0]);return this}},{key:"setVisible",value:function(t,e,n){if($t(s(Ri.prototype),"setVisible",this).call(this,t),this.endpoint.setVisible(t),t?this.showOverlays():this.hideOverlays(),!e)for(var i,o=0;o<this.connections.length;o++)this.connections[o].setVisible(t),n||(i=this===this.connections[o].endpoints[0]?1:0,1===this.connections[o].endpoints[i].connections.length&&this.connections[o].endpoints[i].setVisible(t,!0,!0))}},{key:"applyType",value:function(t,e){$t(s(Ri.prototype),"applyType",this).call(this,t,e),this.setPaintStyle(t.endpointStyle||t.paintStyle),this.setHoverPaintStyle(t.endpointHoverStyle||t.hoverPaintStyle),this.connectorStyle=t.connectorStyle,this.connectorHoverStyle=t.connectorHoverStyle,this.connector=t.connector,this.connectorOverlays=t.connectorOverlays,this.edgeType=t.edgeType,null!=t.maxConnections&&(this.maxConnections=t.maxConnections),t.scope&&(this.scope=t.scope),p(t,Li),this.instance.applyEndpointType(this,t)}},{key:"destroy",value:function(){$t(s(Ri.prototype),"destroy",this).call(this),this.deleted=!0,null!=this.endpoint&&this.instance.destroyEndpoint(this)}},{key:"isFull",value:function(){return 0===this.maxConnections||!(this.isFloating()||this.maxConnections<0||this.connections.length<this.maxConnections)}},{key:"isFloating",value:function(){return this.instance.router.isFloating(this)}},{key:"isConnectedTo",value:function(t){var e=!1;if(t)for(var n=0;n<this.connections.length;n++)if(this.connections[n].endpoints[1]===t||this.connections[n].endpoints[0]===t){e=!0;break}return e}},{key:"setDragAllowedWhenFull",value:function(t){this.dragAllowedWhenFull=t}},{key:"getUuid",value:function(){return this.uuid}},{key:"connectorSelector",value:function(){return this.connections[0]}},{key:"prepareEndpoint",value:function(t,e){var n={cssClass:this.cssClass,endpoint:this};return(t=pt(t,ae)?re.clone(t):f(t)?re.get(this,t,n):(p(n,(t=t).options||{}),re.get(this,t.type,n))).typeId=e,t}},{key:"setEndpoint",value:function(t){t=this.prepareEndpoint(t);this.setPreparedEndpoint(t)}},{key:"setPreparedEndpoint",value:function(t){null!=this.endpoint&&this.instance.destroyEndpoint(this),this.endpoint=t}},{key:"addClass",value:function(t,e){$t(s(Ri.prototype),"addClass",this).call(this,t,e),null!=this.endpoint&&this.endpoint.addClass(t)}},{key:"removeClass",value:function(t,e){$t(s(Ri.prototype),"removeClass",this).call(this,t,e),null!=this.endpoint&&this.endpoint.removeClass(t)}}]),Ri);function Ri(t,e){c(this,Ri),(n=Ni.call(this,t,e)).instance=t,b(u(n),"connections",[]),b(u(n),"endpoint",void 0),b(u(n),"element",void 0),b(u(n),"elementId",void 0),b(u(n),"dragAllowedWhenFull",!0),b(u(n),"timestamp",void 0),b(u(n),"portId",void 0),b(u(n),"maxConnections",void 0),b(u(n),"proxiedBy",void 0),b(u(n),"connectorClass",void 0),b(u(n),"connectorHoverClass",void 0),b(u(n),"finalEndpoint",void 0),b(u(n),"enabled",!0),b(u(n),"isSource",void 0),b(u(n),"isTarget",void 0),b(u(n),"isTemporarySource",void 0),b(u(n),"connectionCost",1),b(u(n),"connectionsDirected",void 0),b(u(n),"connectionsDetachable",void 0),b(u(n),"reattachConnections",void 0),b(u(n),"currentAnchorClass",void 0),b(u(n),"referenceEndpoint",void 0),b(u(n),"edgeType",void 0),b(u(n),"connector",void 0),b(u(n),"connectorOverlays",void 0),b(u(n),"connectorStyle",void 0),b(u(n),"connectorHoverStyle",void 0),b(u(n),"deleteOnEmpty",void 0),b(u(n),"uuid",void 0),b(u(n),"scope",void 0),b(u(n),"_anchor",void 0),b(u(n),"defaultLabelLocation",[.5,.5]),n.appendToDefaultType({edgeType:e.edgeType,maxConnections:(null==e.maxConnections?n.instance.defaults:e).maxConnections,paintStyle:e.paintStyle||n.instance.defaults.endpointStyle,hoverPaintStyle:e.hoverPaintStyle||n.instance.defaults.endpointHoverStyle,connectorStyle:e.connectorStyle,connectorHoverStyle:e.connectorHoverStyle,connectorClass:e.connectorClass,connectorHoverClass:e.connectorHoverClass,connectorOverlays:e.connectorOverlays,connector:e.connector}),n.enabled=!(!1===e.enabled),n.visible=!0,n.element=e.element,n.uuid=e.uuid,n.portId=e.portId,n.elementId=e.elementId,n.connectionCost=null==e.connectionCost?1:e.connectionCost,n.connectionsDirected=e.connectionsDirected,n.currentAnchorClass="",n.events={},n.connectorOverlays=e.connectorOverlays,n.connectorStyle=e.connectorStyle,n.connectorHoverStyle=e.connectorHoverStyle,n.connector=e.connector,n.edgeType=e.edgeType,n.connectorClass=e.connectorClass,n.connectorHoverClass=e.connectorHoverClass,n.deleteOnEmpty=!0===e.deleteOnEmpty,n.isSource=e.source||!1,n.isTemporarySource=e.isTemporarySource||!1,n.isTarget=e.target||!1,n.connections=e.connections||[],n.scope=e.scope||t.defaultScope,n.timestamp=null,n.reattachConnections=e.reattachConnections||t.defaults.reattachConnections,n.connectionsDetachable=t.defaults.connectionsDetachable,!1===e.connectionsDetachable&&(n.connectionsDetachable=!1),n.dragAllowedWhenFull=!1!==e.dragAllowedWhenFull,e.onMaxConnections&&n.bind(bn,e.onMaxConnections);var n,i=e.endpoint||e.existingEndpoint||t.defaults.endpoint,t=(n.setEndpoint(i),null!=e.preparedAnchor?n.setPreparedAnchor(e.preparedAnchor):(i=e.anchor||e.anchors||t.defaults.anchor||r.AnchorLocations.Top,n.setAnchor(i)),[zt,e.type||""].join(" "));return n.addType(t,e.data),n}function Fi(t,e){c(this,Fi),this.instance=t,this.el=e,b(this,"group",void 0)}e(Hi,Fi),Bi=n(Hi),t(Hi,[{key:"overrideDrop",value:function(t,e){return this.dropOverride&&(this.revert||this.prune||this.orphan)}},{key:"getAnchor",value:function(t,e){return this.anchor||"Continuous"}},{key:"getEndpoint",value:function(t,e){return this.endpoint||{type:ue.type,options:{radius:10}}}},{key:"add",value:function(t,e){var n=this.instance.getGroupContentArea(this),i=t;if(null!=i._jsPlumbParentGroup){if(i._jsPlumbParentGroup===this)return;i._jsPlumbParentGroup.remove(t,!0,e,!1)}(i._jsPlumbParentGroup=this).children.push(new Fi(this.instance,t)),this.instance._appendElement(i,n),this.manager._updateConnectionsForGroup(this)}},{key:"resolveNode",value:function(e){return null==e?null:Z(this.children,function(t){return t.el===e})}},{key:"remove",value:function(t,e,n,i,o){t=this.resolveNode(t);null!=t&&this._doRemove(t,e,n,i,o)}},{key:"_doRemove",value:function(e,t,n,i,o){var s=e.el;if(delete s._jsPlumbParentGroup,v(this.children,function(t){return t===e}),t)try{this.instance.getGroupContentArea(this).removeChild(s)}catch(t){l("Could not remove element from Group "+t)}n||(t={group:this,el:s},o&&(t.targetGroup=o),this.instance.fire(xn,t)),i||this.manager._updateConnectionsForGroup(this)}},{key:"removeAll",value:function(t,e){for(var n=0,i=this.children.length;n<i;n++){var o=this.children[0];this._doRemove(o,t,e,!0),this.instance.unmanage(o.el,!0)}this.children.length=0,this.manager._updateConnectionsForGroup(this)}},{key:"orphanAll",value:function(){for(var t={},e=0;e<this.children.length;e++){var n=this.manager.orphan(this.children[e].el,!1);t[n.id]=n.pos}return this.children.length=0,t}},{key:"addGroup",value:function(t){if(this.instance.allowNestedGroups&&t!==this){if(this.instance.groupManager.isAncestor(this,t))return!1;null!=t.group&&t.group.removeGroup(t);var e=this.instance.getId(t.el),e=(this.instance.getManagedElements()[e].group=this.elId,this.instance.getOffsetRelativeToRoot(t.el)),n=this.collapsed?this.instance.getOffsetRelativeToRoot(this.el):this.instance.getOffsetRelativeToRoot(this.instance.getGroupContentArea(this)),e=((t.el._jsPlumbParentGroup=this).children.push(t),this.instance._appendElement(t.el,this.instance.getGroupContentArea(this)),t.group=this,{x:e.x-n.x,y:e.y-n.y});return this.instance.setPosition(t.el,e),this.instance.fire(kn,{parent:this,child:t}),!0}return!1}},{key:"removeGroup",value:function(e){var t,n;e.group===this&&(t=e.el,(n=this.instance.getGroupContentArea(this))===t.parentNode&&n.removeChild(e.el),n=this.instance.getId(e.el),(n=this.instance.getManagedElements()[n])&&delete n.group,this.children=this.children.filter(function(t){return t.id!==e.id}),delete e.group,delete t._jsPlumbParentGroup,this.instance.fire(Cn,{parent:this,child:e}))}},{key:"getGroups",value:function(){return this.children.filter(function(t){return t.constructor===Hi})}},{key:"getNodes",value:function(){return this.children.filter(function(t){return t.constructor===Fi})}},{key:"collapseParent",get:function(){var t=null;if(null==this.group)return null;for(var e=this.group;null!=e;)e.collapsed&&(t=e),e=e.group;return t}}]);var Bi,Vi=Hi;function Hi(t,e,n){c(this,Hi),(i=Bi.call(this,t,e)).instance=t,b(u(i),"children",[]),b(u(i),"collapsed",!1),b(u(i),"droppable",void 0),b(u(i),"enabled",void 0),b(u(i),"orphan",void 0),b(u(i),"constrain",void 0),b(u(i),"proxied",void 0),b(u(i),"ghost",void 0),b(u(i),"revert",void 0),b(u(i),"prune",void 0),b(u(i),"dropOverride",void 0),b(u(i),"anchor",void 0),b(u(i),"endpoint",void 0),b(u(i),"connections",{source:[],target:[],internal:[]}),b(u(i),"manager",void 0),b(u(i),"id",void 0),b(u(i),"elId",void 0);var i,o=i.el;return o._isJsPlumbGroup=!0,o._jsPlumbGroup=u(i),i.elId=t.getId(e),i.orphan=!0===n.orphan,i.revert=!0!==i.orphan&&!1!==n.revert,i.droppable=!1!==n.droppable,i.ghost=!0===n.ghost,i.enabled=!1!==n.enabled,i.prune=!0!==i.orphan&&!0===n.prune,i.constrain=i.ghost||!0===n.constrain,i.proxied=!1!==n.proxied,i.id=n.id||T(),i.dropOverride=!0===n.dropOverride,i.anchor=n.anchor,i.endpoint=n.endpoint,i.anchor=n.anchor,t.setAttribute(e,Fe,""),i}t(Xi,[{key:"_cleanupDetachedConnection",value:function(e){e.proxies.length=0;var t,n=this._connectionSourceMap[e.id];null!=n&&(v(n.connections.source,t=function(t){return t.id===e.id}),v(n.connections.target,t),v(n.connections.internal,t),delete this._connectionSourceMap[e.id]),null!=(n=this._connectionTargetMap[e.id])&&(v(n.connections.source,t=function(t){return t.id===e.id}),v(n.connections.target,t),v(n.connections.internal,t),delete this._connectionTargetMap[e.id])}},{key:"addGroup",value:function(t){var e=t.el;if(null!=this.groupMap[t.id])throw new Error("cannot create Group ["+t.id+"]; a Group with that ID exists");if(null!=e._isJsPlumbGroup)throw new Error("cannot create Group ["+t.id+"]; the given element is already a Group");e=new Vi(this.instance,t.el,t);return this.groupMap[e.id]=e,t.collapsed&&this.collapseGroup(e),this.instance.manage(e.el),this.instance.addClass(e.el,on),(e.manager=this)._updateConnectionsForGroup(e),this.instance.fire(vn,{group:e}),e}},{key:"getGroup",value:function(t){var e=t;if(f(t)&&null==(e=this.groupMap[t]))throw new Error("No such group ["+t+"]");return e}},{key:"getGroupFor",value:function(t){for(var e=t,n=this.instance.getContainer(),i=!1,o=null;!i;)null==e||e===n?i=!0:e._jsPlumbParentGroup?(o=e._jsPlumbParentGroup,i=!0):e=e.parentNode;return o}},{key:"getGroups",value:function(){var t,e=[];for(t in this.groupMap)e.push(this.groupMap[t]);return e}},{key:"removeGroup",value:function(t,e,n,i){var o=this,s=this.getGroup(t),t=(this.expandGroup(s,!0),{});return y(s.children,function(t){t=o.instance.getManagedElements()[o.instance.getId(t.el)];t&&delete t.group}),e?(y(s.getGroups(),function(t){o.removeGroup(t,e,n)}),s.removeAll(n,i)):(s.group&&y(s.children,function(t){s.group.add(t.el)}),t=s.orphanAll()),s.group&&s.group.removeGroup(s),this.instance.unmanage(s.el,!0),delete this.groupMap[s.id],this.instance.fire(En,{group:s}),t}},{key:"removeAllGroups",value:function(t,e,n){for(var i in this.groupMap)this.removeGroup(this.groupMap[i],t,e,n)}},{key:"forEach",value:function(t){for(var e in this.groupMap)t(this.groupMap[e])}},{key:"orphan",value:function(t,e){var n,i,o,s,r=t;if(r._jsPlumbParentGroup)return n=r._jsPlumbParentGroup,i=this.instance.getOffset(r),o=this.instance.getId(r),s=this.instance.getOffset(t),r.parentNode.removeChild(r),!0!==e&&n.group?(s.x+=i.x,s.y+=i.y,this.instance.getGroupContentArea(n.group).appendChild(t)):this.instance._appendElement(t,this.instance.getContainer()),this.instance.setPosition(t,s),delete r._jsPlumbParentGroup,{id:o,pos:s}}},{key:"_updateConnectionsForGroup",value:function(n){var t,i,o,s,e,r=this,a=(n.connections.source.length=0,n.connections.target.length=0,n.connections.internal.length=0,n.children.slice().map(function(t){return t.el})),l=[];y(a,function(t){Array.prototype.push.apply(l,r.instance.getSelector(t,h))}),Array.prototype.push.apply(a,l),0<a.length&&(t=this.instance.getConnections({source:a,scope:Jt},!0),a=this.instance.getConnections({target:a,scope:Jt},!0),i={},(e=function(t){for(var e=0;e<t.length;e++)i[t[e].id]||(i[t[e].id]=!0,o=r.getGroupFor(t[e].source),s=r.getGroupFor(t[e].target),t[e].source===n.el&&s===n||t[e].target===n.el&&o===n?n.connections.internal.push(t[e]):o===n?((s!==n?n.connections.source:n.connections.internal).push(t[e]),r._connectionSourceMap[t[e].id]=n):s===n&&(n.connections.target.push(t[e]),r._connectionTargetMap[t[e].id]=n))})(t),e(a))}},{key:"_collapseConnection",value:function(t,e,n){var i,o=t.endpoints[0===e?1:0].element;return!(o._jsPlumbParentGroup&&!o._jsPlumbParentGroup.proxied&&o._jsPlumbParentGroup.collapsed||(o=null!=(o=t.endpoints[0].element._jsPlumbParentGroup)?o.collapseParent||o:null,i=null!=(i=t.endpoints[1].element._jsPlumbParentGroup)?i.collapseParent||i:null,null!=o&&null!=i&&o.id===i.id)||(o=n.el,this.instance.getId(o),this.instance.proxyConnection(t,e,o,function(t,e){return n.getEndpoint(t,e)},function(t,e){return n.getAnchor(t,e)}),0))}},{key:"_expandConnection",value:function(t,e,n){this.instance.unproxyConnection(t,e)}},{key:"isElementDescendant",value:function(t,e){for(var n=this.instance.getContainer();;){if(null==t||t===n)return!1;if(t===e)return!0;t=t.parentNode}}},{key:"collapseGroup",value:function(t){var o,e,s=this,r=this.getGroup(t);null==r||r.collapsed||(t=r.el,null==r.collapseParent?(this.instance.setGroupVisible(r,!1),r.collapsed=!0,this.instance.removeClass(t,on),this.instance.addClass(t,nn),r.proxied&&(o=new Set,(e=function(t,e){for(var n=0;n<t.length;n++){var i=t[n];!0===s._collapseConnection(i,e,r)&&o.add(i.id)}})(r.connections.source,0),e(r.connections.target,1),y(r.getGroups(),function(t){s.cascadeCollapse(r,t,o)})),this.instance.revalidate(t),this.repaintGroup(r),this.instance.fire(gn,{group:r})):(r.collapsed=!0,this.instance.removeClass(t,on),this.instance.addClass(t,nn)))}},{key:"cascadeCollapse",value:function(o,t,s){var e,r=this;o.proxied&&((e=function(t,e){for(var n=0;n<t.length;n++){var i=t[n];s.has(i.id)||!0===r._collapseConnection(i,e,o)&&s.add(i.id)}})(t.connections.source,0),e(t.connections.target,1)),y(t.getGroups(),function(t){r.cascadeCollapse(o,t,s)})}},{key:"expandGroup",value:function(t,e){var n,s=this,o=this.getGroup(t);null!=o&&(t=o.el,null==o.collapseParent?(this.instance.setGroupVisible(o,!0),o.collapsed=!1,this.instance.addClass(t,on),this.instance.removeClass(t,nn),o.proxied&&((n=function(t,e){for(var n=0;n<t.length;n++){var i=t[n];s._expandConnection(i,e,o)}})(o.connections.source,0),n(o.connections.target,1),n=function e(o,t){t||o.collapsed?((t=function(t,e){for(var n=0;n<t.length;n++){var i=t[n];s._collapseConnection(i,e,o.collapseParent||o)}})(o.connections.source,0),t(o.connections.target,1),y(o.connections.internal,function(t){t.setVisible(!1)}),y(o.getGroups(),function(t){e(t,!0)})):s.expandGroup(o,!0)},y(o.getGroups(),n)),this.instance.revalidate(t),this.repaintGroup(o),e||this.instance.fire(mn,{group:o})):(o.collapsed=!1,this.instance.addClass(t,on),this.instance.removeClass(t,nn)))}},{key:"toggleGroup",value:function(t){null!=(t=this.getGroup(t))&&(t.collapsed?this.expandGroup(t):this.collapseGroup(t))}},{key:"repaintGroup",value:function(t){for(var e=this.getGroup(t).children,n=0;n<e.length;n++)this.instance.revalidate(e[n].el)}},{key:"addToGroup",value:function(t,a){var l=this,c=this.getGroup(t);if(c){for(var u=c.el,e=arguments.length,n=new Array(2<e?e-2:0),i=2;i<e;i++)n[i-2]=arguments[i];y(n,function(t){var e,n,i,o=null!=t._isJsPlumbGroup,s=t._jsPlumbGroup,r=t._jsPlumbParentGroup;r!==c&&(i=l.instance.manage(t),e=l.instance.getOffset(t),n=c.collapsed?l.instance.getOffsetRelativeToRoot(u):l.instance.getOffset(l.instance.getGroupContentArea(c)),i.group=c.elId,null!=r&&(r.remove(t,!1,a,!1,c),l._updateConnectionsForGroup(r)),o?c.addGroup(s):c.add(t,a),i=function(t,e){var n=0===e?1:0;t.each(function(t){t.setVisible(!1),t.endpoints[n].element._jsPlumbGroup===c?(t.endpoints[n].setVisible(!1),l._expandConnection(t,n,c)):(t.endpoints[e].setVisible(!1),l._collapseConnection(t,e,c))})},c.collapsed&&(i(l.instance.select({source:t}),0),i(l.instance.select({target:t}),1)),l.instance.getId(t),o={x:e.x-n.x,y:e.y-n.y},l.instance.setPosition(t,o),l._updateConnectionsForGroup(c),l.instance.revalidate(t),a||(s={group:c,el:t,pos:o},r&&(s.sourceGroup=r),l.instance.fire(_n,s)))})}}},{key:"removeFromGroup",value:function(t,e){var a=this,l=this.getGroup(t);if(l){for(var n=arguments.length,i=new Array(2<n?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];y(i,function(r){l.collapsed&&((t=function(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(i.proxies)for(var o,s=0;s<i.proxies.length;s++)null==i.proxies[s]||(o=i.proxies[s].originalEp.element)!==r&&!a.isElementDescendant(o,r)||a._expandConnection(i,e,l)}})(l.connections.source.slice(),0),t(l.connections.target.slice(),1)),l.remove(r,null,e);var t=a.instance.getManagedElements()[a.instance.getId(r)];t&&delete t.group})}}},{key:"getAncestors",value:function(t){for(var e=[],n=t.group;null!=n;)e.push(n),n=n.group;return e}},{key:"isAncestor",value:function(t,e){return null!=t&&null!=e&&-1!==this.getAncestors(t).indexOf(e)}},{key:"getDescendants",value:function(t){var n=[];return function t(e){e=e.getGroups();n.push.apply(n,te(e)),y(e,t)}(t),n}},{key:"isDescendant",value:function(t,e){return null!=t&&null!=e&&-1!==this.getDescendants(e).indexOf(t)}},{key:"reset",value:function(){this._connectionSourceMap={},this._connectionTargetMap={},this.groupMap={}}}]);var Ui=Xi;function Xi(t){var s=this;c(this,Xi),this.instance=t,b(this,"groupMap",{}),b(this,"_connectionSourceMap",{}),b(this,"_connectionTargetMap",{}),t.bind(ln,function(t){var e=s.getGroupFor(t.source),n=s.getGroupFor(t.target);null!=e&&null!=n&&e===n?(s._connectionSourceMap[t.connection.id]=e,ot((s._connectionTargetMap[t.connection.id]=e).connections.internal,t.connection)):(null!=e&&(t.target._jsPlumbGroup===e?ot(e.connections.internal,t.connection):ot(e.connections.source,t.connection),s._connectionSourceMap[t.connection.id]=e),null!=n&&(t.source._jsPlumbGroup===n?ot(n.connections.internal,t.connection):ot(n.connections.target,t.connection),s._connectionTargetMap[t.connection.id]=n))}),t.bind(fn,function(t){s._cleanupDetachedConnection(t.connection)}),t.bind(un,function(t){var e=t.originalEndpoint.element,e=s.getGroupFor(e),n=t.connection.endpoints[t.index].element,n=s.getGroupFor(n),i=0===t.index?s._connectionSourceMap:s._connectionTargetMap,o=0===t.index?s._connectionTargetMap:s._connectionSourceMap;null!=n?(i[t.connection.id]=n,t.connection.source===t.connection.target&&(o[t.connection.id]=n)):(delete i[t.connection.id],t.connection.source===t.connection.target&&delete o[t.connection.id]),null!=e&&s._updateConnectionsForGroup(e),null!=n&&s._updateConnectionsForGroup(n)})}t(Yi,[{key:"length",get:function(){return this.entries.length}},{key:"each",value:function(e){return y(this.entries,function(t){e(t)}),this}},{key:"get",value:function(t){return this.entries[t]}},{key:"addClass",value:function(e,n){return this.each(function(t){return t.addClass(e,n)}),this}},{key:"removeClass",value:function(e,n){return this.each(function(t){return t.removeClass(e,n)}),this}},{key:"removeAllOverlays",value:function(){return this.each(function(t){return t.removeAllOverlays()}),this}},{key:"setLabel",value:function(e){return this.each(function(t){return t.setLabel(e)}),this}},{key:"clear",value:function(){return this.entries.length=0,this}},{key:"map",value:function(e){var n=[];return this.each(function(t){return n.push(e(t))}),n}},{key:"addOverlay",value:function(e){return this.each(function(t){return t.addOverlay(e)}),this}},{key:"removeOverlay",value:function(e){return this.each(function(t){return t.removeOverlay(e)}),this}},{key:"removeOverlays",value:function(){return this.each(function(t){return t.removeOverlays()}),this}},{key:"showOverlay",value:function(e){return this.each(function(t){return t.showOverlay(e)}),this}},{key:"hideOverlay",value:function(e){return this.each(function(t){return t.hideOverlay(e)}),this}},{key:"setPaintStyle",value:function(e){return this.each(function(t){return t.setPaintStyle(e)}),this}},{key:"setHoverPaintStyle",value:function(e){return this.each(function(t){return t.setHoverPaintStyle(e)}),this}},{key:"setSuspendEvents",value:function(e){return this.each(function(t){return t.setSuspendEvents(e)}),this}},{key:"setParameter",value:function(e,n){return this.each(function(t){return t.parameters[e]=n}),this}},{key:"setParameters",value:function(e){return this.each(function(t){return t.parameters=e}),this}},{key:"setVisible",value:function(e){return this.each(function(t){return t.setVisible(e)}),this}},{key:"addType",value:function(e){return this.each(function(t){return t.addType(e)}),this}},{key:"toggleType",value:function(e){return this.each(function(t){return t.toggleType(e)}),this}},{key:"removeType",value:function(e){return this.each(function(t){return t.removeType(e)}),this}},{key:"bind",value:function(e,n){return this.each(function(t){return t.bind(e,n)}),this}},{key:"unbind",value:function(e,n){return this.each(function(t){return t.unbind(e,n)}),this}},{key:"setHover",value:function(e){var n=this;return this.each(function(t){return n.instance.setHover(t,e)}),this}}]);a=Yi;function Yi(t,e){c(this,Yi),this.instance=t,this.entries=e}e(qi,a),zi=n(qi),t(qi,[{key:"setEnabled",value:function(e){return this.each(function(t){return t.enabled=e}),this}},{key:"setAnchor",value:function(e){return this.each(function(t){return t.setAnchor(e)}),this}},{key:"deleteEveryConnection",value:function(){return this.each(function(t){return t.deleteEveryConnection()}),this}},{key:"deleteAll",value:function(){var e=this;return this.each(function(t){return e.instance.deleteEndpoint(t)}),this.clear(),this}}]);var zi,Wi=qi;function qi(){return c(this,qi),zi.apply(this,arguments)}e(Zi,a),Ji=n(Zi),t(Zi,[{key:"setDetachable",value:function(e){return this.each(function(t){return t.setDetachable(e)}),this}},{key:"setReattach",value:function(e){return this.each(function(t){return t.setReattach(e)}),this}},{key:"setConnector",value:function(e){return this.each(function(t){return t.setConnector(e)}),this}},{key:"deleteAll",value:function(){var e=this;this.each(function(t){return e.instance.deleteConnection(t)}),this.clear()}},{key:"repaint",value:function(){var e=this;return this.each(function(t){return e.instance._paintConnection(t)}),this}}]);var Ji,Ki=Zi;function Zi(){return c(this,Zi),Ji.apply(this,arguments)}function $i(){c(this,$i),b(this,"affectedElements",new Set)}function Qi(){return{x:0,y:0,w:0,h:0,r:0,c:{x:0,y:0},x2:0,y2:0,t:{x:0,y:0,c:{x:0,y:0},w:0,h:0,r:0,x2:0,y2:0,cr:0,sr:0},dirty:!0}}function to(t,e,n,i,o){function s(t,e){return{x:r+Math.round((t-r)*l-(e-a)*c),y:a+Math.round((e-a)*l-(t-r)*c)}}var r=t+n/2,a=e+i/2,l=Math.cos(o/360*Math.PI*2),c=Math.sin(o/360*Math.PI*2),u=s(t,e),h=s(t+n,e),d=s(t+n,e+i),p=s(t,e+i),t=s(t+n/2,e+i/2),n=Math.min(u.x,h.x,d.x,p.x),e=Math.max(u.x,h.x,d.x,p.x),i=Math.min(u.y,h.y,d.y,p.y),u=Math.max(u.y,h.y,d.y,p.y);return{x:n,y:i,w:e-n,h:u-i,c:t,r:o,x2:e,y2:u,cr:l,sr:c}}function eo(t,e){var n=0;return e[1]>t[1]?n=-1:e[1]<t[1]&&(n=1),n}function no(t,e){return-1*eo(t,e)}function io(t,e,n,i){ft([t,e],n,eo,i)}function oo(e,t){var n=J(t,function(t){return t[0]===e});-1<n&&t.splice(n,1)}e(ao,kt),so=n(ao),t(ao,[{key:"_updateBounds",value:function(t,e,n){null!=e&&(oo(t,this._sortedElements.xmin),oo(t,this._sortedElements.xmax),oo(t,this._sortedElements.ymin),oo(t,this._sortedElements.ymax),io(t,e.t.x,this._sortedElements.xmin,!1),io(t,e.t.x+e.t.w,this._sortedElements.xmax,!0),io(t,e.t.y,this._sortedElements.ymin,!1),io(t,e.t.y+e.t.h,this._sortedElements.ymax,!0),!0!==n)&&this._recalculateBounds()}},{key:"_recalculateBounds",value:function(){this._bounds.minx=0<this._sortedElements.xmin.length?this._sortedElements.xmin[0][1]:0,this._bounds.maxx=0<this._sortedElements.xmax.length?this._sortedElements.xmax[0][1]:0,this._bounds.miny=0<this._sortedElements.ymin.length?this._sortedElements.ymin[0][1]:0,this._bounds.maxy=0<this._sortedElements.ymax.length?this._sortedElements.ymax[0][1]:0}},{key:"recomputeBounds",value:function(){var n=this;this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.forEach(function(t,e){n._sortedElements.xmin.push([e,t.t.x]),n._sortedElements.xmax.push([e,t.t.x+t.t.w]),n._sortedElements.ymin.push([e,t.t.y]),n._sortedElements.ymax.push([e,t.t.y+t.t.h])}),this._sortedElements.xmin.sort(eo),this._sortedElements.ymin.sort(eo),this._sortedElements.xmax.sort(no),this._sortedElements.ymax.sort(no),this._recalculateBounds()}},{key:"_finaliseUpdate",value:function(t,e,n){e.t=to(e.x,e.y,e.w,e.h,e.r),this._transformedElementMap.set(t,e.t),!0!==n&&this._updateBounds(t,e,n)}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"startTransaction",value:function(){if(null!=this._currentTransaction)throw new Error("Viewport: cannot start transaction; a transaction is currently active.");this._currentTransaction=new $i}},{key:"endTransaction",value:function(){var n=this;null!=this._currentTransaction&&(this._currentTransaction.affectedElements.forEach(function(t){var e=n.getPosition(t);n._finaliseUpdate(t,e,!0)}),this.recomputeBounds(),this._currentTransaction=null)}},{key:"updateElements",value:function(t){var e=this;y(t,function(t){e.updateElement(t.id,t.x,t.y,t.width,t.height,t.rotation)})}},{key:"updateElement",value:function(t,e,n,i,o,s,r){var a=dt(this._elementMap,t,Qi);return a.dirty=null==e&&null==a.x||null==n&&null==a.y||null==i&&null==a.w||null==o&&null==a.h,null!=e&&(a.x=e),null!=n&&(a.y=n),null!=i&&(a.w=i),null!=o&&(a.h=o),null!=s&&(a.r=s||0),a.c.x=a.x+a.w/2,a.c.y=a.y+a.h/2,a.x2=a.x+a.w,a.y2=a.y+a.h,null==this._currentTransaction?this._finaliseUpdate(t,a,r):this._currentTransaction.affectedElements.add(t),a}},{key:"refreshElement",value:function(t,e){var n,i=this.instance.getManagedElements(),i=i[t]?i[t].el:null;return null!=i?(n=this.getSize(i),i=this.getOffset(i),this.updateElement(t,i.x,i.y,n.w,n.h,null,e)):null}},{key:"getSize",value:function(t){return this.instance.getSize(t)}},{key:"getOffset",value:function(t){return this.instance.getOffset(t)}},{key:"registerElement",value:function(t,e){return this.updateElement(t,0,0,0,0,0,e)}},{key:"addElement",value:function(t,e,n,i,o,s){return this.updateElement(t,e,n,i,o,s)}},{key:"rotateElement",value:function(t,e){var n=dt(this._elementMap,t,Qi);return n.r=e||0,this._finaliseUpdate(t,n),n}},{key:"getBoundsWidth",value:function(){return this._bounds.maxx-this._bounds.minx}},{key:"getBoundsHeight",value:function(){return this._bounds.maxy-this._bounds.miny}},{key:"getX",value:function(){return this._bounds.minx}},{key:"getY",value:function(){return this._bounds.miny}},{key:"setSize",value:function(t,e,n){if(this._elementMap.has(t))return this.updateElement(t,null,null,e,n,null)}},{key:"setPosition",value:function(t,e,n){if(this._elementMap.has(t))return this.updateElement(t,e,n,null,null,null)}},{key:"reset",value:function(){this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.clear(),this._transformedElementMap.clear(),this._recalculateBounds()}},{key:"remove",value:function(t){oo(t,this._sortedElements.xmin),oo(t,this._sortedElements.xmax),oo(t,this._sortedElements.ymin),oo(t,this._sortedElements.ymax),this._elementMap.delete(t),this._transformedElementMap.delete(t),this._recalculateBounds()}},{key:"getPosition",value:function(t){return this._elementMap.get(t)}},{key:"getElements",value:function(){return this._elementMap}},{key:"isEmpty",value:function(){return 0===this._elementMap.size}}]);var so,ro=ao;function ao(t){var e;return c(this,ao),(e=so.call(this)).instance=t,b(u(e),"_currentTransaction",null),b(u(e),"_sortedElements",{xmin:[],xmax:[],ymin:[],ymax:[]}),b(u(e),"_elementMap",new Map),b(u(e),"_transformedElementMap",new Map),b(u(e),"_bounds",{minx:0,maxx:0,miny:0,maxy:0}),e}t(lo,[{key:"setEnabled",value:function(t){this.def.enabled=t}},{key:"isEnabled",value:function(){return!1!==this.def.enabled}}]);fi=lo;function lo(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];c(this,lo),this.selector=t,this.def=e,this.exclude=n,b(this,"id",void 0),this.id=T()}e(ho,fi),co=n(ho);var co,uo=ho;function ho(t,e,n){return c(this,ho),(t=co.call(this,t,e,n)).def=e,b(u(t),"redrop",void 0),t.redrop=e.def.redrop||"strict",t}e(yo,fi),po=n(yo);var po,fo=yo;function yo(t,e,n){return c(this,yo),(t=po.call(this,t,e,n)).def=e,t}function vo(t,e){return e.theta-t.theta}function go(t,e){return(t.theta<0?-Math.PI-t.theta:Math.PI-t.theta)-(e.theta<0?-Math.PI-e.theta:Math.PI-e.theta)}b(d={},w,go),b(d,C,vo),b(d,S,vo),b(d,k,go);var mo=d;function _o(t){return!0===t.isContinuous}function xo(t){return!0===t.isContinuous}function Eo(t){return 1<t.locations.length}function bo(t){return[t.currentLocation,t.locations[t.currentLocation]]}t(Co,[{key:"getAnchorOrientation",value:function(t){t=this.anchorLocations.get(t.id);return t?[t.ox,t.oy]:[0,0]}},{key:"_distance",value:function(t,e,n,i,o,s,r){var a=i.x+t.x*o.w,t=i.y+t.y*o.h,l=i.x+o.w/2,i=i.y+o.h/2;return null!=s&&0<s.length&&(a=(o=this.instance._applyRotations([a,t,0,0],s)).x,t=o.y),Math.sqrt(Math.pow(e-a,2)+Math.pow(n-t,2))+Math.sqrt(Math.pow(l-a,2)+Math.pow(i-t,2))}},{key:"_anchorSelector",value:function(t,e,n,i,o,s,r){for(var a=n.x+i.w/2,l=n.y+i.h/2,c=-1,u=1/0,h=0;h<r.length;h++){var d=this._distance(r[h],a,l,t,e,o,s);d<u&&(c=h+0,u=d)}return[c,r[c]]}},{key:"_floatingAnchorCompute",value:function(t,e){e=e.xy,e={curX:e.x+t.size.w/2,curY:e.y+t.size.h/2,x:0,y:0,ox:0,oy:0};return this._setComputedPosition(t,e)}},{key:"_setComputedPosition",value:function(t,e,n){return this.anchorLocations.set(t.id,e),t.computedPosition=e,n&&(t.timestamp=n),e}},{key:"_computeSingleLocation",value:function(t,e,n,i){var o,s,e={curX:e.x+t.x*n.w+t.offx,curY:e.y+t.y*n.h+t.offy,x:t.x,y:t.y,ox:0,oy:0},n=i.rotation,i=null!=n&&0<n.length?(o=[t.iox,t.ioy],s={x:e.curX,y:e.curY,cr:0,sr:0},y(n,function(t){s=rt(s,t.c,t.r);t=[Math.round(o[0]*s.cr-o[1]*s.sr),Math.round(o[1]*s.cr+o[0]*s.sr)];o=t.slice()}),t.ox=o[0],t.oy=o[1],{curX:s.x,curY:s.y,x:t.x,y:t.y,ox:o[0],oy:o[1]}):(t.ox=t.iox,t.oy=t.ioy,p({ox:t.iox,oy:t.ioy},e));return i}},{key:"_singleAnchorCompute",value:function(t,e){var n,i,o=e.xy,s=e.wh,r=e.timestamp;return null!=(i=this.anchorLocations.get(t.id))&&r&&r===t.timestamp?i:((n=Qt(bo(t),2))[0],n=n[1],i=this._computeSingleLocation(n,o,s,e),this._setComputedPosition(t,i,r))}},{key:"_defaultAnchorCompute",value:function(t,e){var n,i,o,s,r,a;return 1===t.locations.length?this._singleAnchorCompute(t,e):(n=e.xy,i=e.wh,s=e.txy,r=e.twh,o=(a=Qt(bo(t),2))[0],a=a[1],a=t.locked||null==s||null==r?this._computeSingleLocation(a,n,i,e):(s=(a=Qt(this._anchorSelector(n,i,s,r,e.rotation,e.tRotation,t.locations),2))[0],r=a[1],(t.currentLocation=s)!==o&&(t.cssClass=r.cls||t.cssClass,e.element._anchorLocationChanged(t)),this._computeSingleLocation(r,n,i,e)),this._setComputedPosition(t,a,e.timestamp))}},{key:"_placeAnchors",value:function(c,t){function e(t,e,n,i,o,s){if(0<n.length)for(var n=n.sort(mo[t]),r=function(t,e,n,i,o){for(var s=n?t.w:t.h,r=n?t.h:t.w,a=[],l=s/(e.length+1),c=0;c<e.length;c++){var u,h=(c+1)*l,d=i*r,p=(o&&(h=s-h),n?h:d),f=t.x+p,p=p/t.w,d=n?d:h,h=t.y+d,d=d/t.h;0!==t.r&&null!=t.r&&(f=(u=rt({x:f,y:h},t.c,t.r)).x,h=u.y),a.push({x:f,y:h,xLoc:p,yLoc:d,c:e[c].c})}return a}(h,n,i,o,t===C||t===w),a=0;a<r.length;a++){var l=r[a].c,l=l.endpoints[0].elementId===c?l.endpoints[0]:l.endpoints[1];u._setComputedPosition(l._anchor,{curX:r[a].x,curY:r[a].y,x:r[a].xLoc,y:r[a].yLoc,ox:s[0],oy:s[1]})}}var u=this,h=this.instance.viewport.getPosition(c);e(S,0,t.bottom,!0,1,[0,1]),e(w,0,t.top,!0,0,[0,-1]),e(k,0,t.left,!1,0,[-1,0]),e(C,0,t.right,!1,1,[1,0])}},{key:"_updateAnchorList",value:function(t,e,n,i,o,s,r,a,l,c,u){var h,d=i.endpoints[r],p=d.id,f=[1,0][r],e={theta:e,order:n,c:i,b:o,elId:s,epId:p},y=t[l],v=d._continuousAnchorEdge?t[d._continuousAnchorEdge]:null;if(v){n=J(v,function(t){return t.epId===p});if(-1!==n){v.splice(n,1);for(var g=0;g<v.length;g++)!0!==(h=v[g].c).placeholder&&c.add(h),u.add(v[g].c.endpoints[r]),u.add(v[g].c.endpoints[f])}}for(var m=0;m<y.length;m++)!0!==(h=y[m].c).placeholder&&c.add(h),u.add(y[m].c.endpoints[r]),u.add(y[m].c.endpoints[f]);i=a?0:y.length;y.splice(i,0,e),d._continuousAnchorEdge=l}},{key:"_removeEndpointFromAnchorLists",value:function(t){var e,n,i=this.anchorLists.get(t.elementId),o=0;i=i,e=t.id,i&&(v(i.top,n=function(t){return t.epId===e}),v(i.left,n),v(i.bottom,n),v(i.right,n),o=(o=(o=(o+=i.top.length)+i.left.length)+i.bottom.length)+i.right.length),0===o&&this.anchorLists.delete(t.elementId),this.anchorLocations.delete(t._anchor.id)}},{key:"computeAnchorLocation",value:function(t,e){var n=_o(t)?this.anchorLocations.get(t.id)||{curX:0,curY:0,x:0,y:0,ox:0,oy:0}:xo(t)?this._floatingAnchorCompute(t,e):this._defaultAnchorCompute(t,e);return t.timestamp=e.timestamp,n}},{key:"computePath",value:function(t,e){var n=this.instance.viewport.getPosition(t.sourceId),i=this.instance.viewport.getPosition(t.targetId),o=t.endpoints[0],s=t.endpoints[1],o=this.getEndpointLocation(o,{xy:n,wh:n,element:o,timestamp:e,rotation:this.instance._getRotations(t.sourceId)}),s=this.getEndpointLocation(s,{xy:i,wh:i,element:s,timestamp:e,rotation:this.instance._getRotations(t.targetId)});t.connector.resetBounds(),t.connector.compute({sourcePos:o,targetPos:s,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1],strokeWidth:t.paintStyleInUse.strokeWidth,sourceInfo:n,targetInfo:i})}},{key:"getEndpointLocation",value:function(t,e){e=e||{};var t=t._anchor,n=this.anchorLocations.get(t.id);return(null==n||null!=e.timestamp&&t.timestamp!==e.timestamp)&&(n=this.computeAnchorLocation(t,e),this._setComputedPosition(t,n,e.timestamp)),n}},{key:"getEndpointOrientation",value:function(t){return t._anchor?this.getAnchorOrientation(t._anchor):[0,0]}},{key:"setAnchorOrientation",value:function(t,e){t=this.anchorLocations.get(t.id);null!=t&&(t.ox=e[0],t.oy=e[1])}},{key:"isDynamicAnchor",value:function(t){return!!t._anchor&&!_o(t._anchor)&&1<t._anchor.locations.length}},{key:"isFloating",value:function(t){return!!t._anchor&&xo(t._anchor)}},{key:"prepareAnchor",value:ki},{key:"redraw",value:function(t,n,e){var i=this,o=new Set,s=new Set,r=new Set;if(!this.instance._suspendDrawing){for(var a,l,c=this.instance.endpointsByElement[t]||[],u=(n=n||T(),{}),h=0;h<c.length;h++)if(l=c[h],s.add(l),a=l._anchor,0===l.connections.length)_o(a)&&(this.anchorLists.has(t)||this.anchorLists.set(t,{top:[],right:[],bottom:[],left:[]}),this._updateAnchorList(this.anchorLists.get(t),-Math.PI/2,0,{endpoints:[l,l],placeholder:!0},!1,t,0,!1,ui(a),o,s),r.add(t));else for(var d=0;d<l.connections.length;d++){var p=l.connections[d],f=p.sourceId,y=p.targetId,v=_o(p.endpoints[0]._anchor),g=_o(p.endpoints[1]._anchor);if(v||g){var m,_,x=[f,(p.endpoints[0]._anchor.faces||[]).join("-"),y,(p.endpoints[1]._anchor.faces||[]).join("-")].join("-"),E=u[x],b=p.sourceId===t?1:0,k=(v&&!this.anchorLists.has(f)&&this.anchorLists.set(f,{top:[],right:[],bottom:[],left:[]}),g&&!this.anchorLists.has(y)&&this.anchorLists.set(y,{top:[],right:[],bottom:[],left:[]}),this.instance.viewport.getPosition(y)),C=this.instance.viewport.getPosition(f);y===f&&(v||g)?(this._updateAnchorList(this.anchorLists.get(f),-Math.PI/2,0,p,!1,y,0,!1,w,o,s),this._updateAnchorList(this.anchorLists.get(y),-Math.PI/2,0,p,!1,f,1,!1,w,o,s)):(m=this.instance._getRotations(f),_=this.instance._getRotations(y),E||(E=this._calculateOrientation(f,y,C,k,p.endpoints[0]._anchor,p.endpoints[1]._anchor,m,_),u[x]=E),v&&this._updateAnchorList(this.anchorLists.get(f),E.theta,0,p,!1,y,0,!1,E.a[0],o,s),g&&this._updateAnchorList(this.anchorLists.get(y),E.theta2,-1,p,!0,f,1,!0,E.a[1],o,s)),v&&r.add(f),g&&r.add(y),o.add(p),(v&&0==b||g&&1==b)&&s.add(p.endpoints[b])}else{var S=l.connections[d].endpoints[p.sourceId===t?1:0];if(Eo(S._anchor)){this.instance._paintEndpoint(S,{elementWithPrecedence:t,timestamp:n}),o.add(l.connections[d]);for(var P=0;P<S.connections.length;P++)S.connections[P]!==l.connections[d]&&o.add(S.connections[P])}else o.add(l.connections[d])}}r.forEach(function(t){i._placeAnchors(t,i.anchorLists.get(t))}),s.forEach(function(t){var e=i.instance.viewport.getPosition(t.elementId);i.instance._paintEndpoint(t,{timestamp:n,offset:e})}),o.forEach(function(t){i.instance._paintConnection(t,{timestamp:n})})}return{c:o,e:s}}},{key:"reset",value:function(){this.anchorLocations.clear(),this.anchorLists.clear()}},{key:"setAnchor",value:function(t,e){null!=e&&(t._anchor=e)}},{key:"setConnectionAnchors",value:function(t,e){t.endpoints[0]._anchor=e[0],t.endpoints[1]._anchor=e[1]}},{key:"_calculateOrientation",value:function(t,e,n,i,o,s,r,a){var l=this;if(t===e)return{orientation:"identity",a:[w,w]};for(var c,t=Math.atan2(i.c.y-n.c.y,i.c.x-n.c.x),e=Math.atan2(n.c.y-i.c.y,n.c.x-i.c.x),u=[],h={},d=[Ie,je],p=[[n,r],[i,a]],f=0;f<d.length;f++)if(h[d[f]]=(b(c={},k,{x:p[f][0].x,y:p[f][0].c.y}),b(c,C,{x:p[f][0].x+p[f][0].w,y:p[f][0].c.y}),b(c,w,{x:p[f][0].c.x,y:p[f][0].y}),b(c,S,{x:p[f][0].c.x,y:p[f][0].y+p[f][0].h}),c),null!=p[f][1]&&0<p[f][1].length)for(var y in h[d[f]])h[d[f]][y]=l.instance._applyRotationsXY(h[d[f]][y],p[f][1]);for(var v=[w,k,C,S],g=0;g<v.length;g++)for(var m=0;m<v.length;m++)u.push({source:v[g],target:v[m],dist:Dt(h.source[v[g]],h.target[v[m]])});u.sort(function(t,e){var n,i,o;return t.dist<e.dist?-1:e.dist<t.dist?1:(b(o={},k,0),b(o,w,1),b(o,C,2),b(o,S,3),n=o[t.source],i=o[e.source],t=o[t.target],o=o[e.target],n<i?-1:i<n?1:t<o?-1:o<t?1:0)});for(var _=u[0].source,x=u[0].target,E=0;E<u.length&&(_=_o(o)&&o.locked?o.currentFace:!o.isContinuous||di(o,u[E].source)?u[E].source:null,x=s.isContinuous&&s.locked?s.currentFace:!s.isContinuous||di(s,u[E].target)?u[E].target:null,null==_||null==x);E++);return o.isContinuous&&this.setCurrentFace(o,_),s.isContinuous&&this.setCurrentFace(s,x),{a:[_,x],theta:t,theta2:e}}},{key:"setCurrentFace",value:function(t,e,n){t.currentFace=e,n&&null!=t.lockedFace&&(t.lockedFace=t.currentFace)}},{key:"lock",value:function(t){t.locked=!0,_o(t)&&(t.lockedFace=t.currentFace)}},{key:"unlock",value:function(t){t.locked=!1,_o(t)&&(t.lockedFace=null)}},{key:"selectAnchorLocation",value:function(t,e){var n=J(t.locations,function(t){return t.x===e.x&&t.y===e.y});return-1!==n&&(t.currentLocation=n,!0)}},{key:"lockCurrentAxis",value:function(t){null!=t.currentFace&&(t.lockedAxis=t.currentFace===k||t.currentFace===C?ii:oi)}},{key:"unlockCurrentAxis",value:function(t){t.lockedAxis=null}},{key:"anchorsEqual",value:function(t,e){return!(!t||!e)&&(t=t.locations[t.currentLocation],e=e.locations[e.currentLocation],t.x===e.x)&&t.y===e.y&&t.offx===e.offx&&t.offy===e.offy&&t.ox===e.ox&&t.oy===e.oy}}]);var ko=Co;function Co(t){var e=this;c(this,Co),this.instance=t,b(this,"anchorLists",new Map),b(this,"anchorLocations",new Map),t.bind(fn,function(t){t.sourceEndpoint._anchor.isContinuous&&e._removeEndpointFromAnchorLists(t.sourceEndpoint),t.targetEndpoint._anchor.isContinuous&&e._removeEndpointFromAnchorLists(t.targetEndpoint)}),t.bind(pn,function(t){e._removeEndpointFromAnchorLists(t)})}function So(e,t,n){function i(t){return f(t)?t:e.getId(t)}var o=[];if(t)if("string"==typeof t){if("*"===t)return t;o.push(t)}else n?o=t:null!=t.length?o.push.apply(o,te(te(t).map(i))):o.push(i(t));return o}function Po(t,e,n){null!=e&&(e.connections.push(t),1===e.connections.length)&&t.instance.addClass(t.source,t.instance.connectedClass),null==n||null!=e&&t.sourceId===t.targetId||(n.connections.push(t),1===n.connections.length&&t.instance.addClass(t.target,t.instance.connectedClass))}function To(e,t,n){var i;null!=t&&(i=t.connections.length,v(t.connections,function(t){return e.id===t.id}),0<i)&&0===t.connections.length&&e.instance.removeClass(e.source,e.instance.connectedClass),null!=n&&(i=n.connections.length,null!=t&&e.sourceId===e.targetId||v(n.connections,function(t){return e.id===t.id}),0<i)&&0===n.connections.length&&e.instance.removeClass(e.target,e.instance.connectedClass)}e(Ao,kt),wo=n(Ao),t(Ao,[{key:"defaultScope",get:function(){return this.DEFAULT_SCOPE}},{key:"currentZoom",get:function(){return this._zoom}},{key:"areDefaultAnchorsSet",value:function(){return this.validAnchorsSpec(this.defaults.anchors)}},{key:"validAnchorsSpec",value:function(t){return null!=t&&null!=t[0]&&null!=t[1]}},{key:"getContainer",value:function(){return this._container}},{key:"setZoom",value:function(t,e){return this._zoom=t,this.fire(Pn,this._zoom),e&&this.repaintEverything(),!0}},{key:"_idstamp",value:function(){return""+this._curIdStamp++}},{key:"checkCondition",value:function(e,t){var n=this.getListener(e),i=!0;if(n&&0<n.length){var o=Array.prototype.slice.call(arguments,1);try{for(var s=0,r=n.length;s<r;s++)i=i&&n[s].apply(n[s],o)}catch(t){l("cannot check condition ["+e+"]"+t)}}return i}},{key:"getId",value:function(t,e){var n;return null==t?null:((n=this.getAttribute(t,Be))&&"undefined"!==n||(2===arguments.length&&void 0!==e?n=e:1!==arguments.length&&(3!==arguments.length||arguments[2])||(n="jsplumb-"+this._instanceIndex+"-"+this._idstamp()),this.setAttribute(t,Be,n)),n)}},{key:"getConnections",value:function(t,e){t?t.constructor===String&&(t={scope:t}):t={};for(var n=So(this,t.scope||this.defaultScope,!0),i=So(this,t.source),o=So(this,t.target),s=!e&&1<n.length?{}:[],r=0,a=this.connections.length;r<a;r++){var l=this.connections[r],c=l.proxies&&l.proxies[0]?l.proxies[0].originalEp.elementId:l.sourceId,u=l.proxies&&l.proxies[1]?l.proxies[1].originalEp.elementId:l.targetId;L(n,l.scope)&&L(i,c)&&L(o,u)&&(c=l.scope,u=l,l=void 0,(!e&&1<n.length?l=null==(l=s[c])?s[c]=[]:l:s).push(u))}return s}},{key:"select",value:function(t){return(t=t||{}).scope=t.scope||"*",new Ki(this,t.connections||this.getConnections(t,!0))}},{key:"selectEndpoints",value:function(t){(t=t||{}).scope=t.scope||Jt;var e,n=!t.element&&!t.source&&!t.target,i=n?Jt:So(this,t.element),o=n?Jt:So(this,t.source),s=n?Jt:So(this,t.target),r=So(this,t.scope,!0),a=[];for(e in this.endpointsByElement){var l=L(i,e,!0),c=L(o,e,!0),u="*"!==o,h=L(s,e,!0),d="*"!==s;if(l||c||h)for(var p=0,f=this.endpointsByElement[e].length;p<f;p++){var y,v,g=this.endpointsByElement[e][p];L(r,g.scope,!0)&&(y=u&&0<o.length&&!g.isSource,v=d&&0<s.length&&!g.isTarget,y||v||a.push(g))}}return new Wi(this,a)}},{key:"setContainer",value:function(t){this._container=t,this.fire(hn,this._container)}},{key:"_set",value:function(t,e,n){var i,o,s=[{el:"source",elId:"sourceId"},{el:"target",elId:"targetId"}][n],r=t[s.elId],a=t.endpoints[n],r={index:n,originalEndpoint:a,originalSourceId:0===n?r:t.sourceId,newSourceId:t.sourceId,originalTargetId:1===n?r:t.targetId,newTargetId:t.targetId,connection:t,newEndpoint:a};return e instanceof Gi?(i=e).addConnection(t):i=(o=this.getId(e))===t[s.elId]?null:t.makeEndpoint(0===n,e,o),null!=i&&(r.newEndpoint=i,a.detachFromConnection(t),t.endpoints[n]=i,t[s.el]=i.element,t[s.elId]=i.elementId,r[0===n?"newSourceId":"newTargetId"]=i.elementId,this.fireMoveEvent(r),this._paintConnection(t)),r}},{key:"setSource",value:function(t,e){To(t,this._managedElements[t.sourceId]);e=this._set(t,e,0);Po(t,this._managedElements[e.newSourceId])}},{key:"setTarget",value:function(t,e){To(t,this._managedElements[t.targetId]);e=this._set(t,e,1);Po(t,this._managedElements[e.newTargetId])}},{key:"isHoverSuspended",value:function(){return this.hoverSuspended}},{key:"setSuspendDrawing",value:function(t,e){var n=this._suspendDrawing;return(this._suspendDrawing=t)?this._suspendedAt=""+(new Date).getTime():(this._suspendedAt=null,this.viewport.recomputeBounds()),e&&this.repaintEverything(),n}},{key:"getSuspendedAt",value:function(){return this._suspendedAt}},{key:"batch",value:function(t,e){var n=!0===this._suspendDrawing;n||this.setSuspendDrawing(!0),t(),n||this.setSuspendDrawing(!1,!e)}},{key:"each",value:function(t,e){if(null!=t){if(null!=t.length)for(var n=0;n<t.length;n++)e(t[n]);else e(t);return this}}},{key:"updateOffset",value:function(t){var e=t.elId;return t.recalc?this.viewport.refreshElement(e):this.viewport.getPosition(e)}},{key:"deleteConnection",value:function(e,t){var n,i;if(null!=e&&!0!==e.deleted&&((t=t||{}).force||W(!0,!1,[[e.endpoints[0],Tn,[e]],[e.endpoints[1],Tn,[e]],[e,Tn,[e]],[this,Ye,[On,e]]])))return To(e,this._managedElements[e.sourceId],this._managedElements[e.targetId]),this.fireDetachEvent(e,!e.pending&&!1!==t.fireEvent,t.originalEvent),n=e.endpoints[0],i=e.endpoints[1],n!==t.endpointToIgnore&&n.detachFromConnection(e,null,!0),i!==t.endpointToIgnore&&i.detachFromConnection(e,null,!0),v(this.connections,function(t){return e.id===t.id}),e.destroy(),n!==t.endpointToIgnore&&n.deleteOnEmpty&&0===n.connections.length&&this.deleteEndpoint(n),i!==t.endpointToIgnore&&i.deleteOnEmpty&&0===i.connections.length&&this.deleteEndpoint(i),!0;return!1}},{key:"deleteEveryConnection",value:function(e){var n=this,i=(e=e||{},this.connections.length),o=0;return this.batch(function(){for(var t=0;t<i;t++)o+=n.deleteConnection(n.connections[0],e)?1:0}),o}},{key:"deleteConnectionsForElement",value:function(t,e){var t=this.getId(t),n=this._managedElements[t];if(n)for(var i=n.connections.length,o=0;o<i;o++)this.deleteConnection(n.connections[0],e);return this}},{key:"fireDetachEvent",value:function(t,e,n){t=null!=t.id?{connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]}:t;e&&this.fire(cn,t,n),this.fire(fn,t,n)}},{key:"fireMoveEvent",value:function(t,e){this.fire(un,t,e)}},{key:"manageAll",value:function(t,e){for(var n=f(t)?this.getSelector(this.getContainer(),t):t,i=0;i<n.length;i++)this.manage(n[i],null,e)}},{key:"manage",value:function(t,e,n){null==this.getAttribute(t,Be)&&(e=e||this.getAttribute(t,"id")||T(),this.setAttribute(t,Be,e));e=this.getId(t);return this._managedElements[e]?n&&(this._managedElements[e].viewportElement=this.updateOffset({elId:e,timestamp:null,recalc:!0})):(this._managedElements[e]=n={el:t,endpoints:[],connections:[],rotation:0,data:{}},this._suspendDrawing?n.viewportElement=this.viewport.registerElement(e,!0):n.viewportElement=this.updateOffset({elId:e,recalc:!0}),this.fire(yn,{el:t})),this._managedElements[e]}},{key:"getManagedData",value:function(t,e,n){if(this._managedElements[t])return null!=(t=this._managedElements[t].data[e])?t[n]:null}},{key:"setManagedData",value:function(t,e,n,i){this._managedElements[t]&&(this._managedElements[t].data[e]=this._managedElements[t].data[e]||{},this._managedElements[t].data[e][n]=i)}},{key:"getManagedElement",value:function(t){return this._managedElements[t]?this._managedElements[t].el:null}},{key:"unmanage",value:function(t,n){function e(t){var e=i.getId(t);i.removeAttribute(t,Be),delete i._managedElements[e],i.viewport.remove(e),i.fire(Sn,{el:t}),t&&n&&i._removeElement(t)}var i=this;this.removeAllEndpoints(t,!0);this._getAssociatedElements(t).map(e),e(t)}},{key:"rotate",value:function(t,e,n){var i=this.getId(t);return this._managedElements[i]&&(this._managedElements[i].rotation=e,this.viewport.rotateElement(i,e),!0!==n)?this.revalidate(t):{c:new Set,e:new Set}}},{key:"_getRotation",value:function(t){t=this._managedElements[t];return null!=t&&t.rotation||0}},{key:"_getRotations",value:function(t){function e(t){null!=t.group&&null!=(t=n._managedElements[t.group])&&(i.push({r:t.viewportElement.r,c:t.viewportElement.c}),e(t))}var n=this,i=[],t=this._managedElements[t];return null!=t&&(i.push({r:t.viewportElement.r||0,c:t.viewportElement.c}),e(t)),i}},{key:"_applyRotations",value:function(t,e){var t=t.slice(),n={x:t[0],y:t[1],cr:0,sr:0};return y(e,function(t){n=rt(n,t.c,t.r)}),n}},{key:"_applyRotationsXY",value:function(e,t){return y(t,function(t){e=rt(e,t.c,t.r)}),e}},{key:"_internal_newEndpoint",value:function(t){var e,n=p({},t),i=this.manage(n.element),n=(n.elementId=this.getId(n.element),n.id="ep_"+this._idstamp(),new Gi(this,n));return e=n,null!=(i=i)&&i.endpoints.push(e),t.uuid&&this.endpointsByUUID.set(t.uuid,n),it(this.endpointsByElement,n.elementId,n),this._suspendDrawing||this._paintEndpoint(n,{timestamp:this._suspendedAt}),n}},{key:"_deriveEndpointAndAnchorSpec",value:function(t,e){for(var n=((e?"":"default ")+t).split(/[\s]/),i=null,o=null,s=null,r=null,a=0;a<n.length;a++){var l=this.getConnectionType(n[a]);l&&(l.endpoints&&(i=l.endpoints),l.endpoint&&(o=l.endpoint),l.anchors&&(r=l.anchors),l.anchor)&&(s=l.anchor)}return{endpoints:i||[o,o],anchors:r||[s,s]}}},{key:"revalidate",value:function(t,e){var n=this.getId(t);return this.updateOffset({elId:n,recalc:!0,timestamp:e}),this.repaint(t)}},{key:"repaintEverything",value:function(){var t,e=T();for(t in this._managedElements)this.viewport.refreshElement(t,!0);for(t in this.viewport.recomputeBounds(),this._managedElements)this.repaint(this._managedElements[t].el,e,!0);return this}},{key:"setElementPosition",value:function(t,e,n){var i=this.getId(t);return this.viewport.setPosition(i,e,n),this.repaint(t)}},{key:"repaint",value:function(t,e,n){function i(t){t.c.forEach(function(t){return o.c.add(t)}),t.e.forEach(function(t){return o.e.add(t)})}var o={c:new Set,e:new Set};if(!this._suspendDrawing){var s=this.getId(t);if(null!=t){var r=this._getAssociatedElements(t);if(null==e&&(e=T()),!n)for(var a=0;a<r.length;a++)this.updateOffset({elId:this.getId(r[a]),recalc:!0,timestamp:e});if(i(this.router.redraw(s,e,null)),0<r.length)for(var l=0;l<r.length;l++)i(this.router.redraw(this.getId(r[l]),e,null))}}return o}},{key:"unregisterEndpoint",value:function(e){var n,t=e.getUuid(),t=(t&&this.endpointsByUUID.delete(t),t=this._managedElements[e.elementId],n=e,null!=t&&v(t.endpoints,function(t){return t===n}),this.endpointsByElement[e.elementId]);null!=t&&(1<t.length?this.endpointsByElement[e.elementId]=t.filter(function(t){return t!==e}):delete this.endpointsByElement[e.elementId]),this.fire(pn,e)}},{key:"_maybePruneEndpoint",value:function(t){return!(!t.deleteOnEmpty||0!==t.connections.length||(this.deleteEndpoint(t),0))}},{key:"deleteEndpoint",value:function(t){var e,n=this,i="string"==typeof t?this.endpointsByUUID.get(t):t;return i&&(t=i.proxiedBy,y(e=i.connections.slice(),function(t){i.detachFromConnection(t,null,!0)}),this.unregisterEndpoint(i),i.destroy(),y(e,function(t){n.deleteConnection(t,{force:!0,endpointToIgnore:i})}),null!=t)&&this.deleteEndpoint(t),this}},{key:"addEndpoint",value:function(t,e,n){n=p({},n=n||{}),p(n,e||{}),e=p({element:t},n);return this._internal_newEndpoint(e)}},{key:"addEndpoints",value:function(t,e,n){for(var i=[],o=0,s=e.length;o<s;o++)i.push(this.addEndpoint(t,e[o],n));return i}},{key:"reset",value:function(){var t=this;this.silently(function(){t.endpointsByElement={},t._managedElements={},t.endpointsByUUID.clear(),t.viewport.reset(),t.router.reset(),t.groupManager.reset(),t.connections.length=0})}},{key:"destroy",value:function(){this.reset(),this.unbind(),this.sourceSelectors.length=0,this.targetSelectors.length=0,this._connectionTypes.clear(),this._endpointTypes.clear()}},{key:"getEndpoints",value:function(t){return this.endpointsByElement[this.getId(t)]||[]}},{key:"getEndpoint",value:function(t){return this.endpointsByUUID.get(t)}},{key:"setEndpointUuid",value:function(t,e){t.uuid&&this.endpointsByUUID.delete(t.uuid),t.uuid=e,this.endpointsByUUID.set(e,t)}},{key:"connect",value:function(t,e){try{var n=this._prepareConnectionParams(t,e),i=this._newConnection(n);return this._finaliseConnection(i,n),i}catch(t){l(t)}}},{key:"_prepareConnectionParams",value:function(t,e){var n=p({},t),i=(e&&p(n,e),n);if(i.source&&i.source.endpoint&&(i.sourceEndpoint=i.source),i.target&&i.target.endpoint&&(i.targetEndpoint=i.target),t.uuids&&(i.sourceEndpoint=this.getEndpoint(t.uuids[0]),i.targetEndpoint=this.getEndpoint(t.uuids[1])),null!=i.sourceEndpoint){if(i.sourceEndpoint.isFull())throw Mn;if(i.type||(i.type=i.sourceEndpoint.edgeType),console.log("hello world"),i.sourceEndpoint.connectorOverlays){i.overlays=i.overlays||[];for(var o=0,s=i.sourceEndpoint.connectorOverlays.length;o<s;o++)i.overlays.push(i.sourceEndpoint.connectorOverlays[o]),console.log(i.overlays)}i.sourceEndpoint.scope&&(i.scope=i.sourceEndpoint.scope)}else if(null==i.source)throw jn;if(null!=i.targetEndpoint){if(i.targetEndpoint.isFull())throw In}else if(null==i.target)throw Nn;if(i.sourceEndpoint&&i.targetEndpoint&&!function(t,e){for(var n=t.scope.split(/\s/),i=e.scope.split(/\s/),o=0;o<n.length;o++)for(var s=0;s<i.length;s++)if(i[s]===n[o])return 1}(i.sourceEndpoint,i.targetEndpoint))throw"Cannot establish connection: scopes do not match";return i}},{key:"_newConnection",value:function(t){t.id="con_"+this._idstamp();t=new Ii(this,t);return Po(t,this._managedElements[t.sourceId],this._managedElements[t.targetId]),this._paintConnection(t),t}},{key:"_finaliseConnection",value:function(t,e,n){e=e||{},t.suspendedEndpoint||this.connections.push(t),t.pending=null,t.endpoints[0].isTemporarySource=!1,this.repaint(t.source);t={connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]};this.fire(ln,t,n),e.doNotFireConnectionEvent||!1===e.fireEvent||this.fire(an,t,n)}},{key:"removeAllEndpoints",value:function(t,e){function n(t){var e,n,t=o.getId(t),i=o.endpointsByElement[t];if(i)for(e=0,n=i.length;e<n;e++)o.deleteEndpoint(i[e]);delete o.endpointsByElement[t]}var o=this;return e&&this._getAssociatedElements(t).map(n),n(t),this}},{key:"_createSourceDefinition",value:function(t,e){e=p({},e),p(e,t),e.edgeType=e.edgeType||zt,t=this._deriveEndpointAndAnchorSpec(e.edgeType),e.endpoint=e.endpoint||t.endpoints[0],e.anchor=e.anchor||t.anchors[0],t=e.maxConnections||-1;return{def:p({},e),uniqueEndpoint:e.uniqueEndpoint,maxConnections:t,enabled:!0,endpoint:null}}},{key:"addSourceSelector",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],e=this._createSourceDefinition(e),t=new uo(t,e,n);return this.sourceSelectors.push(t),t}},{key:"removeSourceSelector",value:function(e){v(this.sourceSelectors,function(t){return t===e})}},{key:"removeTargetSelector",value:function(e){v(this.targetSelectors,function(t){return t===e})}},{key:"addTargetSelector",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],e=this._createTargetDefinition(e),t=new fo(t,e,n);return this.targetSelectors.push(t),t}},{key:"_createTargetDefinition",value:function(t,e){e=p({},e),p(e,t),e.edgeType=e.edgeType||zt,t=e.maxConnections||-1;return{def:p({},e),uniqueEndpoint:e.uniqueEndpoint,maxConnections:t,enabled:!0,endpoint:null}}},{key:"show",value:function(t,e){return this._setVisible(t,Ne,e)}},{key:"hide",value:function(t,e){return this._setVisible(t,Le,e)}},{key:"_setVisible",value:function(t,e,n){var i=e===Ne,e=null,o=(n&&(e=function(t){t.setVisible(i,!0,!0)}),this.getId(t));return this._operation(t,function(t){var e;i&&n?(e=t.sourceId===o?1:0,t.endpoints[e].isVisible()&&t.setVisible(!0)):t.setVisible(i)},e),this}},{key:"toggleVisible",value:function(t,e){e=e?function(t){var e=t.isVisible();t.setVisible(!e)}:null;this._operation(t,function(t){var e=t.isVisible();t.setVisible(!e)},e)}},{key:"_operation",value:function(t,e,n){var t=this.getId(t),i=this.endpointsByElement[t];if(i&&i.length)for(var o=0,s=i.length;o<s;o++){for(var r=0,a=i[o].connections.length;r<a;r++)if(e(i[o].connections[r]))return;n&&n(i[o])}}},{key:"registerConnectionType",value:function(t,e){if(this._connectionTypes.set(t,p({},e)),e.overlays){for(var n={},i=0;i<e.overlays.length;i++){var o=Gn(e.overlays[i]);n[o.options.id]=o}this._connectionTypes.get(t).overlays=n}}},{key:"registerConnectionTypes",value:function(t){for(var e in t)this.registerConnectionType(e,t[e])}},{key:"registerEndpointType",value:function(t,e){if(this._endpointTypes.set(t,p({},e)),e.overlays){for(var n={},i=0;i<e.overlays.length;i++){var o=Gn(e.overlays[i]);n[o.options.id]=o}this._endpointTypes.get(t).overlays=n}}},{key:"registerEndpointTypes",value:function(t){for(var e in t)this.registerEndpointType(e,t[e])}},{key:"getType",value:function(t,e){return"connection"===e?this.getConnectionType(t):this.getEndpointType(t)}},{key:"getConnectionType",value:function(t){return this._connectionTypes.get(t)}},{key:"getEndpointType",value:function(t){return this._endpointTypes.get(t)}},{key:"importDefaults",value:function(t){for(var e in t)this.defaults[e]=t[e];return t.container&&this.setContainer(t.container),this}},{key:"restoreDefaults",value:function(){return this.defaults=p({},this._initialDefaults),this}},{key:"getManagedElements",value:function(){return this._managedElements}},{key:"proxyConnection",value:function(t,e,n,i,o){var s=null!=t.proxies[e],r=(s?t.proxies[e].originalEp:t.endpoints[e]).elementId,s=s?t.proxies[e].originalEp:t.endpoints[e],a=this.getId(n),i=t.proxies[e]?t.proxies[e].ep.elementId===a?t.proxies[e].ep:(t.proxies[e].ep.detachFromConnection(t,e),this._internal_newEndpoint({element:n,endpoint:i(t,e),anchor:o(t,e),parameters:{isProxyEndpoint:!0}})):this._internal_newEndpoint({element:n,endpoint:i(t,e),anchor:o(t,e),parameters:{isProxyEndpoint:!0}});i.deleteOnEmpty=!0,t.proxies[e]={ep:i,originalEp:s},this.sourceOrTargetChanged(r,a,t,n,e),s.detachFromConnection(t,null,!0),i.connections=[t],t.endpoints[e]=i,s.proxiedBy=i,s.setVisible(!1),t.setVisible(!0),this.revalidate(n)}},{key:"unproxyConnection",value:function(t,e){var n,i,o;null!=t.proxies&&null!=t.proxies[e]&&(n=t.proxies[e].originalEp.element,i=t.proxies[e].originalEp.elementId,o=t.proxies[e].ep.elementId,t.endpoints[e]=t.proxies[e].originalEp,delete t.proxies[e].originalEp.proxiedBy,this.sourceOrTargetChanged(o,i,t,n,e),t.proxies[e].ep.detachFromConnection(t,null),t.proxies[e].originalEp.addConnection(t),t.isVisible()&&t.proxies[e].originalEp.setVisible(!0),t.proxies[e]=null,-1===J(t.proxies,function(t){return null!=t}))&&(t.proxies.length=0)}},{key:"sourceOrTargetChanged",value:function(t,e,n,i,o){t!==e&&(0===o?(n.sourceId=e,n.source=i):1===o&&(n.targetId=e,n.target=i),To(n,this._managedElements[t]),Po(n,this._managedElements[e]))}},{key:"getGroup",value:function(t){return this.groupManager.getGroup(t)}},{key:"getGroupFor",value:function(t){return this.groupManager.getGroupFor(t)}},{key:"addGroup",value:function(t){return this.groupManager.addGroup(t)}},{key:"addToGroup",value:function(t){for(var e,n=arguments.length,i=new Array(1<n?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return(e=this.groupManager).addToGroup.apply(e,[t,!1].concat(i))}},{key:"collapseGroup",value:function(t){this.groupManager.collapseGroup(t)}},{key:"expandGroup",value:function(t){this.groupManager.expandGroup(t)}},{key:"toggleGroup",value:function(t){this.groupManager.toggleGroup(t)}},{key:"removeGroup",value:function(t,e,n,i){return this.groupManager.removeGroup(t,e,n,i)}},{key:"removeAllGroups",value:function(t,e){this.groupManager.removeAllGroups(t,e,!1)}},{key:"removeFromGroup",value:function(t,e,n){this.groupManager.removeFromGroup(t,n,e),this._appendElement(e,this.getContainer()),this.updateOffset({recalc:!0,elId:this.getId(e)})}},{key:"_paintEndpoint",value:function(t,i){var e=(i=i||{}).timestamp,n=!(!1===i.recalc);if(!e||t.timestamp!==e){var o=this.viewport.getPosition(t.elementId),s=i.offset?{x:i.offset.x,y:i.offset.y}:{x:o.x,y:o.y};if(null!=s){var r,a,l,c,u=i.anchorLoc;for(l in null==u&&(s={xy:s,wh:o,element:t,timestamp:e},n&&this.router.isDynamicAnchor(t)&&0<t.connections.length?(r=0==(n=(o=function(t){var e=0;if(null!=i.elementWithPrecedence)for(var n=0;n<t.connections.length;n++)if(t.connections[n].sourceId===i.elementWithPrecedence||t.connections[n].targetId===i.elementWithPrecedence){e=n;break}return t.connections[e]}(t)).endpoints[0]===t?1:0)?o.sourceId:o.targetId,a=this.viewport.getPosition(r),s.index=0==n?1:0,s.connection=o,s.txy=a,s.twh=a,s.tElement=o.endpoints[n],s.tRotation=this._getRotations(r)):0<t.connections.length&&(s.connection=t.connections[0]),s.rotation=this._getRotations(t.elementId),u=this.router.computeAnchorLocation(t._anchor,s)),t.endpoint.compute(u,this.router.getEndpointOrientation(t),t.paintStyleInUse),this.renderEndpoint(t,t.paintStyleInUse),t.timestamp=e,t.overlays)t.overlays.hasOwnProperty(l)&&(c=t.overlays[l]).isVisible()&&(t.overlayPlacements[l]=this.drawOverlay(c,t.endpoint,t.paintStyleInUse,t.getAbsoluteOverlayPosition(c)),this._paintOverlay(c,t.overlayPlacements[l],{xmin:0,ymin:0}))}}}},{key:"_paintConnection",value:function(t,e){if(!this._suspendDrawing&&!1!==t.visible){e=(e=e||{}).timestamp;if(null==e||e!==t.lastPaintedAt){if(null==e||e!==t.lastPaintedAt){this.router.computePath(t,e);var n,i,o={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0};for(n in t.overlays)t.overlays.hasOwnProperty(n)&&(i=t.overlays[n]).isVisible()&&(t.overlayPlacements[n]=this.drawOverlay(i,t.connector,t.paintStyleInUse,t.getAbsoluteOverlayPosition(i)),o.xmin=Math.min(o.xmin,t.overlayPlacements[n].xmin),o.xmax=Math.max(o.xmax,t.overlayPlacements[n].xmax),o.ymin=Math.min(o.ymin,t.overlayPlacements[n].ymin),o.ymax=Math.max(o.ymax,t.overlayPlacements[n].ymax));var s,r,a=parseFloat(""+t.paintStyleInUse.strokeWidth||"1")/2,l=parseFloat(""+t.paintStyleInUse.strokeWidth||"0"),c={xmin:Math.min(t.connector.bounds.xmin-(a+l),o.xmin),ymin:Math.min(t.connector.bounds.ymin-(a+l),o.ymin),xmax:Math.max(t.connector.bounds.xmax+(a+l),o.xmax),ymax:Math.max(t.connector.bounds.ymax+(a+l),o.ymax)};for(s in this.paintConnector(t.connector,t.paintStyleInUse,c),t.overlays)t.overlays.hasOwnProperty(s)&&(r=t.overlays[s]).isVisible()&&this._paintOverlay(r,t.overlayPlacements[s],c)}t.lastPaintedAt=e}}}},{key:"_refreshEndpoint",value:function(t){0<t.connections.length?this.addEndpointClass(t,this.endpointConnectedClass):this.removeEndpointClass(t,this.endpointConnectedClass),t.isFull()?this.addEndpointClass(t,this.endpointFullClass):this.removeEndpointClass(t,this.endpointFullClass)}},{key:"_makeConnector",value:function(t,e,n){return Ae.get(t,e,n)}},{key:"addOverlay",value:function(t,e,n){t.addOverlay(e),n||(e=t instanceof Gi?t.element:t.source,this.revalidate(e))}},{key:"getPathData",value:function(t){for(var e="",n=0;n<t.segments.length;n++)e=e+t.segments[n].getPath(0===n)+" ";return e}}]);var wo,yi=Ao;function Ao(t,e){var n;return c(this,Ao),(n=wo.call(this))._instanceIndex=t,b(u(n),"defaults",void 0),b(u(n),"_initialDefaults",{}),b(u(n),"isConnectionBeingDragged",!1),b(u(n),"currentlyDragging",!1),b(u(n),"hoverSuspended",!1),b(u(n),"_suspendDrawing",!1),b(u(n),"_suspendedAt",null),b(u(n),"connectorClass",We),b(u(n),"connectorOutlineClass",qe),b(u(n),"connectedClass",Je),b(u(n),"endpointClass",Ke),b(u(n),"endpointConnectedClass",Ze),b(u(n),"endpointFullClass",$e),b(u(n),"endpointDropAllowedClass",Qe),b(u(n),"endpointDropForbiddenClass",tn),b(u(n),"endpointAnchorClassPrefix",en),b(u(n),"overlayClass",sn),b(u(n),"connections",[]),b(u(n),"endpointsByElement",{}),b(u(n),"endpointsByUUID",new Map),b(u(n),"sourceSelectors",[]),b(u(n),"targetSelectors",[]),b(u(n),"allowNestedGroups",void 0),b(u(n),"_curIdStamp",1),b(u(n),"viewport",new ro(u(n))),b(u(n),"router",void 0),b(u(n),"groupManager",void 0),b(u(n),"_connectionTypes",new Map),b(u(n),"_endpointTypes",new Map),b(u(n),"_container",void 0),b(u(n),"_managedElements",{}),b(u(n),"DEFAULT_SCOPE",void 0),b(u(n),"_zoom",1),n.defaults={anchor:r.AnchorLocations.Bottom,anchors:[null,null],connectionsDetachable:!0,connectionOverlays:[],connector:Pe.type,container:null,endpoint:ue.type,endpointOverlays:[],endpoints:[null,null],endpointStyle:{fill:"#456"},endpointStyles:[null,null],endpointHoverStyle:null,endpointHoverStyles:[null,null],hoverPaintStyle:null,listStyle:{},maxConnections:1,paintStyle:{strokeWidth:2,stroke:"#456"},reattachConnections:!1,scope:"jsplumb_defaultscope",allowNestedGroups:!0},e&&p(n.defaults,e),p(n._initialDefaults,n.defaults),n.DEFAULT_SCOPE=n.defaults.scope,n.allowNestedGroups=!1!==n._initialDefaults.allowNestedGroups,n.router=new ko(u(n)),n.groupManager=new Ui(u(n)),n.setContainer(n._initialDefaults.container),n}function Oo(t){var e=Math.floor(t),n=Math.ceil(t);return t-e<1e-10?e:n-t<1e-10?n:t}e(Io,Ut),Do=n(Io),t(Io,[{key:"_calcAngle",value:function(t,e){return It({x:this.cx,y:this.cy},{x:t,y:e})}},{key:"_calcAngleForLocation",value:function(t,e){var n;return t.anticlockwise?(n=t.startAngle<t.endAngle?t.startAngle+wt:t.startAngle)-Math.abs(n-t.endAngle)*e:(n=t.endAngle<t.startAngle?t.endAngle+wt:t.endAngle,n=Math.abs(n-t.startAngle),t.startAngle+n*e)}},{key:"getPath",value:function(t){var e=this.sweep>Math.PI?1:0,n=this.anticlockwise?0:1;return(t?"M"+this.x1+" "+this.y1+" ":"")+"A "+this.radius+" "+this.radius+" 0 "+e+","+n+" "+this.x2+" "+this.y2}},{key:"getLength",value:function(){return this.length}},{key:"pointOnPath",value:function(t,e){if(0===t)return{x:this.x1,y:this.y1,theta:this.startAngle};if(1===t)return{x:this.x2,y:this.y2,theta:this.endAngle};e&&(t/=length);var e=this._calcAngleForLocation(this,t),t=this.cx+this.radius*Math.cos(e),n=this.cy+this.radius*Math.sin(e);return{x:Oo(t),y:Oo(n),theta:e}}},{key:"gradientAtPoint",value:function(t,e){t=this.pointOnPath(t,e),e=Ot({x:this.cx,y:this.cy},t);return this.anticlockwise||e!==1/0&&e!==-1/0||(e*=-1),e}},{key:"pointAlongPathFrom",value:function(t,e,n){t=this.pointOnPath(t,n),n=e/this.circumference*2*Math.PI,e=this.anticlockwise?-1:1,t=t.theta+e*n;return{x:this.cx+this.radius*Math.cos(t),y:this.cy+this.radius*Math.sin(t)}}}]);var Do,Mo=Io;function Io(t){c(this,Io),b(u(e=Do.call(this,t)),"type",Io.segmentType),b(u(e),"cx",void 0),b(u(e),"cy",void 0),b(u(e),"radius",void 0),b(u(e),"anticlockwise",void 0),b(u(e),"startAngle",void 0),b(u(e),"endAngle",void 0),b(u(e),"sweep",void 0),b(u(e),"length",void 0),b(u(e),"circumference",void 0),b(u(e),"frac",void 0),e.cx=t.cx,e.cy=t.cy,e.radius=t.r,e.anticlockwise=t.ac,t.startAngle&&t.endAngle?(e.startAngle=t.startAngle,e.endAngle=t.endAngle,e.x1=e.cx+e.radius*Math.cos(e.startAngle),e.y1=e.cy+e.radius*Math.sin(e.startAngle),e.x2=e.cx+e.radius*Math.cos(e.endAngle),e.y2=e.cy+e.radius*Math.sin(e.endAngle)):(e.startAngle=e._calcAngle(e.x1,e.y1),e.endAngle=e._calcAngle(e.x2,e.y2)),e.endAngle<0&&(e.endAngle+=wt),e.startAngle<0&&(e.startAngle+=wt);var e,t=e.endAngle<e.startAngle?e.endAngle+wt:e.endAngle;return e.sweep=Math.abs(t-e.startAngle),e.anticlockwise&&(e.sweep=wt-e.sweep),e.circumference=2*Math.PI*e.radius,e.frac=e.sweep/wt,e.length=e.circumference*e.frac,e.extents={xmin:e.cx-e.radius,xmax:e.cx+e.radius,ymin:e.cy-e.radius,ymax:e.cy+e.radius},e}b(Mo,"segmentType","Arc");e(Lo,Fn),jo=n(Lo),t(Lo,[{key:"draw",value:function(t,e,n){var i,o,s,r,a;if(t instanceof xe)return s=t,1<this.location||this.location<0?(r=this.location<0?1:0,r=Gt(i=s.pointAlongPathFrom(r,this.location,!1),s.pointAlongPathFrom(r,this.location-this.direction*this.length/2,!1),this.length)):1===this.location?(r=Gt(i=s.pointOnPath(this.location),s.pointAlongPathFrom(this.location,-this.length),this.length),-1===this.direction&&(o=r,r=i,i=o)):0===this.location?(i=Gt(r=s.pointOnPath(this.location),s.pointAlongPathFrom(this.location,this.length),this.length),-1===this.direction&&(o=r,r=i,i=o)):r=Gt(i=s.pointAlongPathFrom(this.location,this.direction*this.length/2),s.pointOnPath(this.location),this.length),s={hxy:i,tail:o=Rt(i,r,this.width),cxy:Gt(i,r,this.foldback*this.length)},r=this.paintStyle.stroke||e.stroke,a=this.paintStyle.fill||e.stroke,{component:t,d:s,"stroke-width":this.paintStyle.strokeWidth||e.strokeWidth,stroke:r,fill:a,xmin:Math.min(i.x,o[0].x,o[1].x),xmax:Math.max(i.x,o[0].x,o[1].x),ymin:Math.min(i.y,o[0].y,o[1].y),ymax:Math.max(i.y,o[0].y,o[1].y)}}},{key:"updateFrom",value:function(t){}}]);var jo,No=Lo;function Lo(t,e,n){var i;return c(this,Lo),(i=jo.call(this,t,e,n)).instance=t,i.component=e,b(u(i),"width",void 0),b(u(i),"length",void 0),b(u(i),"foldback",void 0),b(u(i),"direction",void 0),b(u(i),"location",.5),b(u(i),"paintStyle",void 0),b(u(i),"type",Lo.type),b(u(i),"cachedDimensions",void 0),i.width=(n=n||{}).width||20,i.length=n.length||20,i.direction=(n.direction||1)<0?-1:1,i.foldback=n.foldback||.623,i.paintStyle=n.paintStyle||{strokeWidth:1},i.location=null==n.location?i.location:Array.isArray(n.location)?n.location[0]:n.location,i}function Go(t){return t.type===No.type}b(No,"type","Arrow"),Un.register(No.type,No);e(Bo,No),Ro=n(Bo);var Ro,Fo=Bo;function Bo(t,e,n){return c(this,Bo),(e=Ro.call(this,t,e,n)).instance=t,b(u(e),"type",Bo.type),e.foldback=1,e}function Vo(t){return t.type===Fo.type}b(Fo,"type","PlainArrow"),Un.register("PlainArrow",Fo);e(Xo,No),Ho=n(Xo);var Ho,Uo=Xo;function Xo(t,e,n){return c(this,Xo),(e=Ho.call(this,t,e,n)).instance=t,b(u(e),"type",Xo.type),e.length=e.length/2,e.foldback=2,e}function Yo(t){return t.type===Uo.type}b(Uo,"type","Diamond"),Un.register(Uo.type,Uo);e(qo,Fn),zo=n(qo),t(qo,[{key:"updateFrom",value:function(t){}}]);var zo,Wo=qo;function qo(t,e,n){var i;return c(this,qo),(i=zo.call(this,t,e,n)).instance=t,i.component=e,b(u(i),"create",void 0),b(u(i),"type",qo.type),i.create=n.create,i}function Jo(t){return t.type===Wo.type}function Ko(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Zo(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}function $o(t){return($o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Qo(t,e){return(Qo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ts(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function es(i){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e,n=$o(i);return t=o?(t=$o(this).constructor,Reflect.construct(n,arguments,t)):n.apply(this,arguments),n=this,!(e=t)||"object"!=typeof e&&"function"!=typeof e?ts(n):e}}function ns(t){return t<0?-1:0===t?0:1}function is(t){return[ns(t[2]-t[0]),ns(t[3]-t[1])]}function os(t){return Math.sqrt(Math.pow(t[0]-t[2],2)+Math.pow(t[1]-t[3],2))}function ss(t){var e=[];return e.push.apply(e,t),e}b(Wo,"type","Custom"),Un.register(Wo.type,Wo),re.registerHandler(i),re.registerHandler(_e),re.registerHandler(ve),Ae.register(Pe.type,Pe);a=function(){var t=o,e=xe;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Qo(t,e);var n,i=es(o);function o(t,e){var n;if(this instanceof o)return(n=i.call(this,t,e)).connection=t,Zo(ts(n),"type",o.type),Zo(ts(n),"internalSegments",[]),Zo(ts(n),"midpoint",void 0),Zo(ts(n),"alwaysRespectStubs",void 0),Zo(ts(n),"cornerRadius",void 0),Zo(ts(n),"lastx",void 0),Zo(ts(n),"lasty",void 0),Zo(ts(n),"lastOrientation",void 0),Zo(ts(n),"loopbackRadius",void 0),Zo(ts(n),"isLoopbackCurrently",void 0),n.midpoint=null==e.midpoint||isNaN(e.midpoint)?.5:e.midpoint,n.cornerRadius=null!=e.cornerRadius?e.cornerRadius:0,n.alwaysRespectStubs=!0===e.alwaysRespectStubs,n.lastx=null,n.lasty=null,n.lastOrientation=null,n.loopbackRadius=e.loopbackRadius||25,n.isLoopbackCurrently=!1,n;throw new TypeError("Cannot call a class as a function")}return t=o,(e=[{key:"getDefaultStubs",value:function(){return[30,30]}},{key:"addASegment",value:function(t,e,n){var i,o;this.lastx===t&&this.lasty===e||(i=null==this.lastx?n.sx:this.lastx,n=null==this.lasty?n.sy:this.lasty,o=i===t?"v":"h",this.lastx=t,this.lasty=e,this.internalSegments.push([i,n,t,e,o]))}},{key:"writeSegments",value:function(t){for(var e=null,n=0;n<this.internalSegments.length-1;n++){var i,o,e=e||ss(this.internalSegments[n]),s=ss(this.internalSegments[n+1]),r=is(e),a=is(s);0<this.cornerRadius&&e[4]!==s[4]?(i=Math.min(os(e),os(s)),i=Math.min(this.cornerRadius,i/2),e[2]-=r[0]*i,e[3]-=r[1]*i,s[0]+=a[0]*i,s[1]+=a[1]*i,r=r[1]===a[0]&&1===a[0]||r[1]===a[0]&&0===a[0]&&r[0]!==a[1]||r[1]===a[0]&&-1===a[0],o=(a=(s[1]>e[3]?1:-1)==(s[0]>e[2]?1:-1))&&r||!a&&!r?s[0]:e[2],a=a&&r||!a&&!r?e[3]:s[1],this._addSegment(ke,{x1:e[0],y1:e[1],x2:e[2],y2:e[3]}),this._addSegment(Mo,{r:i,x1:e[2],y1:e[3],x2:s[0],y2:s[1],cx:o,cy:a,ac:r})):this._addSegment(ke,{x1:e[0],y1:e[1],x2:e[2],y2:e[3]}),e=s}null!=s&&this._addSegment(ke,{x1:s[0],y1:s[1],x2:s[2],y2:s[3]})}},{key:"_compute",value:function(f,c){function t(t){return[f.startStubX,f.startStubY,f.endStubX,f.endStubY]}var u=this,e=(this.internalSegments.length=0,this.lastx=null,this.lasty=null,this.lastOrientation=null,{perpendicular:t,orthogonal:t,opposite:function(t){var e=f,n="x"===t?0:1,i={x:function(){return 1===e.so[n]&&(e.startStubX>e.endStubX&&e.tx>e.startStubX||e.sx>e.endStubX&&e.tx>e.sx)||-1===e.so[n]&&(e.startStubX<e.endStubX&&e.tx<e.startStubX||e.sx<e.endStubX&&e.tx<e.sx)},y:function(){return 1===e.so[n]&&(e.startStubY>e.endStubY&&e.ty>e.startStubY||e.sy>e.endStubY&&e.ty>e.sy)||-1===e.so[n]&&(e.startStubY<e.endStubY&&e.ty<e.startStubY||e.sy<e.endStubY&&e.ty<e.sy)}};return!u.alwaysRespectStubs&&i[t]()?{x:[(f.sx+f.tx)/2,f.startStubY,(f.sx+f.tx)/2,f.endStubY],y:[f.startStubX,(f.sy+f.ty)/2,f.endStubX,(f.sy+f.ty)/2]}[t]:[f.startStubX,f.startStubY,f.endStubX,f.endStubY]}}[f.anchorOrientation](f.sourceAxis)),h="x"===f.sourceAxis?0:1,n="x"===f.sourceAxis?1:0,i=e[h],o=e[n],s=e[2+h],n=e[2+n],y=(this.addASegment(e[0],e[1],f),f.startStubX+(f.endStubX-f.startStubX)*this.midpoint),v=f.startStubY+(f.endStubY-f.startStubY)*this.midpoint,g={x:[0,1],y:[1,0]},r={perpendicular:function(t,e,n,i,o){var s={x:[[f.startStubX,f.endStubX],null,[f.endStubX,f.startStubX]],y:[[f.startStubY,f.endStubY],null,[f.endStubY,f.startStubY]]},r={x:[[y,f.startStubY],[y,f.endStubY]],y:[[f.startStubX,v],[f.endStubX,v]]},a={x:[[f.endStubX,f.startStubY]],y:[[f.startStubX,f.endStubY]]},l={x:[[f.startStubX,f.endStubY],[f.endStubX,f.endStubY]],y:[[f.endStubX,f.startStubY],[f.endStubX,f.endStubY]]},c={x:[[f.startStubX,v],[f.endStubX,v],[f.endStubX,f.endStubY]],y:[[y,f.startStubY],[y,f.endStubY],[f.endStubX,f.endStubY]]},u={x:[f.startStubY,f.endStubY],y:[f.startStubX,f.endStubX]},h=g[t][0],d=g[t][1],h=f.so[h]+1,p=f.to[d]+1,d=-1===f.to[d]&&u[t][1]<u[t][0]||1===f.to[d]&&u[t][1]>u[t][0],u=s[t][h][0],s=s[t][h][1],h={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]}[t][h][p];return f.segment===h[3]||f.segment===h[2]&&d?r[t]:f.segment===h[2]&&s<u?a[t]:f.segment===h[2]&&u<=s||f.segment===h[1]&&!d?c[t]:f.segment===h[0]||f.segment===h[1]&&d?l[t]:void 0},orthogonal:function(t,e,n,i,o){var s=f,s={x:-1===s.so[0]?Math.min(e,i):Math.max(e,i),y:-1===s.so[1]?Math.min(e,i):Math.max(e,i)}[t];return{x:[[s,n],[s,o],[i,o]],y:[[n,s],[o,s],[o,i]]}[t]},opposite:function(t,e,n,i,o){var s=f,r={x:"y",y:"x"}[t],a={x:"h",y:"w"}[t],l=s["is"+t.toUpperCase()+"GreaterThanStubTimes2"];return c.sourceEndpoint.elementId===c.targetEndpoint.elementId?{x:[[e,n=n+(1-c.sourceEndpoint._anchor[r])*c.sourceInfo[a]+u.maxStub],[i,n]],y:[[n,e],[n,i]]}[t]:!l||1===s.so[h]&&i<e||-1===s.so[h]&&e<i?{x:[[e,v],[i,v]],y:[[y,e],[y,i]]}[t]:1===s.so[h]&&e<i||-1===s.so[h]&&i<e?{x:[[y,s.sy],[y,s.ty]],y:[[s.sx,v],[s.tx,v]]}[t]:void 0}}[f.anchorOrientation](f.sourceAxis,i,o,s,n);if(r)for(var a=0;a<r.length;a++)this.addASegment(r[a][0],r[a][1],f);this.addASegment(e[2],e[3],f),this.addASegment(f.tx,f.ty,f),this.writeSegments(f)}},{key:"transformGeometry",value:function(t,e,n){return t}}])&&Ko(t.prototype,e),n&&Ko(t,n),o}();function rs(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function as(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ls(t,e,n){e&&as(t.prototype,e),n&&as(t,n)}function g(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}function cs(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&hs(t,e)}function us(t){return(us=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function hs(t,e){return(hs=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function m(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ds(i){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e,n=us(i);return t=o?(t=us(this).constructor,Reflect.construct(n,arguments,t)):n.apply(this,arguments),n=this,!(e=t)||"object"!=typeof e&&"function"!=typeof e?m(n):e}}Zo(a,"type","Flowchart"),Ae.register(a.type,a);cs(fs,xe),ps=ds(fs),ls(fs,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(t,e){var n,i,o,s,r,a,l=e.sourcePos,c=e.targetPos,u=Math.abs(l.curX-c.curX),h=Math.abs(l.curY-c.curY);this.showLoopback&&e.sourceEndpoint.elementId===e.targetEndpoint.elementId?(this.isLoopbackCurrently=!0,n=e.sourcePos.curX,s=(i=e.sourcePos.curY-this.margin)-this.loopbackRadius,r=(o=n)-this.loopbackRadius,a=s-this.loopbackRadius,u=2*this.loopbackRadius,h=2*this.loopbackRadius,t.points[0]=r,t.points[1]=a,t.points[2]=u,t.points[3]=h,this._addSegment(Mo,{loopback:!0,x1:n-r+4,y1:i-a,startAngle:0,endAngle:2*Math.PI,r:this.loopbackRadius,ac:!this.clockwise,x2:n-r-4,y2:i-a,cx:o-r,cy:s-a})):(this.isLoopbackCurrently=!1,this._computeBezier(t,e,l,c,u,h))}},{key:"exportGeometry",value:function(){return null==this.geometry?null:{controlPoints:[p({},this.geometry.controlPoints[0]),p({},this.geometry.controlPoints[1])],source:p({},this.geometry.source),target:p({},this.geometry.target)}}},{key:"transformGeometry",value:function(t,e,n){return{controlPoints:[{x:t.controlPoints[0].x+e,y:t.controlPoints[0].y+n},{x:t.controlPoints[1].x+e,y:t.controlPoints[1].y+n}],source:this.transformAnchorPlacement(t.source,e,n),target:this.transformAnchorPlacement(t.target,e,n)}}},{key:"importGeometry",value:function(t){return!(null==t||(null==t.controlPoints||2!=t.controlPoints.length?(l("jsPlumb Bezier: cannot import geometry; controlPoints missing or does not have length 2"),this.setGeometry(null,!0),1):null==t.controlPoints[0].x||null==t.controlPoints[0].y||null==t.controlPoints[1].x||null==t.controlPoints[1].y?(l("jsPlumb Bezier: cannot import geometry; controlPoints malformed"),this.setGeometry(null,!0),1):null==t.source||null==t.source.curX||null==t.source.curY?(l("jsPlumb Bezier: cannot import geometry; source missing or malformed"),this.setGeometry(null,!0),1):null==t.target||null==t.target.curX||null==t.target.curY?(l("jsPlumb Bezier: cannot import geometry; target missing or malformed"),this.setGeometry(null,!0),1):(this.setGeometry(t,!1),0)))}}]);var ps,d=fs;function fs(t,e){var n;return rs(this,fs),(n=ps.call(this,t,e)).connection=t,g(m(n),"showLoopback",void 0),g(m(n),"curviness",void 0),g(m(n),"margin",void 0),g(m(n),"proximityLimit",void 0),g(m(n),"orientation",void 0),g(m(n),"loopbackRadius",void 0),g(m(n),"clockwise",void 0),g(m(n),"isLoopbackCurrently",void 0),g(m(n),"geometry",void 0),n.showLoopback=!1!==(e=e||{}).showLoopback,n.curviness=e.curviness||10,n.margin=e.margin||5,n.proximityLimit=e.proximityLimit||80,n.clockwise=e.orientation&&"clockwise"===e.orientation,n.loopbackRadius=e.loopbackRadius||25,n.isLoopbackCurrently=!1,n}var ys={subtract:function(t,e){return{x:t.x-e.x,y:t.y-e.y}},dotProduct:function(t,e){return t.x*e.x+t.y*e.y},square:function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},scale:function(t,e){return{x:t.x*e,y:t.y*e}}},vs=64,gs=Math.pow(2,-vs-1);function ms(t,e){for(var n,i=[],o=function(t,e){for(var n=e.length-1,i=2*n-1,o=[],s=[],r=[],a=[],l=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],c=0;c<=n;c++)o[c]=ys.subtract(e[c],t);for(var u=0;u<=n-1;u++)s[u]=ys.subtract(e[u+1],e[u]),s[u]=ys.scale(s[u],3);for(var h=0;h<=n-1;h++)for(var d=0;d<=n;d++)r[h]||(r[h]=[]),r[h][d]=ys.dotProduct(s[h],o[d]);for(var p=0;p<=i;p++)a[p]||(a[p]=[]),a[p].y=0,a[p].x=parseFloat(""+p)/i;for(var f=n,y=n-1,v=0;v<=f+y;v++)for(var g=Math.max(0,v-y),m=Math.min(v,f),_=g;_<=m;_++){var x=v-_;a[_+x].y+=r[x][_]*l[x][_]}return a}(t,e),s=e.length-1,r=function t(e,n,i,o){var s,r,a=[],l=[],c=[],u=[];switch(xs(e,n)){case 0:return 0;case 1:if(vs<=o)return i[0]=(e[0].x+e[n].x)/2,1;if(Es(e,n))return i[0]=bs(e,n),1}ks(e,n,.5,a,l);s=t(a,n,c,o+1);r=t(l,n,u,o+1);for(var h=0;h<s;h++)i[h]=c[h];for(var d=0;d<r;d++)i[d+s]=u[d];return s+r}(o,2*s-1,i,0),a=ys.subtract(t,e[0]),l=ys.square(a),c=0,u=0;u<r;u++)a=ys.subtract(t,ks(e,s,i[u],null,null)),(n=ys.square(a))<l&&(l=n,c=i[u]);return a=ys.subtract(t,e[s]),(n=ys.square(a))<l&&(l=n,c=1),{location:c,distance:l}}function _s(t,e){t=ms(t,e);return{point:ks(e,e.length-1,t.location,null,null),location:t.location}}function xs(t,e){for(var n,i,o=0,s=(n=ut(t[0].y),1);s<=e;s++)(i=ut(t[s].y))!=n&&o++,n=i;return o}function Es(t,e){for(var n,i,o,s,r=t[0].y-t[e].y,a=t[e].x-t[0].x,l=t[0].x*t[e].y-t[e].x*t[0].y,c=s=0,u=1;u<e;u++){var h=r*t[u].x+a*t[u].y+l;c<h?c=h:h<s&&(s=h)}return n=(l-c-0*a)*(1/(0*a-r)),i=(l-s-0*a)*(1/(0*a-r)),o=Math.min(n,i),Math.max(n,i)-o<gs?1:0}function bs(t,e){var n=t[e].x-t[0].x,e=t[e].y-t[0].y,i=+t[0].x;return 0+(n*+t[0].y-e*i)*(1/(0*n-e))}function ks(t,e,n,i,o){for(var s=[[]],r=0;r<=e;r++)s[0][r]=t[r];for(var a=1;a<=e;a++)for(var l=0;l<=e-a;l++)s[a]||(s[a]=[]),s[a][l]||(s[a][l]={}),s[a][l].x=(1-n)*s[a-1][l].x+n*s[a-1][l+1].x,s[a][l].y=(1-n)*s[a-1][l].y+n*s[a-1][l+1].y;if(null!=i)for(var c=0;c<=e;c++)i[c]=s[c][0];if(null!=o)for(var u=0;u<=e;u++)o[u]=s[e-u][u];return s[e][0]}function Cs(t,e){var n=[];t--;for(var i=0;i<=t;i++)n.push(function(t,e){var n={x:0,y:0};if(0===t)return e[0];var i=e.length-1;if(1===t)return e[i];var o=e,s=1-t;if(0==i)return e[0];if(1==i)return{x:s*o[0].x+t*o[1].x,y:s*o[0].y+t*o[1].y};{var r,a,l,c,u;return i<4?(e=s*s,r=t*t,a=0,2==i?(o=[o[0],o[1],o[2],n],l=e,c=s*t*2,u=r):3==i&&(l=e*s,c=e*t*3,u=s*r*3,a=t*r),{x:l*o[0].x+c*o[1].x+u*o[2].x+a*o[3].x,y:l*o[0].y+c*o[1].y+u*o[2].y+a*o[3].y}):n}}(i/t,e));return n}function Ss(t){var e=0;if(!As(t))for(var n=Cs(16,t),i=0;i<15;i++)e+=ws(n[i],n[i+1]);return e}var Ps=new Map;function Ts(t,e){for(var n=function(e){if(!(t=Ps.get(e))){var t;(t=[]).push(function(t){return Math.pow(t,e)});for(var n=1;n<e;n++){for(var i=[function(e){return function(t){return e}}(e)],o=0;o<e-n;o++)i.push(function(t){return t});for(var s=0;s<n;s++)i.push(function(t){return 1-t});t.push(function(i){return function(t){for(var e=1,n=0;n<i.length;n++)e*=i[n](t);return e}}(i))}t.push(function(t){return Math.pow(1-t,e)}),Ps.set(e,t)}return t}(t.length-1),i=0,o=0,s=0;s<t.length;s++)i+=t[s].x*n[s](e),o+=t[s].y*n[s](e);return{x:i,y:o}}function ws(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function As(t){return t[0].x===t[1].x&&t[0].y===t[1].y}function Os(t,e,n){if(As(t))return{point:t[0],location:e};for(var i=Ts(t,e),o=0,s=e,r=0<n?1:-1,a=null;o<Math.abs(n);)o+=ws(a=Ts(t,s+=.005*r),i),i=a;return{point:a,location:s}}function Ds(t,e,n){return Os(t,e,n).point}function Ms(t,e,n){return Os(t,e,n).location}function Is(t,e){var n=Ts(t,e),t=Ts(t.slice(0,t.length-1),e),e=t.y-n.y,t=t.x-n.x;return 0==e?1/0:Math.atan(e/t)}function js(t,e,n,i,o){var s=i-e,r=t-n,a=[Ns(o,"x"),Ns(o,"y")],o=[s*a[0][0]+r*a[1][0],s*a[0][1]+r*a[1][1],s*a[0][2]+r*a[1][2],s*a[0][3]+r*a[1][3]+(t*(e-i)+e*(n-t))],l=function(t,e,n,i){var e=e/t,n=n/t,i=i/t,t=(3*n-Math.pow(e,2))/9,n=(9*e*n-27*i-2*Math.pow(e,3))/54,i=Math.pow(t,3)+Math.pow(n,2),o=[0,0,0];{var s;0<=i?(s=ut(n+Math.sqrt(i))*Math.pow(Math.abs(n+Math.sqrt(i)),1/3),i=ut(n-Math.sqrt(i))*Math.pow(Math.abs(n-Math.sqrt(i)),1/3),o[0]=-e/3+(s+i),o[1]=-e/3-(s+i)/2,o[2]=-e/3-(s+i)/2,0!==Math.abs(Math.sqrt(3)*(s-i)/2)&&(o[1]=-1,o[2]=-1)):(s=Math.acos(n/Math.sqrt(-Math.pow(t,3))),o[0]=2*Math.sqrt(-t)*Math.cos(s/3)-e/3,o[1]=2*Math.sqrt(-t)*Math.cos((s+2*Math.PI)/3)-e/3,o[2]=2*Math.sqrt(-t)*Math.cos((s+4*Math.PI)/3)-e/3)}for(var r=0;r<3;r++)(o[r]<0||1<o[r])&&(o[r]=-1);return o}.apply(null,o),c=[];if(null!=l)for(var u=0;u<3;u++){var h=l[u],d=Math.pow(h,2),p=Math.pow(h,3),p={x:a[0][0]*p+a[0][1]*d+a[0][2]*h+a[0][3],y:a[1][0]*p+a[1][1]*d+a[1][2]*h+a[1][3]},d=void 0,d=n-t!=0?(p[0]-t)/(n-t):(p[1]-e)/(i-e);0<=h&&h<=1&&0<=d&&d<=1&&c.push(p)}return c}function Ns(t,e){return[-t[0][e]+3*t[1][e]+-3*t[2][e]+t[3][e],3*t[0][e]-6*t[1][e]+3*t[2][e],-3*t[0][e]+3*t[1][e],t[0][e]]}cs(Rs,Ut),Ls=ds(Rs),ls(Rs,[{key:"getPath",value:function(t){return(t?"M "+this.x2+" "+this.y2+" ":"")+"C "+this.cp2x+" "+this.cp2y+" "+this.cp1x+" "+this.cp1y+" "+this.x1+" "+this.y1}},{key:"pointOnPath",value:function(t,e){return t=Rs._translateLocation(this.curve,t,e),Ts(this.curve,t)}},{key:"gradientAtPoint",value:function(t,e){return t=Rs._translateLocation(this.curve,t,e),Is(this.curve,t)}},{key:"pointAlongPathFrom",value:function(t,e,n){return t=Rs._translateLocation(this.curve,t,n),Ds(this.curve,t,e)}},{key:"getLength",value:function(){return null!=this.length&&0!==this.length||(this.length=Ss(this.curve)),this.length}},{key:"findClosestPointOnPath",value:function(t,e){var n=_s({x:t,y:e},this.curve);return{d:Math.sqrt(Math.pow(n.point.x-t,2)+Math.pow(n.point.y-e,2)),x:n.point.x,y:n.point.y,l:1-n.location,s:this,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function(t,e,n,i){return js(t,e,n,i,this.curve)}}],[{key:"_translateLocation",value:function(t,e,n){return e=n?Ms(t,0<e?0:1,e):e}}]);var Ls,Gs=Rs;function Rs(t){var e;return rs(this,Rs),g(m(e=Ls.call(this,t)),"curve",void 0),g(m(e),"cp1x",void 0),g(m(e),"cp1y",void 0),g(m(e),"cp2x",void 0),g(m(e),"cp2y",void 0),g(m(e),"length",0),g(m(e),"type",Rs.segmentType),e.cp1x=t.cp1x,e.cp1y=t.cp1y,e.cp2x=t.cp2x,e.cp2y=t.cp2y,e.x1=t.x1,e.x2=t.x2,e.y1=t.y1,e.y2=t.y2,e.curve=[{x:e.x1,y:e.y1},{x:e.cp1x,y:e.cp1y},{x:e.cp2x,y:e.cp2y},{x:e.x2,y:e.y2}],e.extents={xmin:Math.min(e.x1,e.x2,e.cp1x,e.cp2x),ymin:Math.min(e.y1,e.y2,e.cp1y,e.cp2y),xmax:Math.max(e.x1,e.x2,e.cp1x,e.cp2x),ymax:Math.max(e.y1,e.y2,e.cp1y,e.cp2y)},e}g(Gs,"segmentType","Bezier");cs(Vs,d),Fs=ds(Vs),ls(Vs,[{key:"getCurviness",value:function(){return this.majorAnchor}},{key:"_findControlPoint",value:function(t,e,n,i,o){var s={x:0,y:0};return i[0]!==o[0]||i[1]===o[1]?(0===o[0]?s.x=n.curX<e.curX?t.x+this.minorAnchor:t.x-this.minorAnchor:s.x=t.x+this.majorAnchor*o[0],0===o[1]?s.y=n.curY<e.curY?t.y+this.minorAnchor:t.y-this.minorAnchor:s.y=t.y+this.majorAnchor*i[1]):(0===i[0]?s.x=e.curX<n.curX?t.x+this.minorAnchor:t.x-this.minorAnchor:s.x=t.x-this.majorAnchor*i[0],0===i[1]?s.y=e.curY<n.curY?t.y+this.minorAnchor:t.y-this.minorAnchor:s.y=t.y+this.majorAnchor*o[1]),s}},{key:"_computeBezier",value:function(t,e,n,i,o,s){var r,a=n.curX<i.curX?o:0,l=n.curY<i.curY?s:0,o=n.curX<i.curX?0:o,s=n.curY<i.curY?0:s,i=!0!==this.edited?(r=this._findControlPoint({x:a,y:l},n,i,t.so,t.to),this._findControlPoint({x:o,y:s},i,n,t.to,t.so)):(r=this.geometry.controlPoints[0],this.geometry.controlPoints[1]);this.geometry={controlPoints:[r,i],source:e.sourcePos,target:e.targetPos},this._addSegment(Gs,{x1:a,y1:l,x2:o,y2:s,cp1x:r.x,cp1y:r.y,cp2x:i.x,cp2y:i.y})}}]);var Fs,Bs=Vs;function Vs(t,e){var n;return rs(this,Vs),(n=Fs.call(this,t,e)).connection=t,g(m(n),"type",Vs.type),g(m(n),"majorAnchor",void 0),g(m(n),"minorAnchor",void 0),n.majorAnchor=(e=e||{}).curviness||150,n.minorAnchor=10,n}g(Bs,"type","Bezier");cs(Xs,d),Hs=ds(Xs),ls(Xs,[{key:"_computeBezier",value:function(t,e,n,i,o,s){var r,a,l,c,u,h,d,p=n.curX<i.curX?0:o,f=n.curY<i.curY?0:s,o=n.curX<i.curX?o:0,s=n.curY<i.curY?s:0;0===n.x&&(p-=this.margin),1===n.x&&(p+=this.margin),0===n.y&&(f-=this.margin),1===n.y&&(f+=this.margin),0===i.x&&(o-=this.margin),1===i.x&&(o+=this.margin),0===i.y&&(s-=this.margin),1===i.y&&(s+=this.margin),!0!==this.edited?(n=(p+o)/2,i=(f+s)/2,l=f,c=s,d=(u=p)<=(d=o)&&c<=l?1:u<=d&&l<=c?2:d<=u&&l<=c?3:4,u=Math.sqrt(Math.pow(o-p,2)+Math.pow(s-f,2)),this._controlPoint=(l=n,c=i,n=d,i=e.sourcePos,d=e.targetPos,r=this.curviness,a=this.curviness,h=this.proximityLimit,u<=h?{x:l,y:c}:1===n?i.curY<=0&&1<=d.curY?{x:l+(i.x<.5?-1*r:r),y:c}:1<=i.curX&&d.curX<=0?{x:l,y:c+(i.y<.5?-1*a:a)}:{x:l+-1*r,y:c+-1*a}:2===n?1<=i.curY&&d.curY<=0?{x:l+(i.x<.5?-1*r:r),y:c}:1<=i.curX&&d.curX<=0?{x:l,y:c+(i.y<.5?-1*a:a)}:{x:l+r,y:c+-1*a}:3===n?1<=i.curY&&d.curY<=0?{x:l+(i.x<.5?-1*r:r),y:c}:i.curX<=0&&1<=d.curX?{x:l,y:c+(i.y<.5?-1*a:a)}:{x:l+-1*r,y:c+-1*a}:4===n?i.curY<=0&&1<=d.curY?{x:l+(i.x<.5?-1*r:r),y:c}:i.curX<=0&&1<=d.curX?{x:l,y:c+(i.y<.5?-1*a:a)}:{x:l+r,y:c+-1*a}:void 0)):this._controlPoint=this.geometry.controlPoints[0],u=this._controlPoint.x,h=this._controlPoint.x,n=this._controlPoint.y,d=this._controlPoint.y,this.geometry={controlPoints:[this._controlPoint,this._controlPoint],source:e.sourcePos,target:e.targetPos},this._addSegment(Gs,{x1:o,y1:s,x2:p,y2:f,cp1x:u,cp1y:n,cp2x:h,cp2y:d})}}]);var Hs,Us=Xs;function Xs(t,e){var n;return rs(this,Xs),(n=Hs.call(this,t,e)).connection=t,g(m(n),"type",Xs.type),g(m(n),"_controlPoint",void 0),g(m(n),"proximityLimit",void 0),n.curviness=e.curviness||10,n.margin=e.margin||5,n.proximityLimit=e.proximityLimit||80,n.clockwise=e.orientation&&"clockwise"===e.orientation,n}function Ys(t){return(Ys="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function zs(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function x(t,e,n){e&&zs(t.prototype,e),n&&zs(t,n)}function E(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}function Ws(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Js(t,e)}function qs(t){return(qs=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Js(t,e){return(Js=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function P(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ks(i){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e,n=qs(i);return t=o?(t=qs(this).constructor,Reflect.construct(n,arguments,t)):n.apply(this,arguments),n=this,!(e=t)||"object"!=typeof e&&"function"!=typeof e?P(n):e}}function Zs(t,e,n){return(Zs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var t=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=qs(t)););return t}(t,e);if(t)return(t=Object.getOwnPropertyDescriptor(t,e)).get?t.get.call(n):t.value})(t,e,n||t)}function $s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,o,s=[],r=!0,a=!1;try{for(n=n.call(t);!(r=(i=n.next()).done)&&(s.push(i.value),!e||s.length!==e);r=!0);}catch(t){a=!0,o=t}finally{try{r||null==n.return||n.return()}finally{if(a)throw o}}return s}}(t,e)||function(t,e){var n;if(t)return"string"==typeof t?Qs(t,e):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qs(t,e):void 0}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qs(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function tr(t,e,n){for(var i=(n=n||t.parentNode).querySelectorAll(e),o=0;o<i.length;o++)if(i[o]===t)return!0;return!1}function er(t,e){t.stopPropagation?t.stopPropagation():t.returnValue=!1,!e&&t.preventDefault&&t.preventDefault()}function nr(t,e,n,i){if(i&&tr(t,e,n))return t;for(t=t.parentNode;null!=t&&t!==n;){if(tr(t,e))return t;t=t.parentNode}}function A(t){return t.srcElement||t.target}function ir(t){return null!=t.className?void 0===t.className.baseVal?t.className:t.className.baseVal:""}function or(t,e,n){function i(t,e){for(var n,i=0;i<e.length;i++)t?-1===o.indexOf(e[i])&&o.push(e[i]):-1!==(n=o.indexOf(e[i]))&&o.splice(n,1)}var e=null==e?[]:Array.isArray(e)?e:e.split(/\s+/),n=null==n?[]:Array.isArray(n)?n:n.split(/\s+/),o=ir(t).split(/\s+/),e=(i(!0,e),i(!1,n),t),n=o.join(" "),s=o;n=at(n),void 0!==e.className.baseVal?e.className.baseVal=n:e.className=n;try{var r=e.classList;if(null!=r){for(;0<r.length;)r.remove(r.item(0));for(var a=0;a<s.length;a++)s[a]&&r.add(s[a])}}catch(t){l("JSPLUMB: cannot set class list",t)}}function sr(t){return!f(t)&&!Array.isArray(t)&&null!=t.length&&null==t.documentElement&&null==t.nodeType}function rr(t){return ir(t)}function ar(t,e){function n(e,t){null!=e&&null!=t&&0<t.length&&(e.classList?y(at(t).split(/\s+/),function(t){e.classList.add(t)}):or(e,t))}sr(t)?y(t,function(t){n(t,e)}):n(t,e)}function lr(t,e){return t.classList?t.classList.contains(e):-1!==ir(t).indexOf(e)}function cr(t,e){function n(e,t){null!=e&&null!=t&&0<t.length&&(e.classList?at(t).split(/\s+/).forEach(function(t){e.classList.remove(t)}):or(e,null,t))}sr(t)?y(t,function(t){n(t,e)}):n(t,e)}function ur(t,e){function n(t,e){null!=t&&null!=e&&0<e.length&&(t.classList?t.classList.toggle(e):i.hasClass(t,e)?i.removeClass(t,e):i.addClass(t,e))}var i=this;sr(t)?y(t,function(t){n(t,e)}):n(t,e)}function hr(t,e,n,i){return dr(null,t,e,n,i)}function dr(t,e,n,i,o){var s,r=null==t?document.createElement(e):document.createElementNS(t,e);for(s in n=n||{})r.style[s]=n[s];for(s in i&&(r.className=i),o=o||{})r.setAttribute(s,""+o[s]);return r}function pr(t){var t=t.getBoundingClientRect(),e=document.body,n=document.documentElement,i=window.pageYOffset||n.scrollTop||e.scrollTop,o=window.pageXOffset||n.scrollLeft||e.scrollLeft,s=n.clientTop||e.clientTop||0,n=n.clientLeft||e.clientLeft||0,e=t.top+i-s,i=t.left+o-n;return{x:Math.round(i),y:Math.round(e)}}function fr(t){return{w:t.offsetWidth,h:t.offsetHeight}}g(Us,"type","StateMachine"),Ae.register(Bs.type,Bs),Ae.register(Us.type,Us);var yr={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},vr="stroke-dasharray",gr="dashstyle",mr="svg",_r="path",xr={svg:"http://www.w3.org/2000/svg"};function Er(t,e){for(var n in e)t.setAttribute(n,""+e[n])}function br(t,e){return(e=e||{}).version="1.1",e.xmlns=xr.svg,dr(xr.svg,t,null,null,e)}function kr(t){return"position:absolute;left:"+t[0]+"px;top:"+t[1]+"px"}function Cr(t,e,n){var i,o,s,r;for(r in e.setAttribute("fill",n.fill||Le),e.setAttribute("stroke",n.stroke||Le),n.strokeWidth&&e.setAttribute("stroke-width",n.strokeWidth),n[gr]&&n.strokeWidth&&!n[vr]?(i=-1===n[gr].indexOf(",")?" ":",",o=n[gr].split(i),s="",y(o,function(t){s+=Math.floor(t*n.strokeWidth)+i}),e.setAttribute(vr,s)):n[vr]&&e.setAttribute(vr,n[vr]),yr)n[r]&&e.setAttribute(yr[r],n[r])}function Sr(t,e,n){t.childNodes.length>n?t.insertBefore(e,t.childNodes[n]):t.appendChild(e)}function Pr(t,e,n,i,o){t.style.width=i+"px",t.style.height=o+"px",t.style.left=e+"px",t.style.top=n+"px",t.height=o,t.width=i}function O(t,e,n){t=[t,e];return n&&t.push(n),t.join(":")}var Tr="data-jtk-container",wr="data-jtk-group-content",Ar="data-jtk-enabled",Or="data-jtk-scope",Dr="endpoint",Mr="element",Ir="connection",jr="div",D="click",Nr="contextmenu",Lr="dblclick",Gr="dbltap",M="mousedown",Rr="mouseenter",Fr="mouseexit",Br="mousemove",I="mouseup",j="mouseout",N="mouseover",Vr="tap",Hr="drag:move",Ur="drag:stop",Xr="drag:start",Yr="revert",zr="connection:abort",Wr="connection:drag",qr=O(Mr,D),Jr=O(Mr,Lr),Kr=O(Mr,Gr),Zr=O(Mr,j),$r=O(Mr,N),Qr=O(Mr,Br),ta=O(Mr,I),ea=O(Mr,M),na=O(Mr,Nr),ia=O(Mr,Vr),oa=O(Dr,D),sa=O(Dr,Lr),ra=O(Dr,Gr),aa=O(Dr,j),la=O(Dr,N),ca=O(Dr,I),ua=O(Dr,M),ha=O(Dr,Vr),da=O(Ir,D),pa=O(Ir,Lr),fa=O(Ir,Gr),ya=O(Ir,j),va=O(Ir,N),ga=O(Ir,I),ma=O(Ir,M),_a=O(Ir,Nr),xa=O(Ir,Vr),Ea="position",ba=Oe(We),ka=Oe(Ke),Ca=Me(Fe),Sa=Me(wr),Pa=Oe(sn);function Ta(t,e,n,i,o,s,r){return function(){var t=[];return t.push.apply(t,arguments),t.item=function(t){return this[t]},t}((e=e,n=n,i=i,o=o,s=s,r=r,new Touch({target:t,identifier:T(),pageX:e,pageY:n,screenX:i,screenY:o,clientX:s||i,clientY:r||o})))}function wa(t,e,n){for(var i=(n=n||t.parentNode).querySelectorAll(e),o=0;o<i.length;o++)if(i[o]===t)return 1}function Aa(t){return t.srcElement||t.target}function Oa(t,e,n,i){var o;return i?void 0!==t.path&&t.path.indexOf?{path:t.path,end:t.path.indexOf(n)}:(o={path:[],end:-1},function t(e){o.path.push(e),e===n?o.end=o.path.length-1:null!=e.parentNode&&t(e.parentNode)}(e),o):{path:[e],end:1}}var Da=1,Ma="ontouchstart"in document.documentElement||null!=navigator.maxTouchPoints&&0<navigator.maxTouchPoints,Ia="onmousedown"in document.documentElement,ja={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};function Na(t,e){return null==t?{x:0,y:0}:{x:(t=Ga(Ra(t),0))[e+"X"],y:t[e+"Y"]}}function La(t){return Na(t,"page")}function Ga(t,e){return t.item?t.item(e):t[e]}function Ra(t){return t.touches&&0<t.touches.length?t.touches:t.changedTouches&&0<t.changedTouches.length?t.changedTouches:t.targetTouches&&0<t.targetTouches.length?t.targetTouches:[t]}function Fa(t){return Ra(t).length}function Ba(t,e,n,i,o){var s;Ua(t,e,n),i.__tauid=n.__tauid,t.addEventListener?t.addEventListener(e,n,!1,o):t.attachEvent&&(s=e+n.__tauid,t["e"+s]=n,t[s]=function(){t["e"+s]&&t["e"+s](window.event)},t.attachEvent("on"+e,t[s]))}function Va(s,r,a){var l=this;null!=a&&Ha(s,function(t){var e=t,n=r,i=a;if(e.__ta&&e.__ta[n]&&delete e.__ta[n][i.__tauid],i.__taExtra){for(var o=0;o<i.__taExtra.length;o++)Va(e,i.__taExtra[o][0],i.__taExtra[o][1]);i.__taExtra.length=0}i.__taUnstore&&i.__taUnstore(),null!=a.__tauid&&(t.removeEventListener?(t.removeEventListener(r,a,!1),Ma&&ja[r]&&t.removeEventListener(ja[r],a,!1)):l.detachEvent&&(t[n=r+a.__tauid]&&t.detachEvent("on"+r,t[n]),t[n]=null,t["e"+n]=null)),a.__taTouchProxy&&Va(s,a.__taTouchProxy[1],a.__taTouchProxy[0])})}function Ha(t,e){if(null!=t)for(var n="string"==typeof t?document.querySelectorAll(t):null!=t.length?t:[t],i=0;i<n.length;i++)e(n[i])}function Ua(t,e,n){var i=Da++;t.__ta=t.__ta||{},t.__ta[e]=t.__ta[e]||{},(t.__ta[e][i]=n).__tauid=i}var Xa=/:not\(([^)]+)\)/;function Ya(c,u,h,t){var d,p,e,n,i;return null==c?h:(n=c.split(","),d=[],p=[],y(n,function(t){var e=t.match(Xa);null!=e?p.push(e[1]):d.push(t)}),0<p.length&&0===d.length&&d.push(Jt),n=t,i=t=function t(e){t.__tauid=h.__tauid;var n=Aa(e),i=!1,o=Oa(e,n,u,null!=c);if(-1!=o.end)for(var s=0;!i&&s<o.end;s++){for(var r=o.path[s],a=0;a<p.length;a++)if(wa(r,p[a],u))return;for(var l=0;!i&&l<d.length;l++)if(wa(r,d[l],u)){h.apply(r,[e,r]),i=!0;break}}},(e=h).__taExtra=e.__taExtra||[],e.__taExtra.push([n,i]),t)}function za(t,e,n,i,o){var s;Ma&&ja[e]&&(s=Ya(i,t,n,ja[e]),Ba(t,ja[e],s,n,o)),"focus"===e&&null==t.getAttribute(He)&&t.setAttribute(He,"1"),Ba(t,e,Ya(i,t,n,e),n,o)}var Wa={tap:{touches:1,taps:1},dbltap:{touches:1,taps:2},contextmenu:{touches:2,taps:1}};function qa(t,e,n,i){for(var o in n.__tamee[t])n.__tamee[t].hasOwnProperty(o)&&n.__tamee[t][o].apply(i,[e])}x(Ka,null,[{key:"generate",value:function(h,d){return function(c,o,s,r){var u,t,e,a,l;o==Nr&&Ia?za(c,o,s,r):(null==c.__taTapHandler&&(u=c.__taTapHandler={tap:[],dbltap:[],down:!1,taps:0,downSelectors:[]},e=function(t){if(u.down){var e,n,i=Aa(t),o=(u.taps++,Fa(t));for(n in Wa)if(Wa.hasOwnProperty(n)){var s=Wa[n];if(s.touches===o&&(1===s.taps||s.taps===u.taps))for(var r=0;r<u[n].length;r++)for(var a=Oa(t,i,c,null!=u[n][r][1]),l=0;l<a.end;l++)if(e=a.path[l],null==u[n][r][1]||wa(e,u[n][r][1],c)){u[n][r][0].apply(e,[t,e]);break}}}},a=function(){u.down=!1},l=function(){u.taps=0},c.__taTapHandler.downHandler=t=function(t){for(var e=Oa(t,Aa(t),c,null!=r),n=!1,i=0;i<e.end;i++){if(n)return;for(var o=e.path[i],s=0;s<u.downSelectors.length;s++)if(null==u.downSelectors[s]||wa(o,u.downSelectors[s],c)){u.down=!0,setTimeout(a,h),setTimeout(l,d),n=!0;break}}},c.__taTapHandler.upHandler=e,za(c,M,t),za(c,I,e)),c.__taTapHandler.downSelectors.push(r),c.__taTapHandler[o].push([s,r]),s.__taUnstore=function(){if(null!=c.__taTapHandler){v(c.__taTapHandler.downSelectors,function(t){return t===r});for(var t=c.__taTapHandler[o],e=s,n=0,n=0,i=t.length;n<i&&t[n][0]!==e;n++);n<t.length&&t.splice(n,1),0===c.__taTapHandler.downSelectors.length&&(Va(c,M,c.__taTapHandler.downHandler),Va(c,I,c.__taTapHandler.upHandler),delete c.__taTapHandler)}})}}}]);var Ja=Ka;function Ka(){_(this,Ka)}x($a,null,[{key:"generate",value:function(){var r=[];return function(i,t,e,n){var o,s;i.__tamee||(i.__tamee={over:!1,mouseenter:[],mouseexit:[]},s=function(t){for(var e=Aa(t),n=0;n<r.length;n++)e!=r[n]||wa(t.relatedTarget||t.toElement,"*",e)||(e.__tamee.over=!1,r.splice(n,1),qa(Fr,t,i,e))},Ba(i,N,Ya(n,i,o=function(t){var e=Aa(t);(null!=n||e!=i||i.__tamee.over)&&(!wa(e,n,i)||null!=e.__tamee&&e.__tamee.over)||(qa(Rr,t,i,e),e.__tamee=e.__tamee||{},e.__tamee.over=!0,r.push(e))},N),o),Ba(i,j,Ya(n,i,s,j),s)),e.__taUnstore=function(){delete i.__tamee[t][e.__tauid]},Ua(i,t,e),i.__tamee[t][e.__tauid]=e}}}]);var Za=$a;function $a(){_(this,$a)}x(tl,[{key:"_doBind",value:function(t,e,n,i,o){null!=n&&(t=t,e===Vr||e===Gr||e===Nr?this.tapHandler(t,e,n,i,o):e===Rr||e==Fr?this.mouseEnterExitHandler(t,e,n,i,o):za(t,e,n,i,o))}},{key:"on",value:function(t,e,n,i,o){return this._doBind(t,e,null==i?n:i,null==i?null:n,o),this}},{key:"off",value:function(t,e,n){return Va(t,e,n),this}},{key:"trigger",value:function(t,o,s,r,a){var l=Ia&&("undefined"==typeof MouseEvent||null==s||s.constructor===MouseEvent),c=Ma&&!Ia&&ja[o]?ja[o]:o,u=!(Ma&&!Ia&&ja[o]),h=La(s),d=Na(s,"screen"),p=Na(s,"client");return Ha(t,function(n){s=s||{screenX:d.x,screenY:d.y,clientX:p.x,clientY:p.y};var t={TouchEvent:function(t){var e=Ta(n,h.x,h.y,d.x,d.y,p.x,p.y);(t.initTouchEvent||t.initEvent)(c,!0,!0,window,null,d.x,d.y,p.x,p.y,!1,!1,!1,!1,e,e,e,1,0)},MouseEvents:function(t){t.initMouseEvent(c,!0,!0,window,null==a?1:a,d.x,d.y,p.x,p.y,!1,!1,!1,!1,1,n)}},e=!u&&!l&&Ma&&ja[o]?"TouchEvent":"MouseEvents",i=document.createEvent(e);t[e](i),t=i,r&&(t.payload=r),n.dispatchEvent(i)}),this}}]);var Qa=tl;function tl(t){_(this,tl),E(this,"clickThreshold",void 0),E(this,"dblClickThreshold",void 0),E(this,"tapHandler",void 0),E(this,"mouseEnterExitHandler",void 0),this.clickThreshold=(t=t||{}).clickThreshold||250,this.dblClickThreshold=t.dblClickThreshold||450,this.mouseEnterExitHandler=Za.generate(),this.tapHandler=Ja.generate(this.clickThreshold,this.dblClickThreshold)}function el(t){return{x:t.offsetLeft,y:t.offsetTop}}function nl(t){return{w:t.offsetWidth,h:t.offsetHeight}}function il(t,e){t.style.left=e.x+"px",t.style.top=e.y+"px"}function ol(t,e,n){var i=e.parentNode,i=t.getSize(i),t=t.getSize(e),e=n.x,o=e+t.w,n=n.y,t=n+t.h;return 0<o&&e<i.w&&0<t&&n<i.h}function sl(t,e,n){for(var i,o=e.getAttribute("katavorio-draggable"),s=null!=o?"[katavorio-draggable='"+o+"'] ":"",r=0;r<t.length;r++)if(null!=(i=function(t,e,n){if(tr(e,n,t))return e;for(var i=e.parentNode;null!=i&&i!==t;){if(tr(i,n,t))return i;i=i.parentNode}}(e,n,s+t[r].selector))){if(t[r].filter){var a=tr(n,t[r].filter,i);if(!0===t[r].filterExclude&&!a||a)return null}return[t[r],i]}return null}function rl(){return!0}function al(){return!1}function ll(){}function cl(t,e){if(null!=t){t=f(t)||null!=t.tagName||null==t.length?[t]:t;for(var n=0;n<t.length;n++)e.apply(t[n],[t[n]])}}var ul,hl="start",dl="beforeStart",pl="drag",fl="stop",yl="katavorio-draggable",vl="katavorio-delegated-draggable",gl="katavorio-drag-no-select",ml="katavorio-ghost-proxy",_l="katavorio-clone-drag",xl=[fl,hl,pl,"drop","over","out",dl],El=(x(bl,[{key:"setEnabled",value:function(t){this.enabled=t}},{key:"isEnabled",value:function(){return this.enabled}},{key:"toggleEnabled",value:function(){this.enabled=!this.enabled}},{key:"addScope",value:function(t){var e,n={};for(e in cl(this.scopes,function(t){n[t]=!0}),cl(t?t.split(/\s+/):[],function(t){n[t]=!0}),this.scopes.length=0,n)this.scopes.push(e)}},{key:"removeScope",value:function(t){var e,n={};for(e in cl(this.scopes,function(t){n[t]=!0}),cl(t?t.split(/\s+/):[],function(t){delete n[t]}),this.scopes.length=0,n)this.scopes.push(e)}},{key:"toggleScope",value:function(t){var e,n={};for(e in cl(this.scopes,function(t){n[t]=!0}),cl(t?t.split(/\s+/):[],function(t){n[t]?delete n[t]:n[t]=!0}),this.scopes.length=0,n)this.scopes.push(e)}}]),bl);function bl(t,e){_(this,bl),this.el=t,this.k=e,E(this,"_class",void 0),E(this,"uuid",T()),E(this,"enabled",!0),E(this,"scopes",[])}r.ContainmentType=void 0,(ul=r.ContainmentType||(r.ContainmentType={})).notNegative="notNegative",ul.parent="parent",ul.parentEnclosed="parentEnclosed";Ws(Sl,El),kl=Ks(Sl),x(Sl,[{key:"_trackScroll",value:function(t){var e,n,i,o,s;this._moving&&(n=(e={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop}).x-this._lastScrollValues.x,i=e.y-this._lastScrollValues.y,i=(n={x:n+this._lastPosition.x,y:i+this._lastPosition.y}).x-this._downAt.x,o=n.y-this._downAt.y,s=this._ignoreZoom?1:this.k.getZoom(),this._dragEl&&this._dragEl.parentNode&&(i+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,o+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),this.moveBy(i/=s,o/=s,t),this._lastPosition=n,this._lastScrollValues=e)}},{key:"on",value:function(t,e){this.listeners[t]&&this.listeners[t].push(e)}},{key:"off",value:function(t,e){if(this.listeners[t]){for(var n=[],i=0;i<this.listeners[t].length;i++)this.listeners[t][i]!==e&&n.push(this.listeners[t][i]);this.listeners[t]=n}}},{key:"_upListener",value:function(t){this._downAt&&(this._downAt=null,this.k.eventManager.off(document,Br,this.moveListener),this.k.eventManager.off(document,I,this.upListener),cr(document.body,gl),this.unmark(t),this.stop(t),this._moving=!1,this.clone?(this._dragEl&&this._dragEl.parentNode&&this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=null):this._activeSelectorParams&&this._activeSelectorParams.revertFunction&&!0===this._activeSelectorParams.revertFunction(this._dragEl,el(this._dragEl))&&(il(this._dragEl,this._posAtDown),this._dispatch(Yr,this._dragEl)))}},{key:"_downListener",value:function(t){var e,n,i;t.defaultPrevented||(this.rightButtonCanDrag||3!==t.which&&2!==t.button)&&this.isEnabled()&&this._canDrag()&&(this._testFilter(t)&&(e=t,n=this.el,i=this.k,!tr(e.srcElement||e.target,i.getInputFilterSelector(),n))?(this._activeSelectorParams=null,this._elementToDrag=null,0===this._availableSelectors.length&&console.log("JSPLUMB: no available drag selectors"),e=t.target||t.srcElement,null!=(i=sl(this._availableSelectors,this.el,e))&&(this._activeSelectorParams=i[0],this._elementToDrag=i[1]),null!=this._activeSelectorParams&&null!=this._elementToDrag&&(null!=(n=this._activeSelectorParams.dragInit?this._activeSelectorParams.dragInit(this._elementToDrag):null)&&(this._elementToDrag=n),this.clone?(this._dragEl=this._elementToDrag.cloneNode(!0),ar(this._dragEl,_l),this._dragEl.setAttribute("id",null),this._dragEl.style.position="absolute",(null!=this._parent?(e=el(this.el),this._dragEl.style.left=e.x+"px",this._dragEl.style.top=e.y+"px",this._parent):(i=pr(this._elementToDrag),this._dragEl.style.left=i.x+"px",this._dragEl.style.top=i.y+"px",document.body)).appendChild(this._dragEl)):this._dragEl=this._elementToDrag,this.consumeStartEvent&&er(t),this._downAt=La(t),this._dragEl&&this._dragEl.parentNode&&(this._initialScroll={x:this._dragEl.parentNode.scrollLeft,y:this._dragEl.parentNode.scrollTop}),this._posAtDown=el(this._dragEl),this._pagePosAtDown=pr(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=nl(this._dragEl),this.k.eventManager.on(document,Br,this.moveListener),this.k.eventManager.on(document,I,this.upListener),ar(document.body,gl),this._dispatch(dl,{el:this.el,pos:this._posAtDown,e:t,drag:this,size:this._size}))):this._consumeFilteredEvents&&er(t))}},{key:"_moveListener",value:function(t){if(this._downAt){if(!this._moving){var e=this._dispatch(hl,{el:this.el,pos:this._posAtDown,e:t,drag:this,size:this._size});if(!1!==e){if(!this._downAt)return;this.mark(e),this._moving=!0}else this.abort()}var n,i,o;this._downAt&&(n=(e=La(t)).x-this._downAt.x,i=e.y-this._downAt.y,o=this._ignoreZoom?1:this.k.getZoom(),this._lastPosition={x:e.x,y:e.y},this._lastScrollValues={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},this._dragEl&&this._dragEl.parentNode&&(n+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,i+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),this.moveBy(n/=o,i/=o,t))}}},{key:"mark",value:function(t){var e;this._posAtDown=el(this._dragEl),this._pagePosAtDown=pr(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=nl(this._dragEl),ar(this._dragEl,this.k.css.drag),this._constrainRect={w:(e=this._dragEl).parentNode.offsetWidth+e.parentNode.scrollLeft,h:e.parentNode.offsetHeight+e.parentNode.scrollTop},this._ghostDx=0,this._ghostDy=0}},{key:"unmark",value:function(t){this._isConstrained&&this._useGhostProxy(this._elementToDrag,this._dragEl)?(this._ghostProxyOffsets={x:this._dragEl.offsetLeft-this._ghostDx,y:this._dragEl.offsetTop-this._ghostDy},this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag):this._ghostProxyOffsets=null,cr(this._dragEl,this.k.css.drag),this._isConstrained=!1}},{key:"moveBy",value:function(t,e,n){var i,t=this.toGrid({x:this._posAtDown.x+t,y:this._posAtDown.y+e}),e=this._doConstrain(t,this._dragEl,this._constrainRect,this._size);this._useGhostProxy(this.el,this._dragEl)&&(t.x!==e.x||t.y!==e.y?(this._isConstrained||(ar(i=this._ghostProxyFunction(this._elementToDrag),ml),this._ghostProxyParent?(this._ghostProxyParent.appendChild(i),this._currentParentPosition=pr(this._elementToDrag.parentNode),this._ghostParentPosition=pr(this._ghostProxyParent),this._ghostDx=this._currentParentPosition.x-this._ghostParentPosition.x,this._ghostDy=this._currentParentPosition.y-this._ghostParentPosition.y):this._elementToDrag.parentNode.appendChild(i),this._dragEl=i,this._isConstrained=!0),e=t):this._isConstrained&&(this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag,this._isConstrained=!1,this._currentParentPosition=null,this._ghostParentPosition=null,this._ghostDx=0,this._ghostDy=0)),il(this._dragEl,{x:e.x+this._ghostDx,y:e.y+this._ghostDy}),this._dispatch(pl,{el:this.el,pos:e,e:n,drag:this,size:this._size,originalPos:this._posAtDown})}},{key:"abort",value:function(){null!=this._downAt&&this._upListener()}},{key:"getDragElement",value:function(t){return t?this._elementToDrag||this.el:this._dragEl||this.el}},{key:"stop",value:function(t,e){var n;e||this._moving?(e=el(this._dragEl),(n=[]).push([this._dragEl,e,this,this._size]),this._dispatch(fl,{el:this._dragEl,pos:this._ghostProxyOffsets||e,finalPos:e,e:t,drag:this,selection:n,size:this._size,originalPos:{x:this._posAtDown.x,y:this._posAtDown.y}})):this._moving||this._activeSelectorParams.dragAbort&&this._activeSelectorParams.dragAbort(this._elementToDrag)}},{key:"_dispatch",value:function(t,e){var n=null;if(this._activeSelectorParams&&this._activeSelectorParams[t])n=this._activeSelectorParams[t](e);else if(this.listeners[t])for(var i=0;i<this.listeners[t].length;i++)try{var o=this.listeners[t][i](e);null!=o&&(n=o)}catch(t){}return n}},{key:"resolveGrid",value:function(){var t={grid:null,thresholdX:5,thresholdY:5};return null!=this._activeSelectorParams&&null!=this._activeSelectorParams.grid&&(t.grid=this._activeSelectorParams.grid,null!=this._activeSelectorParams.snapThreshold)&&(t.thresholdX=this._activeSelectorParams.snapThreshold,t.thresholdY=this._activeSelectorParams.snapThreshold),t}},{key:"toGrid",value:function(t){var e=this.resolveGrid(),n=e.grid,i=e.thresholdX,e=e.thresholdY;return null==n?t:Ft(t,n,n?n.w/2:i,n?n.h/2:e)}},{key:"setUseGhostProxy",value:function(t){this._useGhostProxy=t?rl:al}},{key:"_doConstrain",value:function(t,e,n,i){return null!=this._activeSelectorParams&&this._activeSelectorParams.constrainFunction&&"function"==typeof this._activeSelectorParams.constrainFunction?this._activeSelectorParams.constrainFunction(t,e,n,i):t}},{key:"_testFilter",value:function(t){for(var e in this._filters){var e=this._filters[e],n=e[0](t);if(!(n=e[1]?!n:n))return!1}return!0}},{key:"addFilter",value:function(i,t){var e,o=this;i&&(e="function"==typeof(e=i)?(e._katavorioId=T(),e._katavorioId):e,this._filters[e]=[function(t){var e,n=t.srcElement||t.target;return f(i)?e=tr(n,i,o.el):"function"==typeof i&&(e=i(t,o.el)),e},!1!==t])}},{key:"removeFilter",value:function(t){t="function"==typeof t?t._katavorioId:t;delete this._filters[t]}},{key:"clearAllFilters",value:function(){this._filters={}}},{key:"addSelector",value:function(t,e){t.selector&&(e?this._availableSelectors.unshift(t):this._availableSelectors.push(t))}},{key:"destroy",value:function(){this.k.eventManager.off(this.el,M,this.downListener),this.k.eventManager.off(document,Br,this.moveListener),this.k.eventManager.off(document,I,this.upListener),this.downListener=null,this.upListener=null,(this.moveListener=null)!=this.scrollTracker&&document.removeEventListener("scroll",this.scrollTracker)}}]);var kl,Cl=Sl;function Sl(t,e,n){var i;return _(this,Sl),E(P(i=kl.call(this,t,n)),"_class",void 0),E(P(i),"rightButtonCanDrag",void 0),E(P(i),"consumeStartEvent",void 0),E(P(i),"clone",void 0),E(P(i),"scroll",void 0),E(P(i),"trackScroll",void 0),E(P(i),"_downAt",void 0),E(P(i),"_posAtDown",void 0),E(P(i),"_pagePosAtDown",void 0),E(P(i),"_pageDelta",{x:0,y:0}),E(P(i),"_moving",void 0),E(P(i),"_lastPosition",void 0),E(P(i),"_lastScrollValues",{x:0,y:0}),E(P(i),"_initialScroll",{x:0,y:0}),E(P(i),"_size",void 0),E(P(i),"_currentParentPosition",void 0),E(P(i),"_ghostParentPosition",void 0),E(P(i),"_dragEl",void 0),E(P(i),"_multipleDrop",void 0),E(P(i),"_ghostProxyOffsets",void 0),E(P(i),"_ghostDx",void 0),E(P(i),"_ghostDy",void 0),E(P(i),"_isConstrained",!1),E(P(i),"_ghostProxyParent",void 0),E(P(i),"_useGhostProxy",void 0),E(P(i),"_ghostProxyFunction",void 0),E(P(i),"_activeSelectorParams",void 0),E(P(i),"_availableSelectors",[]),E(P(i),"_canDrag",void 0),E(P(i),"_consumeFilteredEvents",void 0),E(P(i),"_parent",void 0),E(P(i),"_ignoreZoom",void 0),E(P(i),"_filters",{}),E(P(i),"_constrainRect",void 0),E(P(i),"_elementToDrag",void 0),E(P(i),"downListener",void 0),E(P(i),"moveListener",void 0),E(P(i),"upListener",void 0),E(P(i),"scrollTracker",void 0),E(P(i),"listeners",{start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]}),i._class=i.k.css.draggable,ar(i.el,i._class),i.downListener=i._downListener.bind(P(i)),i.upListener=i._upListener.bind(P(i)),i.moveListener=i._moveListener.bind(P(i)),i.rightButtonCanDrag=!0===e.rightButtonCanDrag,i.consumeStartEvent=!1!==e.consumeStartEvent,i._dragEl=i.el,i.clone=!0===e.clone,i.scroll=!0===e.scroll,i.trackScroll=!1!==e.trackScroll,i._multipleDrop=!1!==e.multipleDrop,i._canDrag=e.canDrag||rl,i._consumeFilteredEvents=e.consumeFilteredEvents,i._parent=e.parent,i._ignoreZoom=!0===e.ignoreZoom,i._ghostProxyParent=e.ghostProxyParent,i.trackScroll&&(i.scrollTracker=i._trackScroll.bind(P(i)),document.addEventListener("scroll",i.scrollTracker)),!0===e.ghostProxy?i._useGhostProxy=rl:e.ghostProxy&&"function"==typeof e.ghostProxy?i._useGhostProxy=e.ghostProxy:i._useGhostProxy=function(t,e){return!(!i._activeSelectorParams||!i._activeSelectorParams.useGhostProxy)&&i._activeSelectorParams.useGhostProxy(t,e)},e.makeGhostProxy?i._ghostProxyFunction=e.makeGhostProxy:i._ghostProxyFunction=function(t){return i._activeSelectorParams&&i._activeSelectorParams.makeGhostProxy?i._activeSelectorParams.makeGhostProxy(t):t.cloneNode(!0)},e.selector&&(null==i.el.getAttribute(yl)&&(t=""+(new Date).getTime(),i.el.setAttribute("katavorio-draggable",t)),i._availableSelectors.push(e)),i.k.eventManager.on(i.el,M,i.downListener),i}var Pl=["input","textarea","select","button","option"].join(","),Tl=(x(wl,[{key:"getZoom",value:function(){return this.zoom}},{key:"setZoom",value:function(t){this.zoom=t}},{key:"_prepareParams",value:function(t){var e,n={events:{}};for(e in t=t||{})n[e]=t[e];for(e=0;e<xl.length;e++)n.events[xl[e]]=t[xl[e]]||ll;return n}},{key:"getInputFilterSelector",value:function(){return this.inputFilterSelector}},{key:"setInputFilterSelector",value:function(t){return this.inputFilterSelector=t,this}},{key:"draggable",value:function(t,e){return null==t._katavorioDrag?(e=this._prepareParams(e),e=new Cl(t,e,this),ar(t,vl),t._katavorioDrag=e):t._katavorioDrag}},{key:"destroyDraggable",value:function(t){t._katavorioDrag&&(t._katavorioDrag.destroy(),delete t._katavorioDrag)}}]),wl);function wl(t){_(this,wl),E(this,"eventManager",void 0),E(this,"zoom",1),E(this,"css",{}),E(this,"inputFilterSelector",void 0),this.inputFilterSelector=(t=t||{}).inputFilterSelector||Pl,this.eventManager=new Qa,this.zoom=t.zoom||1;t=t.css||{};p(this.css,t)}var Al="jtk-drag-selected",Ol=(x(Dl,[{key:"_activeSet",get:function(){return null==this.__activeSet?this._dragSelection:this.__activeSet}},{key:"length",get:function(){return this._dragSelection.length}},{key:"filterActiveSet",value:function(e){var n=this;this.__activeSet=[],y(this._dragSelection,function(t){e(t)&&n.__activeSet.push(t)})}},{key:"clear",value:function(){var e=this;this.reset(),y(this._dragSelection,function(t){e.instance.removeClass(t.jel,Al)}),this._dragSelection.length=0}},{key:"reset",value:function(){this._dragElementStartPositions.clear(),this._dragElementPositions.clear(),this._dragSizes.clear(),this._dragElements.clear(),this.__activeSet=null}},{key:"initialisePositions",value:function(){var n=this;y(this._activeSet,function(t){var e={x:parseInt(""+t.jel.offsetLeft,10),y:parseInt(""+t.jel.offsetTop,10)};n._dragElementStartPositions.set(t.id,e),n._dragElementPositions.set(t.id,e),n._dragSizes.set(t.id,n.instance.getSize(t.jel))})}},{key:"updatePositions",value:function(t,e,a){var l=this,c=t.x-e.x,u=t.y-e.y;y(this._activeSet,function(t){var e,n,i,o,s,r=l._dragElementStartPositions.get(t.id);r&&(i={x:e=r.x+c,y:r=r.y+u,w:(n=l._dragSizes.get(t.id)).w,h:n.h},t.jel._jsPlumbParentGroup&&t.jel._jsPlumbParentGroup.constrain&&(o=t.jel.parentNode.offsetWidth+t.jel.parentNode.scrollLeft,s=t.jel.parentNode.offsetHeight+t.jel.parentNode.scrollTop,i.x=Math.max(i.x,0),i.y=Math.max(i.y,0),i.x=Math.min(i.x,o-n.w),i.y=Math.min(i.y,s-n.h)),l._dragElementPositions.set(t.id,{x:e,y:r}),t.jel.style.left=i.x+"px",t.jel.style.top=i.y+"px",a(t.jel,t.id,n,i))})}},{key:"each",value:function(o){var s=this;y(this._activeSet,function(t){var e=s._dragSizes.get(t.id),n=s._dragElementPositions.get(t.id),i=s._dragElementStartPositions.get(t.id);o(t.jel,t.id,n,e,i)})}},{key:"add",value:function(t,e){var n=t;e=e||this.instance.getId(n),-1===J(this._dragSelection,function(t){return t.id===e})&&(this.instance.addClass(t,Al),this._dragSelection.push({id:e,jel:n}))}},{key:"remove",value:function(t){var n=this,i=t;this._dragSelection=this._dragSelection.filter(function(t){var e=t.jel!==i;return e||n.instance.removeClass(t.jel,Al),e})}},{key:"toggle",value:function(t){var e=t;-1!==J(this._dragSelection,function(t){return t.jel===e})?this.remove(e):this.add(t)}}]),Dl);function Dl(t){_(this,Dl),this.instance=t,E(this,"_dragSelection",[]),E(this,"_dragSizes",new Map),E(this,"_dragElements",new Map),E(this,"_dragElementStartPositions",new Map),E(this,"_dragElementPositions",new Map),E(this,"__activeSet",void 0)}var Ml="jtk-delegated-draggable",Il="jtk-draggable",jl="jtk-drag",Nl="jtk-ghost-proxy",Ll="jtk-drag-active",Gl="jtk-dragged",Rl="jtk-drag-hover",Fl=(x(Bl,[{key:"addHandler",value:function(e,t){var n=this,i=p({selector:e.selector},t||{}),o=(i.start=ht(i.start,function(t){return e.onStart(t)},!1),i.drag=ht(i.drag,function(t){return e.onDrag(t)}),i.stop=ht(i.stop,function(t){return e.onStop(t)}),(e.onBeforeStart||function(t){}).bind(e));if(i.beforeStart=ht(i.beforeStart,function(t){return o(t)}),i.dragInit=function(t){return e.onDragInit(t)},i.dragAbort=function(t){return e.onDragAbort(t)},e.useGhostProxy&&(i.useGhostProxy=e.useGhostProxy,i.makeGhostProxy=e.makeGhostProxy),null==i.constrainFunction&&null!=i.containment)switch(i.containment){case r.ContainmentType.notNegative:i.constrainFunction=function(t,e,n,i){return{x:Math.max(0,Math.min(t.x)),y:Math.max(0,Math.min(t.y))}};break;case r.ContainmentType.parent:var s=i.containmentPadding||5;i.constrainFunction=function(t,e,n,i){return{x:t.x<0?0:t.x>n.w-s?n.w-s:t.x,y:t.y<0?0:t.y>n.h-s?n.h-s:t.y}};break;case r.ContainmentType.parentEnclosed:i.constrainFunction=function(t,e,n,i){return{x:t.x<0?0:t.x+i.w>n.w?n.w-i.w:t.x,y:t.y<0?0:t.y+i.h>n.h?n.h-i.h:t.y}}}null==this.drag?(i.trackScroll=this._trackScroll,this.drag=this.collicat.draggable(this.instance.getContainer(),i),y(this._filtersToAdd,function(t){n.drag.addFilter(t[0],t[1])}),this.drag.on(Yr,function(t){n.instance.revalidate(t)})):this.drag.addSelector(i),this.handlers.push({handler:e,options:i}),e.init(this.drag)}},{key:"addSelector",value:function(t,e){this.drag&&this.drag.addSelector(t,e)}},{key:"addFilter",value:function(t,e){null==this.drag?this._filtersToAdd.push([t,!0===e]):this.drag.addFilter(t,e)}},{key:"removeFilter",value:function(t){null!=this.drag&&this.drag.removeFilter(t)}},{key:"setFilters",value:function(t){var e=this;y(t,function(t){e.drag.addFilter(t[0],t[1])})}},{key:"reset",value:function(){var t=[];if(y(this.handlers,function(t){t.handler.reset()}),this.handlers.length=0,null!=this.drag){var e,n=this.drag._filters;for(e in n)t.push([e,n[e][1]]);this.collicat.destroyDraggable(this.instance.getContainer())}return delete this.drag,t}},{key:"setOption",value:function(e,t){var n=Z(this.handlers,function(t){return t.handler===e});null!=n&&p(n.options,t||{})}}]),Bl);function Bl(t,e,n){var i=this;_(this,Bl),this.instance=t,this.dragSelection=e,E(this,"collicat",void 0),E(this,"drag",void 0),E(this,"_draggables",{}),E(this,"_dlist",[]),E(this,"_elementsWithEndpoints",{}),E(this,"_draggablesForElements",{}),E(this,"handlers",[]),E(this,"_trackScroll",void 0),E(this,"_filtersToAdd",[]),this.collicat=new Tl({zoom:this.instance.currentZoom,css:{noSelect:this.instance.dragSelectClass,delegatedDraggable:Ml,draggable:Il,drag:jl,selected:Al,active:Ll,hover:Rl,ghostProxy:Nl}}),this.instance.bind(Pn,function(t){i.collicat.setZoom(t)}),this._trackScroll=!1!==(n=n||{}).trackScroll}x(Hl,[{key:"onDragInit",value:function(t){return null}},{key:"onDragAbort",value:function(t){return null}},{key:"getDropGroup",value:function(){var t,e,n,i=null;return 0<this._intersectingGroups.length&&(t=this._intersectingGroups[0].groupLoc.group,(n=(e=this._intersectingGroups[0].intersectingElement)._jsPlumbParentGroup)===t||null!=n&&n.overrideDrop(e,t)||(i=this._intersectingGroups[0])),i}},{key:"onStop",value:function(c){var t,e,n,i,s=this,o=c.drag.getDragElement(),u=this.getDropGroup(),h=[];h.push({el:o,id:this.instance.getId(o),pos:c.finalPos,originalGroup:o._jsPlumbParentGroup,redrawResult:null,originalPos:c.originalPos,reverted:!1,dropGroup:null!=u?u.groupLoc.group:null}),this._dragSelection.each(function(t,e,n,i,o){var s,r,a,l;t!==c.el&&(a=(n={x:n.x,y:n.y}).x,l=n.y,t._jsPlumbParentGroup&&t._jsPlumbParentGroup.constrain&&(s=t.parentNode.offsetWidth+t.parentNode.scrollLeft,r=t.parentNode.offsetHeight+t.parentNode.scrollTop,a=Math.max(a,0),l=Math.max(l,0),a=Math.min(a,s-i.w),l=Math.min(l,r-i.h),n.x=a,n.y=l),h.push({el:t,id:e,pos:n,originalPos:o,originalGroup:t._jsPlumbParentGroup,redrawResult:null,reverted:!1,dropGroup:null!=u?u.groupLoc.group:null}))}),y(h,function(t){var e,n=null!=t.originalGroup,i=n&&ol(s.instance,t.el,t.pos),o={x:0,y:0};n&&!i?null==u&&(null!=(e=s._pruneOrOrphan(t,!0,!0)).pos?t.pos=e.pos.pos:!e.pruned&&t.originalGroup.revert&&(t.pos=t.originalPos,t.reverted=!0)):n&&i&&(o=s.instance.viewport.getPosition(t.originalGroup.elId)),null==u||i?t.dropGroup=null:s.instance.groupManager.addToGroup(u.groupLoc.group,!1,t.el),t.reverted&&s.instance.setPosition(t.el,t.pos),t.redrawResult=s.instance.setElementPosition(t.el,t.pos.x+o.x,t.pos.y+o.y),s.instance.removeClass(t.el,Gl),s.instance.select({source:t.el}).removeClass(s.instance.elementDraggingClass+" "+s.instance.sourceElementDraggingClass,!0),s.instance.select({target:t.el}).removeClass(s.instance.elementDraggingClass+" "+s.instance.targetElementDraggingClass,!0)}),null!=h[0].originalGroup&&(e=o._jsPlumbParentGroup)!==h[0].originalGroup&&(t=c.drag.getDragElement(!0),h[0].originalGroup.ghost)&&(e=this.instance.getOffset(this.instance.getGroupContentArea(e)),n=(i=this.instance.getOffset(this.instance.getGroupContentArea(h[0].originalGroup))).x+c.pos.x-e.x,i=i.y+c.pos.y-e.y,t.style.left=n+"px",t.style.top=i+"px",this.instance.revalidate(t)),this.instance.fire(Ur,{elements:h,e:c.e,el:o,payload:this._dragPayload}),this._cleanup()}},{key:"_cleanup",value:function(){var e=this;y(this._groupLocations,function(t){e.instance.removeClass(t.el,Ll),e.instance.removeClass(t.el,Rl)}),this._currentDragParentGroup=null,this._groupLocations.length=0,this.instance.hoverSuspended=!1,this._dragOffset=null,this._dragSelection.reset(),this._dragPayload=null,this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup=null}},{key:"reset",value:function(){}},{key:"init",value:function(t){this.drag=t}},{key:"onDrag",value:function(o){function s(t,e,n){var i;n&&(i=new Set,y(r._groupLocations,function(t){!i.has(t.group.id)&&jt(e,t.r)?(t.group!==r._currentDragParentGroup&&r.instance.addClass(t.el,Rl),r._intersectingGroups.push({groupLoc:t,intersectingElement:o.drag.getDragElement(!0),d:0}),y(r.instance.groupManager.getAncestors(t.group),function(t){i.add(t.id)})):r.instance.removeClass(t.el,Rl)})),r.instance.setElementPosition(t,e.x,e.y),r.instance.fire(Hr,{el:t,e:o.e,pos:{x:e.x,y:e.y},originalPosition:r.originalPosition,payload:r._dragPayload})}var r=this,t=o.drag.getDragElement(),e=o.pos,n=this.instance.getSize(t),i={x:e.x,y:e.y},a=(this._intersectingGroups.length=0,null!=this._dragOffset&&(i.x+=this._dragOffset.x,i.y+=this._dragOffset.y),{x:i.x,y:i.y,w:n.w,h:n.h});s(t,a,!0),this._dragSelection.updatePositions(e,this.originalPosition,function(t,e,n,i){s(t,i,!1)}),this._currentDragGroupOffsets.forEach(function(t,e){e=r._currentDragGroupSizes.get(e),e={x:a.x+t[0].x,y:a.y+t[0].y,w:e.w,h:e.h};t[1].style.left=e.x+"px",t[1].style.top=e.y+"px",s(t[1],e,!1)})}},{key:"onStart",value:function(i){var e,s=this,t=i.drag.getDragElement(),n=this.instance.getOffset(t),o=(this.originalPosition={x:i.pos.x,y:i.pos.y},t._jsPlumbParentGroup&&(this._dragOffset=this.instance.getOffset(t.offsetParent),this._currentDragParentGroup=t._jsPlumbParentGroup),!0),r=t.getAttribute(Ve);if(o=!1===this.instance.elementsDraggable||null!=r&&r!==qt?!1:o){this._groupLocations.length=0,this._intersectingGroups.length=0,this.instance.hoverSuspended=!0;var r=i.drag.getDragElement(!0),a=r.querySelectorAll(h),r=function(t){for(var e=[],n=t._jsPlumbParentGroup;null!=n;)e.push(n.el),n=n.group;return e}(r),l=[],c=(Array.prototype.push.apply(l,a),Array.prototype.push.apply(l,r),this._dragSelection.filterActiveSet(function(t){return-1===l.indexOf(t.jel)}),this._dragSelection.initialisePositions(),function(o){var t,e,n;return(!o._isJsPlumbGroup||s.instance.allowNestedGroups)&&(e=(t=!o._jsPlumbParentGroup)||!0!==o._jsPlumbParentGroup.dropOverride,n=!t&&(o._jsPlumbParentGroup.ghost||!0!==o._jsPlumbParentGroup.constrain),t||e&&n)&&(y(s.instance.groupManager.getGroups(),function(t){var e,n,i=o._jsPlumbGroup;!1===t.droppable||!1===t.enabled||o._jsPlumbGroup===t||s.instance.groupManager.isDescendant(t,i)||(i=t.el,e=s.instance.getSize(i),n={x:(n=s.instance.getOffset(i)).x,y:n.y,w:e.w,h:e.h},s._groupLocations.push({el:i,r:n,group:t}),t!==s._currentDragParentGroup&&s.instance.addClass(i,Ll))}),s._groupLocations.sort(function(t,e){return s.instance.groupManager.isDescendant(t.group,e.group)?-1:s.instance.groupManager.isAncestor(e.group,t.group)?1:0})),s.instance.select({source:o}).addClass(s.instance.elementDraggingClass+" "+s.instance.sourceElementDraggingClass,!0),s.instance.select({target:o}).addClass(s.instance.elementDraggingClass+" "+s.instance.targetElementDraggingClass,!0),s.instance.fire(Xr,{el:o,e:i.e,originalPosition:s.originalPosition,pos:s.originalPosition})}),a=this.instance.getId(t),a=(this._currentDragGroup=this._dragGroupByElementIdMap[a],this._currentDragGroup&&(r=this._currentDragGroup,e=t,null===(r=Q(r.members,function(t){return t.el===e}))||!0!==r.active)&&(this._currentDragGroup=null),c(t));if(!1===a)return this._cleanup(),!1;this._dragPayload=a,null!=this._currentDragGroup&&(this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup.members.forEach(function(t){var e=s.instance.getOffset(t.el);s._currentDragGroupOffsets.set(t.elId,[{x:e.x-n.x,y:e.y-n.y},t.el]),s._currentDragGroupSizes.set(t.elId,s.instance.getSize(t.el)),c(t.el)}))}return o}},{key:"addToDragGroup",value:function(t){var e,n=this,i=(e=this.instance,f(t=t)?{id:t,active:!0}:{id:e.getId(t),active:t.active}),o=this._dragGroupMap[i.id];null==o&&(o={id:i.id,members:new Set},this._dragGroupMap[i.id]=o);for(var s=arguments.length,r=new Array(1<s?s-1:0),a=1;a<s;a++)r[a-1]=arguments[a];this.removeFromDragGroup.apply(this,r),y(r,function(t){var e=n.instance.getId(t);o.members.add({elId:e,el:t,active:i.active}),n._dragGroupByElementIdMap[e]=o})}},{key:"removeFromDragGroup",value:function(){for(var o=this,t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];y(e,function(e){var n,t=o.instance.getId(e),i=o._dragGroupByElementIdMap[t];null!=i&&(n=new Set,i.members.forEach(function(t){t.el!==e&&n.add(t)}),i.members=n,delete o._dragGroupByElementIdMap[t])})}},{key:"setDragGroupState",value:function(n){for(var i=this,t=arguments.length,e=new Array(1<t?t-1:0),o=1;o<t;o++)e[o-1]=arguments[o];y(e.map(function(t){return i.instance.getId(t)}),function(e){var t=i._dragGroupByElementIdMap[e];null!=t&&null!=(t=Q(t.members,function(t){return t.elId===e}))&&(t.active=n)})}},{key:"_pruneOrOrphan",value:function(t,e,n){var i=t.el,o={pruned:!1,pos:null};return!n&&ol(this.instance,i,t.pos)||((n=i._jsPlumbParentGroup).prune?(i._isJsPlumbGroup?this.instance.removeGroup(i._jsPlumbGroup):n.remove(t.el,!0),o.pruned=!0):n.orphan&&(o.pos=this.instance.groupManager.orphan(t.el,e),i._isJsPlumbGroup?n.removeGroup(i._jsPlumbGroup):n.remove(t.el))),o}}]);var Vl=Hl;function Hl(t,e){_(this,Hl),this.instance=t,this._dragSelection=e,E(this,"selector","> "+h+":not("+Oe(sn)+")"),E(this,"_dragOffset",null),E(this,"_groupLocations",[]),E(this,"_intersectingGroups",[]),E(this,"_currentDragParentGroup",null),E(this,"_dragGroupByElementIdMap",{}),E(this,"_dragGroupMap",{}),E(this,"_currentDragGroup",null),E(this,"_currentDragGroupOffsets",new Map),E(this,"_currentDragGroupSizes",new Map),E(this,"_dragPayload",null),E(this,"drag",void 0),E(this,"originalPosition",void 0)}var Ul=Oe(Ll,Rl),Xl="sourceSelectorEndpoint",Yl=(x(zl,[{key:"_resolveDragParent",value:function(t,e){var n=this.instance.getContainer(),i=nr(e,h,n,!0);return null!=t.parentSelector&&(null!=(e=nr(e,t.parentSelector,n,!0))&&(i=nr(e.parentNode,h,n,!1)),e)||i}},{key:"_mousedownHandler",value:function(t){if(3!==t.which&&2!==t.button){var e=t.target||t.srcElement,n=this._getSourceDefinition(t);if((null==n||null!=(c=this._resolveDragParent(n.def.def,e))&&c.getAttribute(Ar)!==qt)&&n){var i,o=t.currentTarget;if(e.getAttribute(Ar)!==qt){if(er(t),null!=(i=(this._activeDefinition=n).def.def).canAcceptNewConnection&&!i.canAcceptNewConnection(c,t))return!1;var s=lc(t,c,this.instance.currentZoom),r=(p(a={element:c},i),a.isTemporarySource=!0,i.scope?a.scope=i.scope:null!=(r=e.getAttribute(Or))&&(a.scope=r),i.parameterExtractor?i.parameterExtractor(c,e,t):{}),a=U(a,r);if(null!=a.maxConnections&&0<=a.maxConnections)if(this.instance.select({source:c}).length>=a.maxConnections)return er(t),i.onMaxConnections&&i.onMaxConnections({element:c,maxConnections:a.maxConnections},t),t.stopImmediatePropagation&&t.stopImmediatePropagation(),!1;i.anchorPositionFinder&&null!=(r=i.anchorPositionFinder(c,s,i,t))&&(a.anchor=r),this._originalAnchorSpec=a.anchor||(this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors[0]:this.instance.defaults.anchor);var l,c=this.instance.router.prepareAnchor(this._originalAnchorSpec),r=[s.x,s.y,0,0],u=(0<c.locations.length?(r[2]=c.locations[0].ox,r[3]=c.locations[0].oy):c.isContinuous&&(c=s.x<.5?s.x:1-s.x,l=s.y<.5?s.y:1-s.y,r[2]=c<l?s.x<.5?-1:1:0,r[3]=l<c?s.y<.5?-1:1:0),a.anchor=r,a.deleteOnEmpty=!0,this.ep=this.instance._internal_newEndpoint(a),{});if(i.extract){for(var h in i.extract){var d=e.getAttribute(h);d&&(u[i.extract[h]]=d)}this.ep.mergeParameters(u)}a.uniqueEndpoint&&(l=this.ep.elementId,null==(c=this.instance.getManagedData(l,Xl,n.id))?(this.instance.setManagedData(l,Xl,n.id,this.ep),this.ep.deleteOnEmpty=!1):this.ep.finalEndpoint=c),o._jsPlumbOrphanedEndpoints=o._jsPlumbOrphanedEndpoints||[],o._jsPlumbOrphanedEndpoints.push(this.ep),this.instance.trigger(this.ep.endpoint.canvas,M,t,u)}}}}},{key:"_mouseupHandler",value:function(t){t=t.currentTarget||t.srcElement;t._jsPlumbOrphanedEndpoints&&(lt(t._jsPlumbOrphanedEndpoints,this.instance._maybePruneEndpoint.bind(this.instance)),t._jsPlumbOrphanedEndpoints.length=0),this._activeDefinition=null}},{key:"onDragInit",value:function(t){var e=this.instance.getOffset(t),n=this.instance.getSize(t);return this._makeDraggablePlaceholder(e,n),this.placeholderInfo.element.jtk=t.jtk,this.placeholderInfo.element}},{key:"onDragAbort",value:function(t){this._cleanupDraggablePlaceholder()}},{key:"_makeDraggablePlaceholder",value:function(t,e){this.placeholderInfo=this.placeholderInfo||{};var n=hr(jr,{position:"absolute"}),i=(this.instance._appendElement(n,this.instance.getContainer()),this.instance.getId(n));return this.instance.setPosition(n,t),n.style.width=e.w+"px",n.style.height=e.h+"px",this.instance.manage(n),this.placeholderInfo.id=i,this.placeholderInfo.element=n}},{key:"_cleanupDraggablePlaceholder",value:function(){this.placeholderInfo.element&&(this.instance.unmanage(this.placeholderInfo.element,!0),delete this.placeholderInfo.element,delete this.placeholderInfo.id)}},{key:"reset",value:function(){var t=this.instance.getContainer();this.instance.off(t,I,this.mouseupHandler),this.instance.off(t,M,this.mousedownHandler)}},{key:"init",value:function(t){}},{key:"startNewConnectionDrag",value:function(t,e){this.jpc=this.instance._newConnection({sourceEndpoint:this.ep,targetEndpoint:this.floatingEndpoint,source:this.ep.element,target:this.placeholderInfo.element,paintStyle:this.ep.connectorStyle,hoverPaintStyle:this.ep.connectorHoverStyle,connector:this.ep.connector,overlays:this.ep.connectorOverlays,type:this.ep.edgeType,cssClass:this.ep.connectorClass,hoverClass:this.ep.connectorHoverClass,scope:t,data:e}),this.jpc.pending=!0,this.jpc.addClass(this.instance.draggingClass),this.floatingEndpoint.addClass(this.instance.draggingClass),this.instance.fire(Wr,this.jpc)}},{key:"startExistingConnectionDrag",value:function(){this.existingJpc=!0,this.instance.setHover(this.jpc,!1);var t=this.jpc.endpoints[0].id===this.ep.id?0:1;this.ep.detachFromConnection(this.jpc,null,!0),this.floatingEndpoint.addConnection(this.jpc),this.floatingEndpoint.addClass(this.instance.draggingClass),this.instance.fire(Wr,this.jpc),this.instance.sourceOrTargetChanged(this.jpc.endpoints[t].elementId,this.placeholderInfo.id,this.jpc,this.placeholderInfo.element,t),this.jpc.suspendedEndpoint=this.jpc.endpoints[t],this.jpc.suspendedElement=this.jpc.endpoints[t].element,this.jpc.suspendedElementId=this.jpc.endpoints[t].elementId,this.jpc.suspendedElementType=0==t?Ie:je,this.instance.setHover(this.jpc.suspendedEndpoint,!1),this.floatingEndpoint.referenceEndpoint=this.jpc.suspendedEndpoint,this.floatingEndpoint.mergeParameters(this.jpc.suspendedEndpoint.parameters),this.jpc.endpoints[t]=this.floatingEndpoint,this.jpc.addClass(this.instance.draggingClass),this.floatingId=this.placeholderInfo.id,this.floatingIndex=t}},{key:"_shouldStartDrag",value:function(){var t=!0,e=(this.ep.enabled||(t=!1),null!=this.jpc||this.ep.isSource||this.ep.isTemporarySource||(t=!1),!this.ep.isSource||!this.ep.isFull()||null!=this.jpc&&this.ep.dragAllowedWhenFull||(t=!1),null==this.jpc||this.jpc.isDetachable(this.ep)||(this.ep.isFull()?t=!1:this.jpc=null),{}),n=this.instance.checkCondition(null==this.jpc?wn:Dn,{endpoint:this.ep,source:this.ep.element,sourceId:this.ep.elementId,connection:this.jpc});return!1===n?t=!1:"object"===Ys(n)?p(e=n,this.payload||{}):e=this.payload||{},[t,e]}},{key:"_createFloatingEndpoint",value:function(t){var e,n,i,o,s=this.ep.endpoint;null!=this.ep.edgeType&&(s=this.instance._deriveEndpointAndAnchorSpec(this.ep.edgeType).endpoints[1]),this.floatingEndpoint=(e=this.ep,s=s,n=this.placeholderInfo.element,i=this.instance,o=xi(i,n),o={paintStyle:e.getPaintStyle(),preparedAnchor:o,element:n,scope:e.scope},null!=s&&(pt(s,ae)?o.existingEndpoint=s:o.endpoint=s),n=i._internal_newEndpoint(o),i._paintEndpoint(n,{}),n),this.floatingAnchor=this.floatingEndpoint._anchor,this.floatingEndpoint.deleteOnEmpty=!0,this.floatingElement=this.floatingEndpoint.endpoint.canvas,this.floatingId=this.instance.getId(this.floatingElement)}},{key:"_populateTargets",value:function(i,t,o){var s,r,a=this,l=this.jpc&&this.jpc.endpoints[0]===this.ep;y(this.instance.getContainer().querySelectorAll([".",Ke,"[",Xe,this.ep.scope,"]"].join("")),function(t){var e,n;null==a.jpc&&t===i||t===a.floatingElement||t.jtk.endpoint.isFull()||(l&&t.jtk.endpoint.isSource||!l&&t.jtk.endpoint.isTarget)&&(e=a.instance.getOffset(t),n=a.instance.getSize(t),s={x:e.x,y:e.y,w:n.w,h:n.h},a.endpointDropTargets.push({el:t,targetEl:t,r:s,endpoint:t.jtk.endpoint,def:null}),a.instance.addClass(t,Ll))}),l?null!=(r=Z(this.instance.sourceSelectors,function(t){return t.isEnabled()&&(null==t.def.def.scope||t.def.def.scope===a.ep.scope)}))&&y(this.instance.getContainer().querySelectorAll("any"===r.redrop?h:r.selector),function(t){var e,n;t.getAttribute(Ar)===qt||null!=(e=t.getAttribute(Or))&&e!==a.ep.scope||((e={r:null,el:t}).targetEl=nr(t,h,a.instance.getContainer(),!0),t=a.instance.getOffset(e.el),n=a.instance.getSize(e.el),e.r={x:t.x,y:t.y,w:n.w,h:n.h},null!=r.def.def.rank&&(e.rank=r.def.def.rank),e.def=r,a.endpointDropTargets.push(e),a.instance.addClass(e.targetEl,Ll))}):$(this.instance.targetSelectors,function(t){return t.isEnabled()}).forEach(function(i){y(a.instance.getContainer().querySelectorAll(i.selector),function(t){var e,n;t.getAttribute(Ar)===qt||null!=(e=t.getAttribute(Or))&&e!==a.ep.scope||(e={r:null,el:t},null!=i.def.def.parentSelector&&(e.targetEl=nr(t,i.def.def.parentSelector,a.instance.getContainer(),!0)),null==e.targetEl&&(e.targetEl=nr(t,h,a.instance.getContainer(),!0)),(!1===i.def.def.allowLoopback||a._activeDefinition&&!1===a._activeDefinition.def.def.allowLoopback)&&e.targetEl===a.ep.element)||null!=i.def.def.canAcceptNewConnection&&!i.def.def.canAcceptNewConnection(e.targetEl,o)||null!=(n=i.def.def.maxConnections)&&-1!==n&&a.instance.select({target:e.targetEl}).length>=n||(n=a.instance.getOffset(t),t=a.instance.getSize(t),e.r={x:n.x,y:n.y,w:t.w,h:t.h},e.def=i.def,null!=i.def.def.rank&&(e.rank=i.def.def.rank),a.endpointDropTargets.push(e),a.instance.addClass(e.targetEl,Ll))})}),this.endpointDropTargets.sort(function(t,e){return t.targetEl._isJsPlumbGroup&&!e.targetEl._isJsPlumbGroup?1:!t.targetEl._isJsPlumbGroup&&e.targetEl._isJsPlumbGroup?-1:t.targetEl._isJsPlumbGroup&&e.targetEl._isJsPlumbGroup?a.instance.groupManager.isAncestor(t.targetEl._jsPlumbGroup,e.targetEl._jsPlumbGroup)?-1:a.instance.groupManager.isAncestor(e.targetEl._jsPlumbGroup,t.targetEl._jsPlumbGroup)?1:void 0:null!=t.rank&&null!=e.rank?t.rank>e.rank?-1:t.rank<e.rank?1:void 0:0})}},{key:"onStart",value:function(t){this.endpointDropTargets.length=0,this.currentDropTarget=null,this._stopped=!1;var e=t.drag.getDragElement(),e=(this.ep=e.jtk.endpoint,t.e.srcElement||t.e.target);if(!this.ep)return!1;this.endpointRepresentation=this.ep.endpoint,this.canvasElement=this.endpointRepresentation.canvas,this.jpc=this.ep.connectorSelector();var n=$s(this._shouldStartDrag(),2),i=n[0],n=n[1];if(!1===i)return!(this._stopped=!0);this.instance.setHover(this.ep,!1),this.instance.isConnectionBeingDragged=!0,this.jpc&&!this.ep.isFull()&&this.ep.isSource&&(this.jpc=null),this._createFloatingEndpoint(this.canvasElement),this._populateTargets(this.canvasElement,e,t.e),null==this.jpc?this.startNewConnectionDrag(this.ep.scope,n):this.startExistingConnectionDrag(),this._registerFloatingConnection(this.placeholderInfo,this.jpc,this.floatingEndpoint),this.instance.currentlyDragging=!0}},{key:"onBeforeStart",value:function(t){this.payload=t.e.payload||{}}},{key:"onDrag",value:function(t){if(this._stopped)return!0;if(this.placeholderInfo.element){for(var e,n,i=this.instance.getSize(this.floatingElement),o=(this.instance.setElementPosition(this.placeholderInfo.element,t.pos.x,t.pos.y),{x:t.pos.x,y:t.pos.y,w:i.w,h:i.h}),s=0;s<this.endpointDropTargets.length;s++)if(jt(o,this.endpointDropTargets[s].r)){e=this.endpointDropTargets[s];break}e!==this.currentDropTarget&&null!=this.currentDropTarget&&(n=this._getFloatingAnchorIndex(),this.instance.removeClass(this.currentDropTarget.el,Rl),this.currentDropTarget.endpoint&&(this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.out()),null!=e&&(this.instance.addClass(e.el,Rl),n=this._getFloatingAnchorIndex(),null!=e.endpoint)&&(e.endpoint.isSource&&0===n||e.endpoint.isTarget&&0!==n||this.jpc.suspendedEndpoint&&e.endpoint.referenceEndpoint&&e.endpoint.referenceEndpoint.id===this.jpc.suspendedEndpoint.id?(this.instance.checkCondition(ze,{sourceEndpoint:this.jpc.endpoints[n],targetEndpoint:e.endpoint.endpoint,connection:this.jpc})?(e.endpoint.endpoint.addClass(this.instance.endpointDropAllowedClass),e.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)):(e.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),e.endpoint.endpoint.addClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.over(e.endpoint),this.instance._paintConnection(this.jpc)):e=null),this.currentDropTarget=e}}},{key:"_maybeCleanup",value:function(t){t._mtNew&&0===t.connections.length?this.instance.deleteEndpoint(t):delete t._mtNew}},{key:"_reattachOrDiscard",value:function(t){var e=null!=this.jpc.suspendedEndpoint,n=this._getFloatingAnchorIndex();return e&&this._shouldReattach(t)?(0===n?(this.jpc.source=this.jpc.suspendedElement,this.jpc.sourceId=this.jpc.suspendedElementId):(this.jpc.target=this.jpc.suspendedElement,this.jpc.targetId=this.jpc.suspendedElementId),this._doForceReattach(n),!0):(this._discard(n,t),!1)}},{key:"onStop",value:function(t){var e,n,i,o,s=this,r=t.e,a=(this.instance.isConnectionBeingDragged=!1,this.instance.currentlyDragging=!1,De(Rl,Ll));y(this.instance.getContainer().querySelectorAll(Ul),function(t){s.instance.removeClass(t,a)}),this.jpc&&null!=this.jpc.endpoints&&(e=null!=this.jpc.suspendedEndpoint,n=this._getFloatingAnchorIndex(),i=this.jpc.suspendedEndpoint,null==this.currentDropTarget||null==(o=this._getDropEndpoint(t,this.jpc))?this._reattachOrDiscard(t.e):i&&i.id===o.id?this._doForceReattach(n):o.enabled?o.isFull()?(o.fire(bn,{endpoint:this,connection:this.jpc,maxConnections:this.instance.defaults.maxConnections},r),this._reattachOrDiscard(t.e)):(0===n?(this.jpc.source=o.element,this.jpc.sourceId=o.elementId):(this.jpc.target=o.element,this.jpc.targetId=o.elementId),i=!0,(i=(i=!e||this.jpc.suspendedEndpoint.id===o.id||this.jpc.isDetachAllowed(this.jpc)&&this.jpc.endpoints[n].isDetachAllowed(this.jpc)&&this.jpc.suspendedEndpoint.isDetachAllowed(this.jpc)&&this.instance.checkCondition("beforeDetach",this.jpc)?i:!1)&&o.isDropAllowed(this.jpc.sourceId,this.jpc.targetId,this.jpc.scope,this.jpc,o))?this._drop(o,n,r,i):this._reattachOrDiscard(t.e)):this._reattachOrDiscard(t.e),this.instance._refreshEndpoint(this.ep),this.ep.removeClass(this.instance.draggingClass),this._cleanupDraggablePlaceholder(),this.jpc.removeClass(this.instance.draggingClass),delete this.jpc.suspendedEndpoint,delete this.jpc.suspendedElement,delete this.jpc.suspendedElementType,delete this.jpc.suspendedElementId,delete this.jpc.suspendedIndex,delete this.floatingId,delete this.floatingIndex,delete this.floatingElement,delete this.floatingEndpoint,delete this.floatingAnchor,delete this.jpc.pending,null!=o)&&this._maybeCleanup(o)}},{key:"_getSourceDefinition",value:function(t){for(var e=0;e<this.instance.sourceSelectors.length;e++){var n=this.instance.sourceSelectors[e];if(n.isEnabled())if(!1!==function(t,e,n,i,o){for(var s=t.target||t.srcElement,r=!1,a=i.getSelector(e,n),l=0;l<a.length;l++)if(a[l]===s){r=!0;break}return o?!r:r}(t,this.instance.getContainer(),n.selector,this.instance,n.exclude))return n}}},{key:"_getDropEndpoint",value:function(t,e){if(null==this.currentDropTarget.endpoint){var n=this.currentDropTarget.def,i=t.e.target||t.e.srcElement;if(null==n)return null;var o=this.currentDropTarget.targetEl,s=lc(t.e,o,this.instance.currentZoom),e=this.instance._deriveEndpointAndAnchorSpec(e.getType().join(" "),!0),r=e.endpoints?p(t,{endpoint:n.def.endpoint||e.endpoints[1]}):t,e=this.instance.validAnchorsSpec(e.anchors)?e.anchors:this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors:null,a=n.def.anchor,s=n.def.anchorPositionFinder?n.def.anchorPositionFinder(o,s,n.def,t.e):null,s=null!=s?s:null!=a?a:null!=e&&null!=e[1]?e[1]:null,a=(null!=s&&(r=p(r,{anchor:s})),null!=n.def.portId&&(r.portId=n.def.portId),n.def.parameterExtractor?n.def.parameterExtractor(this.currentDropTarget.el,i,t.e):{});if((r=U(r,a)).element=o,(s=this.instance._internal_newEndpoint(r))._mtNew=!0,s.deleteOnEmpty=!0,n.def.parameters&&s.mergeParameters(n.def.parameters),n.def.extract){var l,c={};for(l in n.def.extract){var u=this.currentDropTarget.el.getAttribute(l);u&&(c[n.def.extract[l]]=u)}s.mergeParameters(c)}}else s=this.currentDropTarget.endpoint;return s&&(s.removeClass(this.instance.endpointDropAllowedClass),s.removeClass(this.instance.endpointDropForbiddenClass)),s}},{key:"_doForceReattach",value:function(t){this.floatingEndpoint.detachFromConnection(this.jpc,null,!0),this.jpc.endpoints[t]=this.jpc.suspendedEndpoint,this.instance.setHover(this.jpc,!1),this.jpc._forceDetach=!0,this.jpc.suspendedEndpoint.addConnection(this.jpc),this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.suspendedEndpoint.elementId,this.jpc,this.jpc.suspendedEndpoint.element,t),this.instance.deleteEndpoint(this.floatingEndpoint),this.instance.repaint(this.jpc.source),delete this.jpc._forceDetach}},{key:"_shouldReattach",value:function(t){return this.jpc.isReattach()||this.jpc._forceReattach||!W(!0,!1,[[this.jpc.endpoints[0],Tn,[this.jpc]],[this.jpc.endpoints[1],Tn,[this.jpc]],[this.jpc,Tn,[this.jpc]],[this.instance,Ye,[On,this.jpc]]])}},{key:"_discard",value:function(t,e){this.jpc.pending?this.instance.fire(zr,this.jpc,e):(0===t?(this.jpc.source=this.jpc.suspendedEndpoint.element,this.jpc.sourceId=this.jpc.suspendedEndpoint.elementId):(this.jpc.target=this.jpc.suspendedEndpoint.element,this.jpc.targetId=this.jpc.suspendedEndpoint.elementId),this.jpc.endpoints[t]=this.jpc.suspendedEndpoint),this.floatingEndpoint&&this.floatingEndpoint.detachFromConnection(this.jpc),this.instance.deleteConnection(this.jpc,{originalEvent:e,force:!0})}},{key:"_drop",value:function(t,e,n,i){var o;this.jpc.endpoints[e].detachFromConnection(this.jpc),this.jpc.suspendedEndpoint&&this.jpc.suspendedEndpoint.detachFromConnection(this.jpc),(this.jpc.endpoints[e]=t).addConnection(this.jpc),this.jpc.suspendedEndpoint&&(o=this.jpc.suspendedEndpoint.elementId,this.instance.fireMoveEvent({index:e,originalSourceId:0===e?o:this.jpc.sourceId,newSourceId:0===e?t.elementId:this.jpc.sourceId,originalTargetId:1===e?o:this.jpc.targetId,newTargetId:1===e?t.elementId:this.jpc.targetId,originalEndpoint:this.jpc.suspendedEndpoint,connection:this.jpc,newEndpoint:t},n)),1===e?this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.targetId,this.jpc,this.jpc.target,1):this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.sourceId,this.jpc,this.jpc.source,0),this.jpc.endpoints[0].finalEndpoint&&(this.jpc.endpoints[0].detachFromConnection(this.jpc),this.jpc.endpoints[0]=this.jpc.endpoints[0].finalEndpoint,this.jpc.endpoints[0].addConnection(this.jpc)),F(i)&&this.jpc.mergeData(i),this._originalAnchorSpec&&(this.jpc.endpoints[0].setAnchor(this._originalAnchorSpec),this._originalAnchorSpec=null),this.instance._finaliseConnection(this.jpc,null,n),this.instance.setHover(this.jpc,!1),this.instance.revalidate(this.jpc.endpoints[0].element)}},{key:"_registerFloatingConnection",value:function(t,e,n){this.floatingConnections[t.id]=e,it(this.instance.endpointsByElement,t.id,n)}},{key:"_getFloatingAnchorIndex",value:function(){return null==this.floatingIndex?1:this.floatingIndex}}]),zl);function zl(t){_(this,zl),this.instance=t,E(this,"jpc",void 0),E(this,"existingJpc",void 0),E(this,"_originalAnchorSpec",void 0),E(this,"ep",void 0),E(this,"endpointRepresentation",void 0),E(this,"canvasElement",void 0),E(this,"_activeDefinition",void 0),E(this,"placeholderInfo",{id:null,element:null}),E(this,"floatingIndex",void 0),E(this,"floatingId",void 0),E(this,"floatingElement",void 0),E(this,"floatingEndpoint",void 0),E(this,"floatingAnchor",void 0),E(this,"_stopped",void 0),E(this,"inPlaceCopy",void 0),E(this,"endpointDropTargets",[]),E(this,"currentDropTarget",null),E(this,"payload",void 0),E(this,"floatingConnections",{}),E(this,"_forceReattach",void 0),E(this,"_forceDetach",void 0),E(this,"mousedownHandler",void 0),E(this,"mouseupHandler",void 0),E(this,"selector",Oe(Ke));var e=t.getContainer();this.mousedownHandler=this._mousedownHandler.bind(this),this.mouseupHandler=this._mouseupHandler.bind(this),t.on(e,M,h,this.mousedownHandler),t.on(e,I,[h,Oe(Ke)].join(","),this.mouseupHandler)}Ws(Jl,Vl),Wl=Ks(Jl),x(Jl,[{key:"reset",value:function(){this.drag.off(Yr,this.doRevalidate)}},{key:"_revalidate",value:function(t){this.instance.revalidate(t)}},{key:"init",value:function(t){(this.drag=t).on(Yr,this.doRevalidate)}},{key:"useGhostProxy",value:function(t,e){e=e._jsPlumbParentGroup;return null!=e&&!0===e.ghost}},{key:"makeGhostProxy",value:function(t){var e=t.cloneNode(!0);return e._jsPlumbParentGroup=t._jsPlumbParentGroup,e}}]);var Wl,ql=Jl;function Jl(t,e){var n;return _(this,Jl),(n=Wl.call(this,t,e)).instance=t,n.dragSelection=e,E(P(n),"selector",[">",Ca,h].join(" ")),E(P(n),"doRevalidate",void 0),n.doRevalidate=n._revalidate.bind(P(n)),n}x(Zl,null,[{key:"getElement",value:function(t,e,n){if(null==t.canvas){for(var i in n&&e?(t.canvas=n(e),n=t.instance.overlayClass+" "+(t.cssClass||""),t.instance.addClass(t.canvas,n)):t.canvas=hr(jr,{},t.instance.overlayClass+" "+(t.cssClass||"")),t.instance.setAttribute(t.canvas,"jtk-overlay-id",t.id),t.attributes)t.instance.setAttribute(t.canvas,i,t.attributes[i]);t.canvas.style.position=Ge,t.instance._appendElement(t.canvas,t.instance.getContainer()),t.instance.getId(t.canvas);e="translate(-50%, -50%)";t.canvas.style.webkitTransform=e,t.canvas.style.mozTransform=e,t.canvas.style.msTransform=e,t.canvas.style.oTransform=e,t.canvas.style.transform=e,t.isVisible()||(t.canvas.style.display=Le),t.canvas.jtk={overlay:t}}return t.canvas}},{key:"destroy",value:function(t){t.canvas&&t.canvas.parentNode&&t.canvas.parentNode.removeChild(t.canvas),delete t.canvas,delete t.cachedDimensions}},{key:"_getDimensions",value:function(t,e){return null!=t.cachedDimensions&&!e||(t.cachedDimensions={w:1,h:1}),t.cachedDimensions}}]);var Kl=Zl;function Zl(t,e){_(this,Zl),this.instance=t,this.overlay=e,E(this,"htmlElementOverlay",void 0),this.htmlElementOverlay=e}Ws(tc,Fn),$l=Ks(tc),x(tc,null,[{key:"ensurePath",value:function(t){var e,n;return null==t.path&&(e=p({"jtk-overlay-id":t.id},t.attributes),t.path=br(_r,e),e=null,t.component instanceof Ii?e=null!=(n=t.component.connector)?n.canvas:null:t.component instanceof Gi&&(e=null!=(n=t.component.endpoint)?n.svg:n),null!=e&&Sr(e,t.path,1),n=t.instance.overlayClass+" "+(t.cssClass||""),t.instance.addClass(t.path,n),t.path.jtk={overlay:t}),t.path}},{key:"paint",value:function(t,e,n,i){this.ensurePath(t);var o=[0,0],i=(i.xmin<0&&(o[0]=-i.xmin),i.ymin<0&&(o[1]=-i.ymin),{d:e,stroke:n.stroke||null,fill:n.fill||null,transform:"translate("+o[0]+","+o[1]+")","pointer-events":"visibleStroke"});Er(t.path,i)}},{key:"destroy",value:function(t,e){null!=t.path&&null!=t.path.parentNode&&t.path.parentNode.removeChild(t.path),null!=t.bgPath&&null!=t.bgPath.parentNode&&t.bgPath.parentNode.removeChild(t.bgPath),delete t.path,delete t.bgPath}}]);var $l,Ql=tc;function tc(){var t;_(this,tc);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return E(P(t=$l.call.apply($l,[this].concat(n))),"path",void 0),t}x(nc,null,[{key:"paint",value:function(t,e,n,i){var o,s;null!=n&&(n=[t.x,t.y],o=[t.w,t.h],null!=i&&(i.xmin<0&&(n[0]+=i.xmin),i.ymin<0&&(n[1]+=i.ymin),o[0]=i.xmax+(i.xmin<0?-i.xmin:0),o[1]=i.ymax+(i.ymin<0?-i.ymin:0)),isFinite(o[0]))&&isFinite(o[1])&&(e?(Pr(t.canvas,n[0],n[1],o[0],o[1]),n[0]=0,s=kr([n[1]=0,0]),Er(t.svg,{style:s,width:""+(o[0]||0),height:""+(o[1]||0)})):(s=kr([n[0],n[1]]),Er(t.canvas,{style:s,width:""+(o[0]||0),height:""+(o[1]||0)})))}}]);var ec=nc;function nc(){_(this,nc)}function ic(t,e,n,i){var o,s=t,r=e,s=(null!=r.canvas?r.canvas:(o=br(mr,{style:"",width:"0",height:"0","pointer-events":Le,position:Ge}),r.canvas=o,s._appendElement(r.canvas,s.getContainer()),null!=r.cssClass&&s.addClass(o,r.cssClass),s.addClass(o,s.connectorClass),o.jtk=o.jtk||{},o.jtk.connector=r),ec.paint(e,!1,n,i),[0,0]);i.xmin<0&&(s[0]=-i.xmin),i.ymin<0&&(s[1]=-i.ymin),0<e.segments.length&&(o={d:t.getPathData(e),transform:"translate("+s[0]+","+s[1]+")","pointer-events":"visibleStroke"},r=null,n.outlineStroke&&(i=n.outlineWidth||1,s=n.strokeWidth+2*i,(r=p({},n)).stroke=n.outlineStroke,r.strokeWidth=s,null==e.bgPath?(e.bgPath=br(_r,o),t.addClass(e.bgPath,t.connectorOutlineClass),Sr(e.canvas,e.bgPath,0)):Er(e.bgPath,o),Cr(e.canvas,e.bgPath,r)),null==(i=e).path?(i.path=br(_r,o),Sr(i.canvas,i.path,n.outlineStroke?1:0)):(i.path.parentNode!==i.canvas&&Sr(i.canvas,i.path,n.outlineStroke?1:0),Er(e.path,o)),Cr(e.canvas,e.path,n))}x(sc,null,[{key:"getEndpointElement",value:function(t){if(null!=t.canvas)return t.canvas;for(var e=br(mr,{style:"",width:"0",height:"0","pointer-events":Le,position:Ge}),n=(t.svg=e,hr(jr,{position:Ge})),i=(t.canvas=n,t.classes.join(" ")),o=(t.instance.addClass(n,i),t.endpoint.scope.split(/\s/)),s=0;s<o.length;s++)t.instance.setAttribute(n,Xe+o[s],Wt);return t.instance._suspendDrawing||Pr(n,0,0,1,1),t.instance._appendElement(n,t.instance.getContainer()),n.appendChild(e),null!=t.cssClass&&t.instance.addClass(n,t.cssClass),t.instance.addClass(n,t.instance.endpointClass),n.jtk=n.jtk||{},n.jtk.endpoint=t.endpoint,n.style.display=!1!==t.endpoint.visible?Ne:Le,n}},{key:"paint",value:function(t,e,n){!0!==t.endpoint.deleted&&(this.getEndpointElement(t),ec.paint(t,!0,n),(n=p({},n)).outlineStroke&&(n.stroke=n.outlineStroke),null==t.node?(t.node=e.makeNode(t,n),t.svg.appendChild(t.node)):null!=e.updateNode&&e.updateNode(t,t.node),Cr(t.canvas,t.node,n))}}]);var oc=sc;function sc(){_(this,sc)}var rc={};function ac(t,e){rc[t]=e}function lc(t,e,n){var i=e,e=Ys(e.getBoundingClientRect)!==Yt?e.getBoundingClientRect():{left:0,top:0,width:0,height:0},o=document.body,s=document.documentElement,r=window.pageYOffset||s.scrollTop||o.scrollTop,a=window.pageXOffset||s.scrollLeft||o.scrollLeft,l=s.clientTop||o.clientTop||0,s=s.clientLeft||o.clientLeft||0,o=e.top+r-l+0*n,r=e.left+a-s+0*n,l=La(t),a=e.width||i.offsetWidth*n,s=e.height||i.offsetHeight*n;return{x:(l.x-r)/a,y:(l.y-o)/s}}function cc(t){return Go(t)||Yo(t)||Vo(t)}function uc(t,e){t.canvas&&(t.canvas.style.display=e?"block":"none")}function hc(t){t.canvas&&t.canvas.parentNode.removeChild(t.canvas),delete t.canvas,delete t.svg}function dc(t){return t.canvas}function pc(t){return Kl.getElement(t)}function fc(e){return Kl.getElement(e,e.component,function(t){t=e.create(t);return e.instance.addClass(t,e.instance.overlayClass),t})}function yc(t,e,n,i){var o=t.x,s=t.y;return e._jsPlumbParentGroup&&e._jsPlumbParentGroup.constrain&&(o=Math.max(t.x,0),s=Math.max(t.y,0),o=Math.min(o,n.w-i.w),s=Math.min(s,n.h-i.h)),{x:o,y:s}}Ws(mc,yi),vc=Ks(mc),x(mc,[{key:"fireOverlayMethod",value:function(t,e,n){var i=O(t.component instanceof Ii?Ir:Dr,e);(n._jsPlumbOverlay=t).fire(e,{e:n,overlay:t}),this.fire(i,t.component,n)}},{key:"addDragFilter",value:function(t,e){this.dragManager.addFilter(t,e)}},{key:"removeDragFilter",value:function(t){this.dragManager.removeFilter(t)}},{key:"setDragGrid",value:function(t){this.dragManager.setOption(this.elementDragHandler,{grid:t})}},{key:"_removeElement",value:function(t){t.parentNode&&t.parentNode.removeChild(t)}},{key:"_appendElement",value:function(t,e){e&&e.appendChild(t)}},{key:"_getAssociatedElements",value:function(t){var e=[];return 3!==t.nodeType&&8!==t.nodeType&&(t=t.querySelectorAll(h),Array.prototype.push.apply(e,t)),e.filter(function(t){return 3!==t.nodeType&&8!==t.nodeType})}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"getClass",value:rr},{key:"addClass",value:function(t,e){ar(t,e)}},{key:"hasClass",value:lr},{key:"removeClass",value:function(t,e){cr(t,e)}},{key:"toggleClass",value:function(t,e){ur(t,e)}},{key:"setAttribute",value:function(t,e,n){t.setAttribute(e,n)}},{key:"getAttribute",value:function(t,e){return t.getAttribute(e)}},{key:"setAttributes",value:function(t,e){for(var n in e)t.setAttribute(n,e[n])}},{key:"removeAttribute",value:function(t,e){t.removeAttribute&&t.removeAttribute(e)}},{key:"on",value:function(t,e,n,i){function o(t){null==i?s.eventManager.on(t,e,n):s.eventManager.on(t,e,n,i)}var s=this;return sr(t)?y(t,function(t){o(t)}):o(t),this}},{key:"off",value:function(t,e,n){var i=this;return sr(t)?y(t,function(t){i.eventManager.off(t,e,n)}):this.eventManager.off(t,e,n),this}},{key:"trigger",value:function(t,e,n,i,o){this.eventManager.trigger(t,e,n,i,o)}},{key:"getOffsetRelativeToRoot",value:pr},{key:"getOffset",value:function(t){for(var e,n=t,i=this.getContainer(),o={x:n.offsetLeft,y:n.offsetTop},s=t!==i&&n.offsetParent!==i?n.offsetParent:null;null!=s;)o.x+=s.offsetLeft,o.y+=s.offsetTop,null!=(e=s)&&e!==document.body&&(0<e.scrollTop||0<e.scrollLeft)&&(o.x-=e.scrollLeft,o.y-=e.scrollTop),s=s.offsetParent===i?null:s.offsetParent;return null!=i&&(0<i.scrollTop||0<i.scrollLeft)&&(t=null!=n.offsetParent?this.getStyle(n.offsetParent,Ea):"static",(n=this.getStyle(n,Ea))!==Ge)&&n!==Re&&t!==Ge&&t!==Re&&(o.x-=i.scrollLeft,o.y-=i.scrollTop),o}},{key:"getSize",value:fr},{key:"getStyle",value:function(t,e){return Ys(window.getComputedStyle)!==Yt?getComputedStyle(t,null).getPropertyValue(e):t.currentStyle[e]}},{key:"getGroupContentArea",value:function(t){var e=this.getSelector(t.el,Sa);return e&&0<e.length?e[0]:t.el}},{key:"getSelector",value:function(t,e){var n,i=null;if(1===arguments.length){if(!f(t))return(n=document.createDocumentFragment()).appendChild(t),et(n.childNodes);i=et(document.querySelectorAll(t))}else i=et(t.querySelectorAll(e));return i}},{key:"setPosition",value:function(t,e){t.style.left=e.x+"px",t.style.top=e.y+"px"}},{key:"setDraggable",value:function(t,e){e?this.removeAttribute(t,Ve):this.setAttribute(t,Ve,Wt)}},{key:"isDraggable",value:function(t){t=this.getAttribute(t,Ve);return null==t||t===qt}},{key:"toggleDraggable",value:function(t){var e=this.isDraggable(t);return this.setDraggable(t,!e),!e}},{key:"_attachEventDelegates",value:function(){var t=this.getContainer();this.eventManager.on(t,D,Pa,this._overlayClick),this.eventManager.on(t,Lr,Pa,this._overlayDblClick),this.eventManager.on(t,Vr,Pa,this._overlayTap),this.eventManager.on(t,Gr,Pa,this._overlayDblTap),this.eventManager.on(t,D,ba,this._connectorClick),this.eventManager.on(t,Lr,ba,this._connectorDblClick),this.eventManager.on(t,Vr,ba,this._connectorTap),this.eventManager.on(t,Gr,ba,this._connectorDblTap),this.eventManager.on(t,D,ka,this._endpointClick),this.eventManager.on(t,Lr,ka,this._endpointDblClick),this.eventManager.on(t,D,this.managedElementsSelector,this._elementClick),this.eventManager.on(t,Vr,this.managedElementsSelector,this._elementTap),this.eventManager.on(t,Gr,this.managedElementsSelector,this._elementDblTap),this.eventManager.on(t,N,ba,this._connectorMouseover),this.eventManager.on(t,j,ba,this._connectorMouseout),this.eventManager.on(t,Nr,ba,this._connectorContextmenu),this.eventManager.on(t,I,ba,this._connectorMouseup),this.eventManager.on(t,M,ba,this._connectorMousedown),this.eventManager.on(t,N,ka,this._endpointMouseover),this.eventManager.on(t,j,ka,this._endpointMouseout),this.eventManager.on(t,I,ka,this._endpointMouseup),this.eventManager.on(t,M,ka,this._endpointMousedown),this.eventManager.on(t,N,Pa,this._overlayMouseover),this.eventManager.on(t,j,Pa,this._overlayMouseout),this.eventManager.on(t,N,h,this._elementMouseenter),this.eventManager.on(t,j,h,this._elementMouseexit),this.eventManager.on(t,Br,h,this._elementMousemove),this.eventManager.on(t,I,h,this._elementMouseup),this.eventManager.on(t,M,h,this._elementMousedown),this.eventManager.on(t,Nr,h,this._elementContextmenu)}},{key:"_detachEventDelegates",value:function(){var t=this.getContainer();t&&(this.eventManager.off(t,D,this._connectorClick),this.eventManager.off(t,Lr,this._connectorDblClick),this.eventManager.off(t,Vr,this._connectorTap),this.eventManager.off(t,Gr,this._connectorDblTap),this.eventManager.off(t,D,this._endpointClick),this.eventManager.off(t,Lr,this._endpointDblClick),this.eventManager.off(t,D,this._overlayClick),this.eventManager.off(t,Lr,this._overlayDblClick),this.eventManager.off(t,Vr,this._overlayTap),this.eventManager.off(t,Gr,this._overlayDblTap),this.eventManager.off(t,D,this._elementClick),this.eventManager.off(t,Vr,this._elementTap),this.eventManager.off(t,Gr,this._elementDblTap),this.eventManager.off(t,N,this._connectorMouseover),this.eventManager.off(t,j,this._connectorMouseout),this.eventManager.off(t,Nr,this._connectorContextmenu),this.eventManager.off(t,I,this._connectorMouseup),this.eventManager.off(t,M,this._connectorMousedown),this.eventManager.off(t,N,this._endpointMouseover),this.eventManager.off(t,j,this._endpointMouseout),this.eventManager.off(t,I,this._endpointMouseup),this.eventManager.off(t,M,this._endpointMousedown),this.eventManager.off(t,N,this._overlayMouseover),this.eventManager.off(t,j,this._overlayMouseout),this.eventManager.off(t,Rr,this._elementMouseenter),this.eventManager.off(t,Fr,this._elementMouseexit),this.eventManager.off(t,Br,this._elementMousemove),this.eventManager.off(t,I,this._elementMouseup),this.eventManager.off(t,M,this._elementMousedown),this.eventManager.off(t,Nr,this._elementContextmenu))}},{key:"setContainer",value:function(e){var t,n=this;if(e===document||e===document.body)throw new Error("Cannot set document or document.body as container element");this._detachEventDelegates(),null!=this.dragManager&&(t=this.dragManager.reset()),this.setAttribute(e,Tr,T().replace("-",""));var i=this.getContainer();null!=i&&(i.removeAttribute(Tr),y(et(i.childNodes).filter(function(t){return null!=t&&(n.hasClass(t,We)||n.hasClass(t,Ke)||n.hasClass(t,sn)||t.getAttribute&&null!=t.getAttribute(Be))}),function(t){e.appendChild(t)})),Zs(qs(mc.prototype),"setContainer",this).call(this,e),null!=this.eventManager&&this._attachEventDelegates(),null!=this.dragManager&&(this.dragManager.addHandler(new Yl(this)),this.dragManager.addHandler(new ql(this,this.dragSelection),this.groupDragOptions),this.elementDragHandler=new Vl(this,this.dragSelection),this.dragManager.addHandler(this.elementDragHandler,this.elementDragOptions),null!=t)&&this.dragManager.setFilters(t)}},{key:"reset",value:function(){Zs(qs(mc.prototype),"reset",this).call(this),y(this.getContainer().querySelectorAll([h,ka,ba,Pa].join(",")),function(t){t.parentNode&&t.parentNode.removeChild(t)})}},{key:"destroy",value:function(){this._detachEventDelegates(),null!=this.dragManager&&this.dragManager.reset(),this.clearDragSelection(),Zs(qs(mc.prototype),"destroy",this).call(this)}},{key:"unmanage",value:function(t,e){this.removeFromDragSelection(t),Zs(qs(mc.prototype),"unmanage",this).call(this,t,e)}},{key:"addToDragSelection",value:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];y(n,function(t){e.dragSelection.add(t)})}},{key:"clearDragSelection",value:function(){this.dragSelection.clear()}},{key:"removeFromDragSelection",value:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];y(n,function(t){e.dragSelection.remove(t)})}},{key:"toggleDragSelection",value:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];y(n,function(t){e.dragSelection.toggle(t)})}},{key:"addToDragGroup",value:function(t){for(var e,n=arguments.length,i=new Array(1<n?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(e=this.elementDragHandler).addToDragGroup.apply(e,[t].concat(i))}},{key:"removeFromDragGroup",value:function(){var t;(t=this.elementDragHandler).removeFromDragGroup.apply(t,arguments)}},{key:"setDragGroupState",value:function(t){for(var e,n=arguments.length,i=new Array(1<n?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(e=this.elementDragHandler).setDragGroupState.apply(e,[t].concat(i))}},{key:"consume",value:function(t,e){er(t,e)}},{key:"rotate",value:function(t,e,n){var i=this.getId(t);return this._managedElements[i]?(this._managedElements[i].el.style.transform="rotate("+e+"deg)",this._managedElements[i].el.style.transformOrigin="center center",Zs(qs(mc.prototype),"rotate",this).call(this,t,e,n)):{c:new Set,e:new Set}}},{key:"addOverlayClass",value:function(t,e){if(zn(t))t.instance.addClass(pc(t),e);else if(cc(t))t.instance.addClass(Ql.ensurePath(t),e);else{if(!Jo(t))throw"Could not add class to overlay of type ["+t.type+"]";t.instance.addClass(fc(t),e)}}},{key:"removeOverlayClass",value:function(t,e){if(zn(t))t.instance.removeClass(pc(t),e);else if(cc(t))t.instance.removeClass(Ql.ensurePath(t),e);else{if(!Jo(t))throw"Could not remove class from overlay of type ["+t.type+"]";t.instance.removeClass(fc(t),e)}}},{key:"_paintOverlay",value:function(t,e,n){if(zn(t)){pc(t);var i=t.component.getXY();t.canvas.style.left=i.x+e.d.minx+"px",t.canvas.style.top=i.y+e.d.miny+"px"}else if(cc(t)){i=isNaN(e.d.cxy.x)||isNaN(e.d.cxy.y)?"M 0 0":"M"+e.d.hxy.x+","+e.d.hxy.y+" L"+e.d.tail[0].x+","+e.d.tail[0].y+" L"+e.d.cxy.x+","+e.d.cxy.y+" L"+e.d.tail[1].x+","+e.d.tail[1].y+" L"+e.d.hxy.x+","+e.d.hxy.y;Ql.paint(t,i,e,n)}else{if(!Jo(t))throw"Could not paint overlay of type ["+t.type+"]";fc(t);i=t.component.getXY();t.canvas.style.left=i.x+e.d.minx+"px",t.canvas.style.top=i.y+e.d.miny+"px"}}},{key:"setOverlayVisible",value:function(t,e){var n=e?"block":"none";function i(t){null!=t&&(t.style.display=n)}zn(t)?i(pc(t)):Jo(t)?i(fc(t)):cc(t)&&i(t.path)}},{key:"reattachOverlay",value:function(t,e){zn(t)?t.instance._appendElement(pc(t),this.getContainer()):Jo(t)?t.instance._appendElement(fc(t),this.getContainer()):cc(t)&&this._appendElement(Ql.ensurePath(t),e.connector.canvas)}},{key:"setOverlayHover",value:function(t,e){var n;zn(t)?n=pc(t):Jo(t)?n=fc(t):cc(t)&&(n=Ql.ensurePath(t)),null!=n&&(null!=this.hoverClass&&(e?this.addClass(n,this.hoverClass):this.removeClass(n,this.hoverClass)),this.setHover(t.component,e))}},{key:"destroyOverlay",value:function(t){var e;zn(t)?((e=pc(t)).parentNode.removeChild(e),delete t.canvas,delete t.cachedDimensions):Go(t)||Yo(t)||Vo(t)?Ql.destroy(t):Jo(t)&&((e=fc(t)).parentNode.removeChild(e),delete t.canvas,delete t.cachedDimensions)}},{key:"drawOverlay",value:function(t,e,n,i){var o,s,r,a;if(zn(t)||Jo(t))return null!=(o=Kl._getDimensions(t))&&null!=o.w&&null!=o.h?(s={x:0,y:0},{component:t,d:{minx:r=(s=i?{x:i.x,y:i.y}:e instanceof ae?{x:(r=Array.isArray(t.location)?t.location:[t.location,t.location])[0]*e.w,y:r[1]*e.h}:(r=t.location,a=!1,(f(t.location)||t.location<0||1<t.location)&&(r=parseInt(""+t.location,10),a=!0),e.pointOnPath(r,a))).x-o.w/2,miny:a=s.y-o.h/2,td:o,cxy:s},xmin:r,xmax:r+o.w,ymin:a,ymax:a+o.h}):{xmin:0,xmax:0,ymin:0,ymax:0};if(Go(t)||Yo(t)||Vo(t))return t.draw(e,n,i);throw"Could not draw overlay of type ["+t.type+"]"}},{key:"updateLabel",value:function(t){var e;V(t.label)?(e=t.label(this),pc(t).innerText=null!=e?e:""):null==t.labelText&&(t.labelText=t.label,null!=t.labelText?pc(t).innerText=t.labelText:pc(t).innerText="")}},{key:"setHover",value:function(t,e){t._hover=e,t instanceof Gi&&null!=t.endpoint?this.setEndpointHover(t,e,-1):t instanceof Ii&&null!=t.connector&&this.setConnectorHover(t.connector,e)}},{key:"paintConnector",value:function(t,e,n){ic(this,t,e,n)}},{key:"setConnectorHover",value:function(t,e,n){var i;!1!==e&&(this.currentlyDragging||this.isHoverSuspended())||(null!=(i=t.canvas)&&(null!=t.hoverClass&&(e?this.addClass(i,t.hoverClass):this.removeClass(i,t.hoverClass)),e?this.addClass(i,this.hoverClass):this.removeClass(i,this.hoverClass)),null!=t.connection.hoverPaintStyle&&(t.connection.paintStyleInUse=e?t.connection.hoverPaintStyle:t.connection.paintStyle,this._suspendDrawing||this._paintConnection(t.connection)),t.connection.endpoints[0]!==n&&this.setEndpointHover(t.connection.endpoints[0],e,0,!0),t.connection.endpoints[1]!==n&&this.setEndpointHover(t.connection.endpoints[1],e,1,!0))}},{key:"destroyConnector",value:function(t){null!=t.connector&&hc(t.connector)}},{key:"addConnectorClass",value:function(t,e){t.canvas&&this.addClass(t.canvas,e)}},{key:"removeConnectorClass",value:function(t,e){t.canvas&&this.removeClass(t.canvas,e)}},{key:"getConnectorClass",value:function(t){return t.canvas?t.canvas.className.baseVal:""}},{key:"setConnectorVisible",value:function(t,e){uc(t,e)}},{key:"applyConnectorType",value:function(t,e){t.canvas&&e.cssClass&&(e=Array.isArray(e.cssClass)?e.cssClass:[e.cssClass],this.addClass(t.canvas,e.join(" ")))}},{key:"addEndpointClass",value:function(t,e){t=dc(t.endpoint);null!=t&&this.addClass(t,e)}},{key:"applyEndpointType",value:function(t,e){e.cssClass&&(t=dc(t.endpoint))&&(e=Array.isArray(e.cssClass)?e.cssClass:[e.cssClass],this.addClass(t,e.join(" ")))}},{key:"destroyEndpoint",value:function(t){var e=this.endpointAnchorClassPrefix+(t.currentAnchorClass?"-"+t.currentAnchorClass:"");this.removeClass(t.element,e),hc(t.endpoint)}},{key:"renderEndpoint",value:function(t,e){var n=rc[t.endpoint.type];null!=n?oc.paint(t.endpoint,n,e):l("jsPlumb: no endpoint renderer found for type ["+t.endpoint.type+"]")}},{key:"removeEndpointClass",value:function(t,e){t=dc(t.endpoint);null!=t&&this.removeClass(t,e)}},{key:"getEndpointClass",value:function(t){t=dc(t.endpoint);return null!=t?t.className:""}},{key:"setEndpointHover",value:function(t,e,n,i){if(null!=t&&(!1===e||!this.currentlyDragging&&!this.isHoverSuspended())){var o=dc(t.endpoint);if(null!=o&&(null!=t.hoverClass&&(e?this.addClass(o,t.hoverClass):this.removeClass(o,t.hoverClass)),0!==n&&1!==n||(n=0===n?this.hoverSourceClass:this.hoverTargetClass,e?this.addClass(o,n):this.removeClass(o,n))),null!=t.hoverPaintStyle&&(t.paintStyleInUse=e?t.hoverPaintStyle:t.paintStyle,this._suspendDrawing||this.renderEndpoint(t,t.paintStyleInUse)),!i)for(var s=0;s<t.connections.length;s++)this.setConnectorHover(t.connections[s].connector,e,t)}}},{key:"setEndpointVisible",value:function(t,e){uc(t.endpoint,e)}},{key:"setGroupVisible",value:function(t,e){for(var n=t.el.querySelectorAll(h),i=0;i<n.length;i++)e?this.show(n[i],!0):this.hide(n[i],!0)}},{key:"deleteConnection",value:function(t,e){return null!=t&&!0!==t.deleted&&(!0!==t.endpoints[0].deleted&&this.setEndpointHover(t.endpoints[0],!1,0,!0),!0!==t.endpoints[1].deleted&&this.setEndpointHover(t.endpoints[1],!1,1,!0),Zs(qs(mc.prototype),"deleteConnection",this).call(this,t,e))}},{key:"addSourceSelector",value:function(t,e,n){return this.addDragFilter(t),Zs(qs(mc.prototype),"addSourceSelector",this).call(this,t,e,n)}},{key:"removeSourceSelector",value:function(t){this.removeDragFilter(t.selector),Zs(qs(mc.prototype),"removeSourceSelector",this).call(this,t)}}]);var vc,gc=mc;function mc(t,e){function n(t,e){var n;e.defaultPrevented||null!=e._jsPlumbOverlay||(n=nr(A(e),ba,this.getContainer(),!0),this.fire(t,n.jtk.connector.connection,e))}function i(t,e){var n,i,o=A(e).parentNode;o.jtk&&o.jtk.connector&&(i=(n=o.jtk.connector).connection,this.setConnectorHover(n,t),t?(this.addClass(i.source,this.hoverSourceClass),this.addClass(i.target,this.hoverTargetClass)):(this.removeClass(i.source,this.hoverSourceClass),this.removeClass(i.target,this.hoverTargetClass)),this.fire(t?va:ya,o.jtk.connector.connection,e))}function o(t,e){var n=A(e).parentNode;n.jtk&&n.jtk.connector&&this.fire(t?ga:ma,n.jtk.connector.connection,e)}function s(t,e,n){e.defaultPrevented||null!=e._jsPlumbOverlay||this.fire(t,n.jtk.endpoint,e)}function r(t,e){var n=A(e);n.jtk&&n.jtk.endpoint&&(this.setEndpointHover(n.jtk.endpoint,t),this.fire(t?la:aa,n.jtk.endpoint,e))}function a(t,e){var n=A(e);n.jtk&&n.jtk.endpoint&&this.fire(t?ca:ua,n.jtk.endpoint,e)}_(this,mc),(u=vc.call(this,t,e))._instanceIndex=t,E(P(u),"dragSelection",void 0),E(P(u),"dragManager",void 0),E(P(u),"_connectorClick",void 0),E(P(u),"_connectorDblClick",void 0),E(P(u),"_connectorTap",void 0),E(P(u),"_connectorDblTap",void 0),E(P(u),"_endpointClick",void 0),E(P(u),"_endpointDblClick",void 0),E(P(u),"_overlayClick",void 0),E(P(u),"_overlayDblClick",void 0),E(P(u),"_overlayTap",void 0),E(P(u),"_overlayDblTap",void 0),E(P(u),"_connectorMouseover",void 0),E(P(u),"_connectorMouseout",void 0),E(P(u),"_endpointMouseover",void 0),E(P(u),"_endpointMouseout",void 0),E(P(u),"_connectorContextmenu",void 0),E(P(u),"_connectorMousedown",void 0),E(P(u),"_connectorMouseup",void 0),E(P(u),"_endpointMousedown",void 0),E(P(u),"_endpointMouseup",void 0),E(P(u),"_overlayMouseover",void 0),E(P(u),"_overlayMouseout",void 0),E(P(u),"_elementClick",void 0),E(P(u),"_elementTap",void 0),E(P(u),"_elementDblTap",void 0),E(P(u),"_elementMouseenter",void 0),E(P(u),"_elementMouseexit",void 0),E(P(u),"_elementMousemove",void 0),E(P(u),"_elementMouseup",void 0),E(P(u),"_elementMousedown",void 0),E(P(u),"_elementContextmenu",void 0),E(P(u),"eventManager",void 0),E(P(u),"draggingClass","jtk-dragging"),E(P(u),"elementDraggingClass","jtk-element-dragging"),E(P(u),"hoverClass","jtk-hover"),E(P(u),"sourceElementDraggingClass","jtk-source-element-dragging"),E(P(u),"targetElementDraggingClass","jtk-target-element-dragging"),E(P(u),"hoverSourceClass","jtk-source-hover"),E(P(u),"hoverTargetClass","jtk-target-hover"),E(P(u),"dragSelectClass","jtk-drag-select"),E(P(u),"managedElementsSelector",void 0),E(P(u),"elementsDraggable",void 0),E(P(u),"elementDragHandler",void 0),E(P(u),"groupDragOptions",void 0),E(P(u),"elementDragOptions",void 0),E(P(u),"svg",{node:br,attr:Er,pos:kr}),u.elementsDraggable=e&&!1!==e.elementsDraggable,u.managedElementsSelector=e&&e.managedElementsSelector||h,u.eventManager=new Qa,u.dragSelection=new Ol(P(u)),u.dragManager=new Fl(P(u),u.dragSelection),u.dragManager.addHandler(new Yl(P(u))),u.groupDragOptions={constrainFunction:yc},u.dragManager.addHandler(new ql(P(u),u.dragSelection),u.groupDragOptions),u.elementDragHandler=new Vl(P(u),u.dragSelection),u.elementDragOptions=e&&e.dragOptions||{},u.dragManager.addHandler(u.elementDragHandler,u.elementDragOptions),e&&e.dragOptions&&e.dragOptions.filter&&u.dragManager.addFilter(e.dragOptions.filter),u._connectorClick=n.bind(P(u),da),u._connectorDblClick=n.bind(P(u),pa),u._connectorTap=n.bind(P(u),xa),u._connectorDblTap=n.bind(P(u),fa),u._connectorMouseover=i.bind(P(u),!0),u._connectorMouseout=i.bind(P(u),!1),u._connectorMouseup=o.bind(P(u),!0),u._connectorMousedown=o.bind(P(u),!1),u._connectorContextmenu=function(t){var e=A(t).parentNode;e.jtk&&e.jtk.connector&&this.fire(_a,e.jtk.connector.connection,t)}.bind(P(u)),u._endpointClick=s.bind(P(u),oa),u._endpointDblClick=s.bind(P(u),sa),u._endpointMouseover=r.bind(P(u),!0),u._endpointMouseout=r.bind(P(u),!1);function l(t,e){(e=nr(A(e),Pa,this.getContainer(),!0).jtk.overlay)&&this.setOverlayHover(e,t)}function c(t,e){this.fire(t?$r:Zr,A(e),e)}u._endpointMouseup=a.bind(P(u),!0),u._endpointMousedown=a.bind(P(u),!1);var u,t=function(t,e){var n=nr(A(e),Pa,this.getContainer(),!0).jtk.overlay;n&&this.fireOverlayMethod(n,t,e)}.bind(P(u));u._overlayClick=t.bind(P(u),D),u._overlayDblClick=t.bind(P(u),Lr),u._overlayTap=t.bind(P(u),Vr),u._overlayDblTap=t.bind(P(u),Gr),u._overlayMouseover=l.bind(P(u),!0),u._overlayMouseout=l.bind(P(u),!1),u._elementClick=function(t,e,n){e.defaultPrevented||this.fire(1===e.detail?qr:Jr,n,e)}.bind(P(u),qr),u._elementTap=function(t,e,n){e.defaultPrevented||this.fire(ia,n,e)}.bind(P(u),ia),u._elementDblTap=function(t,e,n){e.defaultPrevented||this.fire(Kr,n,e)}.bind(P(u),Kr);return u._elementMouseenter=c.bind(P(u),!0),u._elementMouseexit=c.bind(P(u),!1),u._elementMousemove=function(t){this.fire(Qr,A(t),t)}.bind(P(u)),u._elementMouseup=function(t){this.fire(ta,A(t),t)}.bind(P(u)),u._elementMousedown=function(t){this.fire(ea,A(t),t)}.bind(P(u)),u._elementContextmenu=function(t){this.fire(na,A(t),t)}.bind(P(u)),u._attachEventDelegates(),u}var _c={width:10,height:0,fill:"transparent",stroke:"transparent"},xc=(ac(ue.type,{makeNode:function(t,e){return br("circle",{cx:t.w/2,cy:t.h/2,r:t.radius})},updateNode:function(t,e){Er(e,{cx:""+t.w/2,cy:""+t.h/2,r:""+t.radius})}}),ac(pe.type,{makeNode:function(t,e){return br("rect",_c)},updateNode:function(t,e){Er(e,_c)}}),ac(ge.type,{makeNode:function(t,e){return br("rect",{width:t.w,height:t.h})},updateNode:function(t,e){Er(e,{width:t.w,height:t.h})}}),0);return r.ABSOLUTE=Ge,r.ATTRIBUTE_CONTAINER=Tr,r.ATTRIBUTE_GROUP=Fe,r.ATTRIBUTE_GROUP_CONTENT=wr,r.ATTRIBUTE_JTK_ENABLED=Ar,r.ATTRIBUTE_JTK_SCOPE=Or,r.ATTRIBUTE_MANAGED=Be,r.ATTRIBUTE_NOT_DRAGGABLE=Ve,r.ATTRIBUTE_SCOPE=Ue,r.ATTRIBUTE_SCOPE_PREFIX=Xe,r.ATTRIBUTE_TABINDEX=He,r.AbstractBezierConnector=d,r.AbstractConnector=xe,r.AbstractSegment=Ut,r.ArcSegment=Mo,r.ArrowOverlay=No,r.BLOCK=Ne,r.BOTTOM=S,r.BezierConnector=Bs,r.BezierSegment=Gs,r.BlankEndpoint=pe,r.BlankEndpointHandler=ve,r.BrowserJsPlumbInstance=gc,r.CHECK_CONDITION=Ye,r.CHECK_DROP_ALLOWED=ze,r.CLASS_CONNECTED=Je,r.CLASS_CONNECTOR=We,r.CLASS_CONNECTOR_OUTLINE=qe,r.CLASS_DELEGATED_DRAGGABLE=Ml,r.CLASS_DRAGGABLE=Il,r.CLASS_DRAGGED=Gl,r.CLASS_DRAG_ACTIVE=Ll,r.CLASS_DRAG_CONTAINER=jl,r.CLASS_DRAG_HOVER=Rl,r.CLASS_ENDPOINT=Ke,r.CLASS_ENDPOINT_ANCHOR_PREFIX=en,r.CLASS_ENDPOINT_CONNECTED=Ze,r.CLASS_ENDPOINT_DROP_ALLOWED=Qe,r.CLASS_ENDPOINT_DROP_FORBIDDEN=tn,r.CLASS_ENDPOINT_FULL=$e,r.CLASS_GHOST_PROXY=Nl,r.CLASS_GROUP_COLLAPSED=nn,r.CLASS_GROUP_EXPANDED=on,r.CLASS_OVERLAY=sn,r.CONNECTION=Ir,r.Collicat=Tl,r.Component=ei,r.Connection=Ii,r.ConnectionDragSelector=fi,r.ConnectionSelection=Ki,r.Connectors=Ae,r.CustomOverlay=Wo,r.DEFAULT=zt,r.DiamondOverlay=Uo,r.DotEndpoint=ue,r.DotEndpointHandler=i,r.Drag=Cl,r.DragManager=Fl,r.ELEMENT=Mr,r.ELEMENT_DIV=jr,r.EMPTY_BOUNDS=Ht,r.ENDPOINT=Dr,r.ERROR_SOURCE_DOES_NOT_EXIST=jn,r.ERROR_SOURCE_ENDPOINT_FULL=Mn,r.ERROR_TARGET_DOES_NOT_EXIST=Nn,r.ERROR_TARGET_ENDPOINT_FULL=In,r.EVENT_ANCHOR_CHANGED=rn,r.EVENT_BEFORE_START=dl,r.EVENT_CLICK=D,r.EVENT_CONNECTION=an,r.EVENT_CONNECTION_ABORT=zr,r.EVENT_CONNECTION_CLICK=da,r.EVENT_CONNECTION_CONTEXTMENU=_a,r.EVENT_CONNECTION_DBL_CLICK=pa,r.EVENT_CONNECTION_DBL_TAP=fa,r.EVENT_CONNECTION_DETACHED=cn,r.EVENT_CONNECTION_DRAG=Wr,r.EVENT_CONNECTION_MOUSEDOWN=ma,r.EVENT_CONNECTION_MOUSEOUT=ya,r.EVENT_CONNECTION_MOUSEOVER=va,r.EVENT_CONNECTION_MOUSEUP=ga,r.EVENT_CONNECTION_MOVED=un,r.EVENT_CONNECTION_TAP=xa,r.EVENT_CONTAINER_CHANGE=hn,r.EVENT_CONTEXTMENU=Nr,r.EVENT_DBL_CLICK=Lr,r.EVENT_DBL_TAP=Gr,r.EVENT_DRAG=pl,r.EVENT_DRAG_MOVE=Hr,r.EVENT_DRAG_START=Xr,r.EVENT_DRAG_STOP=Ur,r.EVENT_DROP="drop",r.EVENT_ELEMENT_CLICK=qr,r.EVENT_ELEMENT_CONTEXTMENU=na,r.EVENT_ELEMENT_DBL_CLICK=Jr,r.EVENT_ELEMENT_DBL_TAP=Kr,r.EVENT_ELEMENT_MOUSE_DOWN=ea,r.EVENT_ELEMENT_MOUSE_MOVE=Qr,r.EVENT_ELEMENT_MOUSE_OUT=Zr,r.EVENT_ELEMENT_MOUSE_OVER=$r,r.EVENT_ELEMENT_MOUSE_UP=ta,r.EVENT_ELEMENT_TAP=ia,r.EVENT_ENDPOINT_CLICK=oa,r.EVENT_ENDPOINT_DBL_CLICK=sa,r.EVENT_ENDPOINT_DBL_TAP=ra,r.EVENT_ENDPOINT_MOUSEDOWN=ua,r.EVENT_ENDPOINT_MOUSEOUT=aa,r.EVENT_ENDPOINT_MOUSEOVER=la,r.EVENT_ENDPOINT_MOUSEUP=ca,r.EVENT_ENDPOINT_REPLACED=dn,r.EVENT_ENDPOINT_TAP=ha,r.EVENT_FOCUS="focus",r.EVENT_GROUP_ADDED=vn,r.EVENT_GROUP_COLLAPSE=gn,r.EVENT_GROUP_EXPAND=mn,r.EVENT_GROUP_MEMBER_ADDED=_n,r.EVENT_GROUP_MEMBER_REMOVED=xn,r.EVENT_GROUP_REMOVED=En,r.EVENT_INTERNAL_CONNECTION=ln,r.EVENT_INTERNAL_CONNECTION_DETACHED=fn,r.EVENT_INTERNAL_ENDPOINT_UNREGISTERED=pn,r.EVENT_MANAGE_ELEMENT=yn,r.EVENT_MAX_CONNECTIONS=bn,r.EVENT_MOUSEDOWN=M,r.EVENT_MOUSEENTER=Rr,r.EVENT_MOUSEEXIT=Fr,r.EVENT_MOUSEMOVE=Br,r.EVENT_MOUSEOUT=j,r.EVENT_MOUSEOVER=N,r.EVENT_MOUSEUP=I,r.EVENT_NESTED_GROUP_ADDED=kn,r.EVENT_NESTED_GROUP_REMOVED=Cn,r.EVENT_OUT="out",r.EVENT_OVER="over",r.EVENT_REVERT=Yr,r.EVENT_START=hl,r.EVENT_STOP=fl,r.EVENT_TAP=Vr,r.EVENT_UNMANAGE_ELEMENT=Sn,r.EVENT_ZOOM=Pn,r.ElementDragHandler=Vl,r.Endpoint=Gi,r.EndpointFactory=re,r.EndpointRepresentation=ae,r.EndpointSelection=Wi,r.EventGenerator=kt,r.EventManager=Qa,r.FALSE=qt,r.FIXED=Re,r.FlowchartConnector=a,r.GroupManager=Ui,r.INTERCEPT_BEFORE_DETACH=On,r.INTERCEPT_BEFORE_DRAG=wn,r.INTERCEPT_BEFORE_DROP=An,r.INTERCEPT_BEFORE_START_DETACH=Dn,r.IS_DETACH_ALLOWED=Tn,r.JsPlumbInstance=yi,r.KEY_CONNECTION_OVERLAYS=Ln,r.LEFT=k,r.LabelOverlay=Xn,r.LightweightFloatingAnchor=si,r.LightweightRouter=ko,r.NONE=Le,r.OptimisticEventGenerator=St,r.Overlay=Fn,r.OverlayFactory=Un,r.PROPERTY_POSITION=Ea,r.PlainArrowOverlay=Fo,r.REDROP_POLICY_ANY="any",r.REDROP_POLICY_STRICT="strict",r.RIGHT=C,r.RectangleEndpoint=ge,r.RectangleEndpointHandler=_e,r.SELECTOR_CONNECTOR=ba,r.SELECTOR_ENDPOINT=ka,r.SELECTOR_GROUP=Ca,r.SELECTOR_GROUP_CONTAINER=Sa,r.SELECTOR_MANAGED_ELEMENT=h,r.SELECTOR_OVERLAY=Pa,r.SOURCE=Ie,r.SOURCE_INDEX=0,r.STATIC="static",r.SourceSelector=uo,r.StateMachineConnector=Us,r.StraightConnector=Pe,r.StraightSegment=ke,r.TARGET=je,r.TARGET_INDEX=1,r.TOP=w,r.TRUE=Wt,r.TWO_PI=wt,r.TargetSelector=fo,r.UIGroup=Vi,r.UINode=Fi,r.UNDEFINED=Yt,r.Viewport=ro,r.WILDCARD=Jt,r.X_AXIS_FACES=ii,r.Y_AXIS_FACES=oi,r._createPerimeterAnchor=wi,r._removeTypeCssHelper=$n,r._updateHoverStyle=Qn,r.add=function(t,e){return{x:t.x+e.x,y:t.y+e.y}},r.addClass=ar,r.addToDictionary=it,r.addToList=function(t,e,n,i){var o=t.get(e);return null==o&&t.set(e,o=[]),o[i?"unshift":"push"](n),o},r.addWithFunction=function(t,e,n){-1===J(t,n)&&t.push(e)},r.arraysEqual=Y,r.att=Me,r.bezierLineIntersection=js,r.boundingBoxIntersection=function(t,e){var n=[];return n.push.apply(n,js(t.x,t.y,t.x+t.w,t.y,e)),n.push.apply(n,js(t.x+t.w,t.y,t.x+t.w,t.y+t.h,e)),n.push.apply(n,js(t.x+t.w,t.y+t.h,t.x,t.y+t.h,e)),n.push.apply(n,js(t.x,t.y+t.h,t.x,t.y,e)),n},r.boxIntersection=function(t,e,n,i,o){var s=[];return s.push.apply(s,js(t,e,t+n,e,o)),s.push.apply(s,js(t+n,e,t+n,e+i,o)),s.push.apply(s,js(t+n,e+i,t,e+i,o)),s.push.apply(s,js(t,e+i,t,e,o)),s},r.classList=De,r.clone=H,r.cls=Oe,r.compoundEvent=O,r.computeBezierLength=Ss,r.consume=er,r.convertToFullOverlaySpec=Gn,r.createElement=hr,r.createElementNS=dr,r.createFloatingAnchor=xi,r.dist=ws,r.distanceFromCurve=ms,r.each=lt,r.encloses=function(t,e,o){function n(t,e,n,i){return o?t<=e&&i<=n:t<e&&i<n}var i=t.x,s=t.x+t.w,r=t.y,t=t.y+t.h,a=e.x,l=e.x+e.w,c=e.y,e=e.y+e.h;return n(i,a,s,l)&&n(r,c,t,e)},r.extend=p,r.fastTrim=at,r.filterList=L,r.filterNull=function(t){var e,n={};for(e in t)null!=t[e]&&(n[e]=t[e]);return n},r.findAllWithFunction=K,r.findParent=nr,r.findWithFunction=J,r.forEach=y,r.fromArray=et,r.functionChain=W,r.getAllWithFunction=$,r.getClass=rr,r.getDefaultFace=ui,r.getEventSource=A,r.getFromSetWithFunction=Q,r.getPositionOnElement=lc,r.getTouch=Ga,r.getWithFunction=Z,r.getsert=dt,r.gradient=At,r.gradientAtPoint=Is,r.gradientAtPointAlongPathFrom=function(t,e,n){return 1<(e=Os(t,e,n)).location&&(e.location=1),e.location<0&&(e.location=0),Is(t,e.location)},r.groupDragConstrain=yc,r.hasClass=lr,r.insertSorted=ft,r.intersects=jt,r.isArrayLike=function(t){return!f(t)&&(Array.isArray(t)||sr(t))},r.isArrowOverlay=Go,r.isAssignableFrom=pt,r.isBoolean=R,r.isContinuous=_o,r.isCustomOverlay=Jo,r.isDate=B,r.isDiamondOverlay=Yo,r.isDynamic=Eo,r.isEdgeSupported=di,r.isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},r.isFloating=xo,r.isFullOverlaySpec=function(t){return null!=t.type&&null!=t.options},r.isFunction=V,r.isInsideParent=ol,r.isLabelOverlay=zn,r.isNamedFunction=function(t){return V(t)&&null!=t.name&&0<t.name.length},r.isNodeList=sr,r.isNumber=G,r.isObject=F,r.isPlainArrowOverlay=Vo,r.isPoint=As,r.isString=f,r.lineIntersection=Lt,r.lineLength=Dt,r.lineRectangleIntersection=function(e,t){var n=[];return y([[{x:t.x,y:t.y},{x:t.x+t.w,y:t.y}],[{x:t.x+t.w,y:t.y},{x:t.x+t.w,y:t.y+t.h}],[{x:t.x,y:t.y},{x:t.x,y:t.y+t.h}],[{x:t.x,y:t.y+t.h},{x:t.x+t.w,y:t.y+t.h}]],function(t){t=Lt(e,t);null!=t&&n.push(t)}),n},r.locationAlongCurveFrom=Ms,r.log=l,r.logEnabled=!0,r.makeLightweightAnchorFromSpec=ki,r.map=ct,r.matchesSelector=tr,r.merge=U,r.nearestPointOnCurve=_s,r.newInstance=function(t){return new gc((e=xc+1,xc++,e),t);var e},r.normal=Ot,r.objectsEqual=z,r.offsetRelativeToRoot=pr,r.pageLocation=La,r.perpendicularLineTo=Rt,r.perpendicularToPathAt=function(t,e,n,i){return e=Os(t,e,i=null==i?0:i),i=Is(t,e.location),t=Math.atan(-1/i),i=n/2*Math.sin(t),n=n/2*Math.cos(t),[{x:e.point.x+n,y:e.point.y+i},{x:e.point.x-n,y:e.point.y-i}]},r.pointAlongCurveFrom=Ds,r.pointAlongPath=Os,r.pointOnCurve=Ts,r.pointOnLine=Gt,r.populate=q,r.quadrant=Mt,r.ready=function(e){(function t(){/complete|loaded|interactive/.test(document.readyState)&&void 0!==document.body&&null!=document.body?e():setTimeout(t,9)})()},r.registerEndpointRenderer=ac,r.remove=nt,r.removeClass=cr,r.removeWithFunction=v,r.replace=function(t,e,r){var a;if(null!=t)return a=t,e.replace(/([^\.])+/g,function(t,e,n,i){function o(){return a[s[1]]||(a[s[1]]=[],a[s[1]])}var s=t.match(/([^\[0-9]+){1}(\[)([0-9+])/);return n+t.length>=i.length?s?o()[s[3]]=r:a[t]=r:a=s?(n=o())[s[3]]||(n[s[3]]={},n[s[3]]):a[t]||(a[t]={},a[t]),""}),t},r.rotateAnchorOrientation=function(t,e){return t=rt({x:t[0],y:t[1]},{x:0,y:0},e),[Math.round(t.x),Math.round(t.y)]},r.rotatePoint=rt,r.setToArray=tt,r.sgn=ut,r.size=fr,r.snapToGrid=Ft,r.subtract=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},r.suggest=ot,r.theta=It,r.toggleClass=ur,r.touchCount=Fa,r.touches=Ra,r.uuid=T,r.wrap=ht,Object.defineProperty(r,"__esModule",{value:!0}),r}({});function uniqueId(){return String(Math.random().toString(16).slice(2))}function arrRemove(t,e){e=t.indexOf(e);-1<e&&t.splice(e,1)}function findTemplates(){var e=document.getElementById("nodel").children,n=[];for(let t=0;t<e.length;t++){var i=e[t];n.push(i.id)}return n}function toRegPos(t){var e=document.getElementById("nodel");return[t.x+e.offsetWidth/2,t.y+e.offsetHeight/2]}class Nodel{static fromJSON(t){return new Nodel(t.id,t.template,t.x,t.y,t.data,t.parents,t.children,t.group)}constructor(t,e,n,i,o,s={},r={},a={name:null,collapsed:!1,ends:[]}){this.id=t,this.template=e,this.x=n,this.y=i,this.data=o,this.parents=s,this.children=r,this.group=a}isLeaf(){return!Object.values(this.children)?.length}isHead(){return!Object.values(this.parents)?.length}isGroup(t=null){return!(!this.group.ends.length&&!this.group.name||null!==t&&this.group.collapsed!==t)}groupAllChildren(t){this.group.ends=this.getLeaves(t)}parentGroupNodes(t,e=[]){if(e.includes(this.id))return[];e.push(this.id);let n=[];for(var[i,o]of Object.entries(this.parents))for(const r of o){var s=t[r];s.isGroup()&&n.push(s.id),n=n.concat(s.parentGroupNodes(t,e))}return n}hasChild(t,e,n=null){if(this.id===e)return!0;if(this.id!==n)for(var[i,o]of Object.entries(this.children))for(const s of o)if(t[s].hasChild(t,e,n))return!0;return!1}moveConnection(t,e,n,i){t[n].splice(t[n].indexOf(e),1),t[i]||(t[i]=[]),t[i].push(e)}moveParent(t,e,n){this.moveConnection(this.parents,t,e,n)}moveChild(t,e,n){this.moveConnection(this.children,t,e,n)}isDirectChild(t,e){return!!this.children[e]?.includes(t)}groupContains(t,e){for(const n of this.group.ends)if(this.hasChild(t,e,n))return!0;return!1}getInvolvedGroupNodes(t){var e=[];for(const i of this.parentGroupNodes(t)){var n=t[i];n.groupContains(t,this.id)&&e.push(n)}return e}isVisible(t){for(const e of this.getInvolvedGroupNodes(t))if(this.id!=e.id&&e.group.collapsed&&e.groupContains(t,this.id))return!1;return!0}getLeaves(t,e=[]){if(e.includes(this.id))return[];if(e.push(this.id),this.isLeaf())return[this.id];let n=[];for(var[i,o]of Object.entries(this.children))for(const r of o){var s=t[r];n=n.concat(s.getLeaves(t,e))}return n}distanceTo(t){return Math.sqrt((this.x-t.x)**2+(this.y-t.y)**2)}}class NodelEvent{static TYPES={Node:0,Connection:1};constructor(t,e,n=null){var i=document.getElementById("nodel");switch(this.elem=e.target,this.x=e.x-i.offsetWidth/2,this.y=e.y-i.offsetHeight/2,t){case NodelEvent.TYPES.Node:this.node=n;break;case NodelEvent.TYPES.Connection:this.nodes=n;break;default:console.error("Unknown NodelEvent type: "+t)}}}class NodelManager{constructor(t){this.nodes={},this.render=t,this.isDrawingPaused=0,this.onDrawCallbacks=[]}isEmpty(){return!Object.keys(this.nodes).length}exists(t){return t&&t in this.nodes}verify(t,e=!0){return this.exists(t)===e}verifyBoth(t,e,n=0){return this.verify(t)&&this.verify(e)}onDraw(t){this.onDrawCallbacks.push(t)}redraw(){if(this.isDrawingPaused)console.warn("skipping draw request, drawing is paused");else{this.render.draw(this.nodes);for(const t of this.onDrawCallbacks)t()}}pauseDraw(){this.isDrawingPaused+=1}unpauseDraw(){--this.isDrawingPaused,this.isDrawingPaused<0&&console.error("Something has gone terribly wrong"),this.redraw()}addNode(t,e,n,i){var o;return this.render.verify(t)?(o=uniqueId(),this.nodes[o]=new Nodel(o,t,e,n,i),this.redraw(),o):null}createGroup(t,e){this.verify(t)&&((t=this.nodes[t]).group.name=e,t.groupAllChildren(this.nodes),this.redraw())}toggleGroup(t,e=null){var n;this.verify(t)&&((n=this.nodes[t]).group.ends.length||this.createGroup(t,n.data.name+" group"),n.group.collapsed=null==e?!n.group.collapsed:e,this.redraw())}deleteNode(t){if(this.verify(t)){const i=this.nodes[t];delete this.nodes[t],this.eachChild(i,t=>{for(var[e,n]of Object.entries(t.parents))i.id in n&&t.parents[e].splice(n.indexOf(i.id),1)}),this.eachParent(parent,t=>{for(var[e,n]of Object.entries(parent.children))i.id in n&&parent.children[e].splice(n.indexOf(i.id),1)}),this.redraw()}}toggleConnect(t,e,n="default"){if(this.verifyBoth(t,e)){var i=this.nodes[t];if(i.group.collapsed)for(const o of i.group.ends)return void this.toggleConnect(o,e,n);i.isDirectChild(e,n)?this.disconnectNodes(t,e,n):this.connectNodes(t,e,n),this.redraw()}}getConnectionType(t,e){if(this.verifyBoth(t,e)){var n,i,t=this.nodes[t];for([n,i]of Object.entries(t.children))if(i.includes(e))return n;return null}}setConnectionType(t,e,n){var i;this.verifyBoth(t,e)&&(i=this.getConnectionType(t,e),this.nodes[t].moveChild(e,i,n),this.nodes[e].moveParent(t,i,n),this.redraw())}connectNodes(t,e,n){var i,o;this.verifyBoth(t,e)&&(i=this.nodes[t].children,o=this.nodes[e].parents,n in i||(i[n]=[]),n in o||(o[n]=[]),i[n].push(e),o[n].push(t))}disconnectNodes(t,e,n){var i=this.nodes[t].children,o=this.nodes[e].parents;arrRemove(i[n],e),arrRemove(o[n],t)}moveNode(t,e,n){if(this.verify(t)){t=this.nodes[t];const i=e-t.x,o=n-t.y;t.x=e,t.y=n,t.isGroup()&&t.group.collapsed&&this.eachChild(t,(t,e)=>{t.x+=i,t.y+=o},t.group.ends),this.redraw()}}getHeads(){return Object.values(this.nodes).filter(t=>t.isHead())}eachChild(t,e,n=[]){this.eachConnection(t.children,e,n)}eachParent(t,e,n=[]){this.eachConnection(t.parents,e,n)}eachConnection(t,e,n=[]){if(t)for(var[i,o]of Object.entries(t))for(const s of o)s in n||e(this.nodes[s],i)}getDirectNodes(t){var e,n,i={};for([e,n]of Object.entries(t)){e in i||(i[e]=[]);for(const o of n)i[e].push(o.id)}return i}createGroupMap(t,e=null,n=0,i=0){if(e=e||t.group.ends,t.id in e)return null;var o,s,r={};for([o,s]of Object.entries(t.children)){o in r||(r[o]=[]);for(const l of s){var a=this.nodes[l],a=this.createGroupMap(a,e,t.x,t.y);r[o].push(a)}}return{id:t.id,moduleId:t.data.name,offsetX:t.x-n,offsetY:t.y-i,parents:e?t.parents:null,children:r||null}}createFromMap(t,e,n,i=null,o=()=>null,s,r={},a=null){var l=i??r[t.id]??o(t,e,n);if(!(t.id in r)){r[t.id]=l;for(var[c,u]of Object.entries(t.children))for(const h of u)this.createFromMap(h,l.x,l.y,null,o,null,r,{type:c,parentId:l.id})}i=JSON.stringify;return a&&(this.connectNodes(a.parentId,l.id,a.type),l.conn.push(i(a))),l.id}load(t){for(const e of t)this.nodes[e.id]=Nodel.fromJSON(e);this.redraw()}}class NodelRender{constructor(){this.recenter(),this.resetScale(),this.templates=findTemplates(),this.pencil=jsPlumbBrowserUI.newInstance({container:document.getElementById("nodel")}),this.hideTemplates=!1,this.toggleTemplates(),this.connectionBinding={},this.connectionColorCallback=()=>"#ad00d9",this.connectionLabelCallback=()=>"",this.helpers={"connection-color":()=>"#ad00d9","connection-label":()=>""}}toggleTemplates(){this.hideTemplates=!this.hideTemplates;for(const t of this.templates)document.getElementById(t).hidden=this.hideTemplates}clear(){var e=document.getElementById("nodel");this.pencil.deleteEveryConnection();for(let t=e.children.length-1;0<=t;t--){var n=e.children[t];this.templates.includes(n.id)||e.removeChild(n)}}on(t,e){this.helpers[t]=e}draw(n){var t=document.getElementById("nodel"),i=(this.clear(),Object.values(n).filter(t=>t.isVisible(n)));for(const d of i){var e,o,s=document.getElementById(d.template).cloneNode(!0),r=(t.appendChild(s),s.id=d.id,s.hidden=!1,d.isGroup(!0)&&s.classList.add("group"),d.group.collapsed?d.group:d.data);for([e,o]of Object.entries(r))s.innerHTML=s.innerHTML.replaceAll(`{${e}}`,o);var[r,a]=toRegPos(d);s.style.position="absolute",s.style.left=r-s.offsetWidth/2+"px",s.style.top=a-s.offsetHeight/2+"px"}for(const p of i)for(const f of p.group.collapsed?p.group.ends:[p.id]){var l,c,u=n[f];for([l,c]of Object.entries(u.children))for(const y of c){const v=n[y];p.id;let t=null,e=!1;i.includes(v)?t=v.id:(h=v.getInvolvedGroupNodes(n).reverse().find(t=>t.group.collapsed),t=h.id,e=!0);var h=this.drawConnection(p,v,l,e);const g=this.connectionBinding;g&&h.connector.path.addEventListener(g.eventType,t=>{g.callback(t,[p.id,v.id])})}}}drawConnection(t,e,n,i=!1){var[o,s]=[t.id,e.id],o=document.getElementById(o),s=document.getElementById(s),r=this.helpers["connection-color"](n),n=this.helpers["connection-label"](t,e,n),r={strokeWidth:6,stroke:r},i=this.pencil.connect({source:o,target:s,anchor:"Continuous",paintStyle:i?{...r,dashstyle:"3"}:r,overlays:[{type:"Arrow",options:{location:1}},{type:"Label",options:{label:n,cssClass:"line-label"}}],connector:this.connectionType(t,e)});return this.pencil.setDraggable(o,!1),this.pencil.setDraggable(s,!1),i}connectionType(t,e,n=300){return t.id==e.id?"StateMachine":t.distanceTo(e)<n?"Straight":"Bezier"}addConnectionBinding(t,e){this.connectionBinding={eventType:t,callback:e}}verify(t,e=!0){return!(!t||this.templates.includes(t)!=e)||(console.error(`(nodel) ${e?"couldn't find":"found"} template #`+t),!1)}recenter(){self.x=0,self.y=0}panView(t,e){self.x+=t,self.y+=e}adjustScale(t){this.scale+=t}setScale(t){this.scale=t}resetScale(){this.scale=1}}class NodelListener{constructor(t,e){this.manager=t,this.render=e}on(t,i,e=!1){e?(this.render.addConnectionBinding(t,(t,e)=>{e=e.map(t=>this.manager.nodes[t]);i(new NodelEvent(NodelEvent.TYPES.Connection,t,e))}),this.manager.redraw()):document.getElementById("nodel").addEventListener(t,t=>{var e=t.target?.id;let n=null;e&&this.manager.verify(e,!0)&&(n=this.manager.nodes[e]);e=new NodelEvent(NodelEvent.TYPES.Node,t,n);i(e)})}}
